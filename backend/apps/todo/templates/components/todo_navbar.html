{% load static %}
{% load i18n %}
<!-- Todo App Navbar - Linguify Style -->
<div class="navbar-linguify">
    <!-- Gauche: Navigation + Actions principales -->
    <div class="navbar-section">    
                <!-- New Task Button - Left side -->
        <button id="createTask" class="btn-navbar btn-navbar-primary" 
                hx-get="{% url 'todo:task_form_modal_htmx' %}" 
                hx-target="#task-modal-container" 
                hx-trigger="click">
            <i class="bi bi-plus-lg"></i>
            <span class="d-none d-xl-inline">{% trans "New Task" %}</span>
        </button>    
        <!-- Navigation tabs -->
        <div class="nav-tabs-group">
            <a href="{% url 'todo:kanban' %}" 
               class="nav-tab {% if active_view == 'kanban' %}active{% endif %}">
                <i class="bi bi-kanban"></i>
                {% trans "Kanban" %}
            </a>
            <a href="{% url 'todo:list' %}" 
               class="nav-tab {% if active_view == 'list' %}active{% endif %}">
                <i class="bi bi-list-ul"></i>
                {% trans "List" %}
            </a>
            <a href="{% url 'todo:activity' %}" 
               class="nav-tab {% if active_view == 'activity' %}active{% endif %}">
                <i class="bi bi-clock-history"></i>
                {% trans "Activity" %}
            </a>
        </div>
        

        <div class="container-extra">
            <!-- Bouton Refresh -->
            <button id="refreshTasks" class="btn-sb" title="{% trans 'Refresh tasks' %}">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            
            <!-- Save Indicator - Cloud icon -->
            <div id="cloudSaveIndicator" 
                 class="btn-sb save-indicator-cloud" 
                 style="display: none;" 
                 title="Sauvegarde automatique">
                <i class="bi bi-cloud-check"></i>
                <span class="d-none d-xxl-inline"></span>
            </div>
            
            <!-- Hidden HTMX target (for compatibility) -->
            <div id="navbarSaveIndicator" style="display: none;"></div>
        </div>
    </div>
            
    
    <!-- Droite: Actions et filtres contextuels -->
    <div class="navbar-section-right">
        <!-- Activity-specific controls -->
        {% if active_view == 'activity' %}
        <div class="activity-period-selector">
            <label class="navbar-label">{% trans "Period:" %}</label>
            <select id="activityTimeRange" class="form-control-linguify" style="width: 120px;" 
                    hx-get="{% url 'todo:activity' %}" 
                    hx-trigger="change" 
                    hx-target="#activity-content" 
                    hx-include="[name='range']">
                <option value="7">{% trans "7 days" %}</option>
                <option value="30">{% trans "30 days" %}</option>
                <option value="90">{% trans "3 months" %}</option>
            </select>
        </div>
        {% endif %}
        
        <!-- Select All (List view only) -->
        {% if active_view == 'list' %}
        <div class="navbar-checkbox-group">
            <input type="checkbox" class="form-check-input" id="selectAll">
            <label class="navbar-label">{% trans "Select All" %}</label>
        </div>
        {% endif %}
        
        <!-- Search (pas sur Activity) -->
        {% if active_view != 'activity' %}
        <input type="text" id="searchInput" class="form-control-linguify" placeholder="{% trans 'Search tasks...' %}" style="width: 140px; min-width: 100px;">
        {% endif %}
        
        <!-- Project Filter (List view) -->
        {% if active_view == 'list' %}
        <div class="dropdown">
            <button id="projectFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="projectFilterText">{% trans "All Projects" %}</span>
            </button>
            <ul id="projectFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectProjectFilter('', '{% trans "All Projects" %}')">{% trans "All Projects" %}</a></li>
                {% for project in projects %}
                <li><a class="dropdown-item" href="#" onclick="selectProjectFilter('{{ project.id }}', '{{ project.name }}')">{{ project.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Stage Filter (List view) -->
        {% if active_view == 'list' %}
        <div class="dropdown">
            <button id="stageFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="stageFilterText">{% trans "All Stages" %}</span>
            </button>
            <ul id="stageFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectStageFilter('', '{% trans "All Stages" %}')">{% trans "All Stages" %}</a></li>
                {% for stage in stages %}
                <li><a class="dropdown-item" href="#" onclick="selectStageFilter('{{ stage.id }}', '{{ stage.name }}')">{{ stage.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Sort Filter Dropdown -->
        <div class="dropdown">
            <button id="sortFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="sortFilterText">{% trans "Recent" %}</span>
            </button>
            <ul id="sortFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('updated_desc', '{% trans "Recent" %}')">{% trans "Recent" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('title_asc', '{% trans "A-Z" %}')">{% trans "A-Z" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('priority_desc', '{% trans "Priority" %}')">{% trans "Priority" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('due_date_asc', '{% trans "Due Date" %}')">{% trans "Due Date" %}</a></li>
            </ul>
        </div>
        
        <!-- Actions -->
        <div class="navbar-actions-group">
            <!-- Activity-specific actions -->
            {% if active_view == 'activity' %}
            <a href="{% url 'todo:activity_dashboard' %}" class="btn-navbar btn-navbar-outline" title="{% trans 'Advanced Analytics' %}">
                <i class="bi bi-graph-up"></i>
                <span class="d-none d-xl-inline">{% trans "Analytics" %}</span>
            </a>
            {% endif %}
            
            <!-- Bulk Actions (List view only) -->
            {% if active_view == 'list' %}
            <button id="bulkActionsBtn" class="btn-navbar btn-navbar-outline" onclick="showBulkActionsMenu()" disabled title="{% trans 'Bulk Actions' %}">
                <i class="bi bi-check-all"></i>
                <span class="d-none d-xl-inline">{% trans "Bulk Actions" %}</span>
            </button>
            {% endif %}
            
            <a href="{% url 'saas_web:todo_settings' %}" id="configureTasks" class="btn-navbar btn-navbar-outline" title="{% trans 'Configure Todo Settings' %}">
                <i class="bi bi-gear"></i>
                <span class="d-none d-xxl-inline">{% trans "Configure" %}</span>
            </a>
            
            <!-- Export (diffÃ©rent pour Activity) -->
            {% if active_view == 'activity' %}
            <div class="dropdown" style="position: relative;">
                <button id="activityExportBtn" class="btn-navbar btn-navbar-outline dropdown-toggle" title="{% trans 'Export Activity Data' %}" onclick="toggleActivityExportDropdown()">
                    <i class="bi bi-download"></i>
                    <span class="d-none d-xxl-inline">{% trans "Export" %}</span>
                </button>
                <div id="activityExportDropdown" class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 100%; z-index: 1000;">
                    <a class="dropdown-item" href="{% url 'todo:activity_export' %}?format=json">
                        <i class="bi bi-filetype-json me-2"></i>{% trans "Export JSON" %}
                    </a>
                    <a class="dropdown-item" href="{% url 'todo:activity_export' %}?format=csv">
                        <i class="bi bi-filetype-csv me-2"></i>{% trans "Export CSV" %}
                    </a>
                    <a class="dropdown-item" href="{% url 'todo:activity_export' %}?format=xlsx">
                        <i class="bi bi-file-earmark-excel me-2"></i>{% trans "Export Excel" %}
                    </a>
                </div>
            </div>
            {% else %}
            <a href="#" id="exportTasks" class="btn-navbar btn-navbar-outline" title="{% trans 'Export Tasks' %}" 
               hx-get="/todo/export/" hx-target="body" hx-swap="afterbegin">
                <i class="bi bi-download"></i>
                <span class="d-none d-xxl-inline">{% trans "Export" %}</span>
            </a>
            {% endif %}
            
            <!-- Import (pas sur Activity) -->
            {% if active_view != 'activity' %}
            <button id="importTasks" class="btn-navbar btn-navbar-outline" 
                    hx-get="/todo/import/" hx-target="#import-modal-container" hx-trigger="click">
                <i class="bi bi-upload"></i>
                <span class="d-none d-xxl-inline">{% trans "Import" %}</span>
            </button>
            {% endif %}
        </div>
    </div>
</div>