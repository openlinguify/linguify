{% load static %}
{% load i18n %}
<!-- Todo App Navbar - Linguify Style -->
<div class="navbar-linguify">
    <!-- Gauche: Navigation + Actions principales -->
    <div class="navbar-section">    
                <!-- New Task Button - Left side -->
        <button id="createTask" class="btn-navbar btn-navbar-primary" 
                hx-get="{% url 'todo:task_form_modal_htmx' %}" 
                hx-target="#task-modal-container" 
                hx-trigger="click">
            <i class="bi bi-plus-lg"></i>
            <span class="d-none d-xl-inline">{% trans "New Task" %}</span>
        </button>    
        <!-- Navigation tabs -->
        <div class="nav-tabs-group">
            <a href="{% url 'todo:kanban' %}" 
               class="nav-tab {% if active_view == 'kanban' %}active{% endif %}">
                <i class="bi bi-kanban"></i>
                {% trans "Kanban" %}
            </a>
            <a href="{% url 'todo:list' %}" 
               class="nav-tab {% if active_view == 'list' %}active{% endif %}">
                <i class="bi bi-list-ul"></i>
                {% trans "List" %}
            </a>
            <a href="{% url 'todo:activity' %}" 
               class="nav-tab {% if active_view == 'activity' %}active{% endif %}">
                <i class="bi bi-clock-history"></i>
                {% trans "Activity" %}
            </a>
        </div>
        

        <div class="container-extra">
            <!-- Bouton Refresh -->
            <button id="refreshTasks" class="btn-sb" title="{% trans 'Refresh tasks' %}">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            
            <!-- Save Indicator - Cloud icon -->
            <div id="cloudSaveIndicator" 
                 class="btn-sb save-indicator-cloud" 
                 style="display: none;" 
                 title="Sauvegarde automatique">
                <i class="bi bi-cloud-check"></i>
                <span class="d-none d-xxl-inline"></span>
            </div>
            
            <!-- Hidden HTMX target (for compatibility) -->
            <div id="navbarSaveIndicator" style="display: none;"></div>
        </div>
    </div>
            
    
    <!-- Droite: Actions et filtres contextuels -->
    <div class="navbar-section-right">
        <!-- Activity-specific controls -->
        {% if active_view == 'activity' %}
        <div class="activity-period-selector">
            <label class="navbar-label">{% trans "Period:" %}</label>
            <select class="form-control-linguify" style="width: 120px;" 
                    hx-get="{% url 'todo:activity' %}" 
                    hx-trigger="change" 
                    hx-target="#activity-content" 
                    hx-swap="innerHTML"
                    hx-include="this"
                    name="range">
                <option value="7" {% if request.GET.range == '7' %}selected{% endif %}>{% trans "7 days" %}</option>
                <option value="30" {% if request.GET.range == '30' or not request.GET.range %}selected{% endif %}>{% trans "30 days" %}</option>
                <option value="90" {% if request.GET.range == '90' %}selected{% endif %}>{% trans "3 months" %}</option>
            </select>
        </div>
        {% endif %}
        
        <!-- Select All (List view only) -->
        {% if active_view == 'list' %}
        <div class="navbar-checkbox-group">
            <input type="checkbox" class="form-check-input" id="selectAll">
            <label class="navbar-label">{% trans "Select All" %}</label>
        </div>
        {% endif %}
        
        <!-- Search (pas sur Activity) -->
        {% if active_view != 'activity' %}
        <input type="text" id="searchInput" class="form-control-linguify" placeholder="{% trans 'Search tasks...' %}" style="width: 140px; min-width: 100px;">
        {% endif %}
        
        <!-- Project Filter (List view) -->
        {% if active_view == 'list' %}
        <div class="dropdown">
            <button id="projectFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="projectFilterText">{% trans "All Projects" %}</span>
            </button>
            <ul id="projectFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectProjectFilter('', '{% trans "All Projects" %}')">{% trans "All Projects" %}</a></li>
                {% for project in projects %}
                <li><a class="dropdown-item" href="#" onclick="selectProjectFilter('{{ project.id }}', '{{ project.name }}')">{{ project.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Stage Filter (List view) -->
        {% if active_view == 'list' %}
        <div class="dropdown">
            <button id="stageFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="stageFilterText">{% trans "All Stages" %}</span>
            </button>
            <ul id="stageFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectStageFilter('', '{% trans "All Stages" %}')">{% trans "All Stages" %}</a></li>
                {% for stage in stages %}
                <li><a class="dropdown-item" href="#" onclick="selectStageFilter('{{ stage.id }}', '{{ stage.name }}')">{{ stage.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Sort Filter Dropdown -->
        <div class="dropdown">
            <button id="sortFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="sortFilterText">{% trans "Recent" %}</span>
            </button>
            <ul id="sortFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('updated_desc', '{% trans "Recent" %}')">{% trans "Recent" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('title_asc', '{% trans "A-Z" %}')">{% trans "A-Z" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('priority_desc', '{% trans "Priority" %}')">{% trans "Priority" %}</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('due_date_asc', '{% trans "Due Date" %}')">{% trans "Due Date" %}</a></li>
            </ul>
        </div>
        
        <!-- Actions -->
        <div class="navbar-actions-group">
            <!-- Activity-specific actions removed - now integrated in main activity page -->
            
            <!-- Bulk Actions (List view only) -->
            {% if active_view == 'list' %}
            <button id="bulkActionsBtn" class="btn-navbar btn-navbar-outline" onclick="showBulkActionsMenu()" disabled title="{% trans 'Bulk Actions' %}">
                <i class="bi bi-check-all"></i>
                <span class="d-none d-xl-inline">{% trans "Bulk Actions" %}</span>
            </button>
            {% endif %}
            
            <a href="{% url 'saas_web:todo_settings' %}" id="configureTasks" class="btn-navbar btn-navbar-outline" title="{% trans 'Configure Todo Settings' %}">
                <i class="bi bi-gear"></i>
                <span class="d-none d-xxl-inline">{% trans "Configure" %}</span>
            </a>
        </div>
    </div>
</div>