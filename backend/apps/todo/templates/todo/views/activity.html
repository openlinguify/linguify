{% extends "todo/base.html" %}
{% load static %}
{% load i18n %}

{% block page_title %}Todo - Activity{% endblock %}

{% block header_content %}
{% include 'components/todo_navbar.html' with active_view='activity' %}
{% endblock %}

{% block content %}
<div class="todo-activity-workspace">
    <!-- Activity Content Container -->
    <div id="activity-content" class="activity-workspace-container">

        <!-- Enhanced Activity Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" 
             x-data="{ loaded: false }"
             x-init="setTimeout(() => loaded = true, 100)">
            
            <!-- Tasks Created Today -->
            <div class="form-card-linguify text-center"
                 x-show="loaded"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0">
                <div style="padding: 1.5rem;">
                    <div class="flex items-center justify-center mb-3">
                        <div style="width: 3rem; height: 3rem; background: var(--linguify-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-plus-circle" style="color: white; font-size: 1.25rem;"></i>
                        </div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--linguify-primary); margin-bottom: 0.5rem;">
                        {{ activity_stats.tasks_created_today|default:0 }}
                    </div>
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--linguify-gray); margin-bottom: 0.5rem;">
                        {% trans "Created Today" %}
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full transition-all duration-500" 
                             style="width: {% widthratio activity_stats.tasks_created_today 10 100 %}%"></div>
                    </div>
                </div>
            </div>

            <!-- Tasks Completed Today -->
            <div class="form-card-linguify text-center"
                 x-show="loaded"
                 x-transition:enter="transition ease-out duration-300 delay-100"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0">
                <div style="padding: 1.5rem;">
                    <div class="flex items-center justify-center mb-3">
                        <div style="width: 3rem; height: 3rem; background: var(--linguify-success); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-check-circle" style="color: white; font-size: 1.25rem;"></i>
                        </div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--linguify-success); margin-bottom: 0.5rem;">
                        {{ activity_stats.tasks_completed_today|default:0 }}
                    </div>
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--linguify-gray); margin-bottom: 0.5rem;">
                        {% trans "Completed Today" %}
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full transition-all duration-500" 
                             style="width: {% if activity_stats.tasks_created_today > 0 %}{% widthratio activity_stats.tasks_completed_today activity_stats.tasks_created_today 100 %}{% else %}0{% endif %}%"></div>
                    </div>
                </div>
            </div>

            <!-- Created This Week -->
            <div class="form-card-linguify text-center"
                 x-show="loaded"
                 x-transition:enter="transition ease-out duration-300 delay-200"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0">
                <div style="padding: 1.5rem;">
                    <div class="flex items-center justify-center mb-3">
                        <div style="width: 3rem; height: 3rem; background: var(--linguify-secondary); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-calendar-week" style="color: white; font-size: 1.25rem;"></i>
                        </div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--linguify-secondary); margin-bottom: 0.5rem;">
                        {{ activity_stats.tasks_created_this_week|default:0 }}
                    </div>
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--linguify-gray); margin-bottom: 0.5rem;">
                        {% trans "Created This Week" %}
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" 
                             style="width: {% widthratio activity_stats.tasks_created_this_week 30 100 %}%"></div>
                    </div>
                </div>
            </div>

            <!-- Completed This Week -->
            <div class="form-card-linguify text-center"
                 x-show="loaded"
                 x-transition:enter="transition ease-out duration-300 delay-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0">
                <div style="padding: 1.5rem;">
                    <div class="flex items-center justify-center mb-3">
                        <div style="width: 3rem; height: 3rem; background: var(--linguify-warning); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-trophy" style="color: white; font-size: 1.25rem;"></i>
                        </div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--linguify-warning); margin-bottom: 0.5rem;">
                        {{ activity_stats.tasks_completed_this_week|default:0 }}
                    </div>
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--linguify-gray); margin-bottom: 0.5rem;">
                        {% trans "Completed This Week" %}
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-amber-500 h-2 rounded-full transition-all duration-500" 
                             style="width: {% if activity_stats.tasks_created_this_week > 0 %}{% widthratio activity_stats.tasks_completed_this_week activity_stats.tasks_created_this_week 100 %}{% else %}0{% endif %}%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Activity Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Priority & Due Tasks -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Critical Alerts Section -->
                {% if overdue_tasks %}
                <div class="form-card-linguify overdue-alert" 
                     x-data="{ visible: true }" 
                     x-show="visible"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100">
                    <div class="alert-header">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="alert-icon bg-red-100 text-red-600">
                                    <i class="bi bi-exclamation-triangle-fill"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-red-800">{% trans "Overdue Tasks" %}</h3>
                                    <p class="text-sm text-red-600">{% trans "These tasks need immediate attention" %}</p>
                                </div>
                            </div>
                            <div class="badge bg-red-100 text-red-800">{{ overdue_tasks.count }}</div>
                        </div>
                    </div>
                    <div class="alert-content">
                        <div class="space-y-3">
                            {% for task in overdue_tasks|slice:":5" %}
                            <div class="task-item overdue-item group" 
                                 data-task-id="{{ task.id }}"
                                 x-data="{ completing: false }"
                                 :class="{ 'opacity-50 scale-95': completing }">
                                <div class="flex items-start space-x-3">
                                    <button class="task-checkbox overdue-checkbox" 
                                            hx-post="{% url 'todo:task_toggle_htmx' task.id %}"
                                            hx-target="[data-task-id='{{ task.id }}']"
                                            hx-swap="outerHTML"
                                            @htmx:before-request="completing = true"
                                            @htmx:after-swap="completing = false"
                                            title="{% trans 'Mark as Complete' %}"
                                            :disabled="completing">
                                        <i class="bi bi-circle text-red-500"></i>
                                    </button>
                                    <div class="flex-1 min-w-0">
                                        <div class="task-content">
                                            <h4 class="task-title text-gray-900 hover:text-red-600 cursor-pointer transition-colors"
                                                hx-get="{% url 'todo:task_form_modal_edit_htmx' task.id %}"
                                                hx-target="#task-modal-container"
                                                hx-trigger="click">
                                                {{ task.title }}
                                                {% if task.priority == '1' %}
                                                <span class="priority-star">
                                                    <i class="bi bi-star-fill text-amber-500"></i>
                                                </span>
                                                {% endif %}
                                            </h4>
                                            <div class="task-meta text-red-600">
                                                <span class="flex items-center space-x-1">
                                                    <i class="bi bi-clock"></i>
                                                    <span class="font-medium">{{ task.due_date|timesince }} {% trans "overdue" %}</span>
                                                </span>
                                                {% if task.project %}
                                                <span class="project-tag">{{ task.project.name }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="task-actions opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button class="action-btn" 
                                                hx-get="{% url 'todo:task_form_modal_edit_htmx' task.id %}"
                                                hx-target="#task-modal-container"
                                                title="{% trans 'Edit Task' %}">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            
                            {% if overdue_tasks.count > 5 %}
                            <div class="view-all">
                                <button class="view-all-btn text-red-600 hover:text-red-800" 
                                        hx-get="{% url 'todo:activity' %}?filter=overdue"
                                        hx-target="#activity-content">
                                    {% trans "View all" %} {{ overdue_tasks.count }} {% trans "overdue tasks" %}
                                    <i class="bi bi-arrow-right ml-1"></i>
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Due Today Section -->
                {% if due_today_tasks %}
                <div class="form-card-linguify today-section">
                    <div class="section-header">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="section-icon bg-amber-100 text-amber-600">
                                    <i class="bi bi-calendar-day"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800">{% trans "Due Today" %}</h3>
                                    <p class="text-sm text-gray-600">{% trans "Focus on these tasks today" %}</p>
                                </div>
                            </div>
                            <div class="badge bg-amber-100 text-amber-800">{{ due_today_tasks.count }}</div>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="space-y-3">
                            {% for task in due_today_tasks %}
                            <div class="task-item today-item group" data-task-id="{{ task.id }}">
                                <div class="flex items-start space-x-3">
                                    <button class="task-checkbox {% if task.state == '1_done' %}completed-checkbox{% else %}today-checkbox{% endif %}" 
                                            hx-post="{% url 'todo:task_toggle_htmx' task.id %}"
                                            hx-target="[data-task-id='{{ task.id }}']"
                                            hx-swap="outerHTML">
                                        {% if task.state == '1_done' %}
                                        <i class="bi bi-check-circle-fill text-green-500"></i>
                                        {% else %}
                                        <i class="bi bi-circle text-amber-500"></i>
                                        {% endif %}
                                    </button>
                                    <div class="flex-1 min-w-0">
                                        <div class="task-content">
                                            <h4 class="task-title {% if task.state == '1_done' %}line-through text-gray-500{% else %}text-gray-900 hover:text-amber-600{% endif %} cursor-pointer transition-colors"
                                                hx-get="{% url 'todo:task_form_modal_edit_htmx' task.id %}"
                                                hx-target="#task-modal-container"
                                                hx-trigger="click">
                                                {{ task.title }}
                                                {% if task.priority == '1' %}
                                                <span class="priority-star">
                                                    <i class="bi bi-star-fill text-amber-500"></i>
                                                </span>
                                                {% endif %}
                                            </h4>
                                            <div class="task-meta text-amber-600">
                                                <span class="flex items-center space-x-1">
                                                    <i class="bi bi-clock"></i>
                                                    <span>
                                                        {% if task.due_date.time %}
                                                        {{ task.due_date|time:"H:i" }}
                                                        {% else %}
                                                        {% trans "All day" %}
                                                        {% endif %}
                                                    </span>
                                                </span>
                                                {% if task.project %}
                                                <span class="project-tag">{{ task.project.name }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="task-actions opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button class="action-btn" 
                                                hx-get="{% url 'todo:task_form_modal_edit_htmx' task.id %}"
                                                hx-target="#task-modal-container"
                                                title="{% trans 'Edit Task' %}">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Due This Week Section -->
                {% if due_week_tasks %}
                <div class="form-card-linguify week-section">
                    <div class="section-header">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="section-icon bg-blue-100 text-blue-600">
                                    <i class="bi bi-calendar-week"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800">{% trans "Due This Week" %}</h3>
                                    <p class="text-sm text-gray-600">{% trans "Plan ahead for the week" %}</p>
                                </div>
                            </div>
                            <div class="badge bg-blue-100 text-blue-800">{{ due_week_tasks.count }}</div>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="space-y-2">
                            {% for task in due_week_tasks|slice:":8" %}
                            <div class="task-item week-item group compact" data-task-id="{{ task.id }}">
                                <div class="flex items-center space-x-3">
                                    <button class="task-checkbox {% if task.state == '1_done' %}completed-checkbox{% else %}week-checkbox{% endif %}" 
                                            hx-post="{% url 'todo:task_toggle_htmx' task.id %}"
                                            hx-target="[data-task-id='{{ task.id }}']"
                                            hx-swap="outerHTML">
                                        {% if task.state == '1_done' %}
                                        <i class="bi bi-check-circle-fill text-green-500"></i>
                                        {% else %}
                                        <i class="bi bi-circle text-blue-500"></i>
                                        {% endif %}
                                    </button>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between">
                                            <h4 class="task-title compact {% if task.state == '1_done' %}line-through text-gray-500{% else %}text-gray-900 hover:text-blue-600{% endif %} cursor-pointer transition-colors"
                                                hx-get="{% url 'todo:task_form_modal_edit_htmx' task.id %}"
                                                hx-target="#task-modal-container"
                                                hx-trigger="click">
                                                {{ task.title|truncatechars:40 }}
                                                {% if task.priority == '1' %}
                                                <span class="priority-star small">
                                                    <i class="bi bi-star-fill text-amber-500"></i>
                                                </span>
                                                {% endif %}
                                            </h4>
                                            <div class="task-date">
                                                <span class="text-xs text-blue-600 font-medium">{{ task.due_date|date:"M d" }}</span>
                                            </div>
                                        </div>
                                        {% if task.project %}
                                        <div class="project-tag small">{{ task.project.name }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            
                            {% if due_week_tasks.count > 8 %}
                            <div class="view-all">
                                <button class="view-all-btn text-blue-600 hover:text-blue-800" 
                                        hx-get="{% url 'todo:activity' %}?filter=week"
                                        hx-target="#activity-content">
                                    {% trans "View all" %} {{ due_week_tasks.count }} {% trans "tasks this week" %}
                                    <i class="bi bi-arrow-right ml-1"></i>
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Right Column - Activity Timeline -->
            <div class="space-y-6">
                <!-- Activity Timeline -->
                <div class="form-card-linguify">
                    <div class="timeline-header">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="bi bi-clock-history text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800">{% trans "Recent Activity" %}</h3>
                                    <p class="text-xs text-gray-500">{% trans "Latest updates and changes" %}</p>
                                </div>
                            </div>
                            <button class="px-3 py-1.5 text-sm text-indigo-600 hover:text-indigo-800 font-medium bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors"
                                    hx-get="{% url 'todo:activity_timeline_htmx' %}"
                                    hx-target="#timeline-content"
                                    hx-swap="innerHTML">
                                {% trans "View all" %}
                                <i class="bi bi-arrow-right ml-1"></i>
                            </button>
                        </div>
                        
                        <!-- Timeline Filter Tabs -->
                        <div class="timeline-tabs mb-6" x-data="{ activeFilter: 'all' }">
                            <div class="inline-flex bg-gray-100 rounded-xl p-1 shadow-inner">
                                <button class="tab-btn" 
                                        :class="{ 'active': activeFilter === 'all' }"
                                        @click="activeFilter = 'all'"
                                        hx-get="{% url 'todo:activity_timeline_htmx' %}?filter=all"
                                        hx-target="#timeline-content"
                                        hx-swap="innerHTML">
                                    <i class="bi bi-list-ul mr-2"></i>
                                    {% trans "All" %}
                                </button>
                                <button class="tab-btn" 
                                        :class="{ 'active': activeFilter === 'completed' }"
                                        @click="activeFilter = 'completed'"
                                        hx-get="{% url 'todo:activity_timeline_htmx' %}?filter=completed"
                                        hx-target="#timeline-content"
                                        hx-swap="innerHTML">
                                    <i class="bi bi-check-circle mr-2"></i>
                                    {% trans "Completed" %}
                                </button>
                                <button class="tab-btn" 
                                        :class="{ 'active': activeFilter === 'created' }"
                                        @click="activeFilter = 'created'"
                                        hx-get="{% url 'todo:activity_timeline_htmx' %}?filter=created"
                                        hx-target="#timeline-content"
                                        hx-swap="innerHTML">
                                    <i class="bi bi-plus-circle mr-2"></i>
                                    {% trans "Created" %}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="timeline-content" class="timeline-content" 
                         hx-get="{% url 'todo:activity_timeline_htmx' %}" 
                         hx-trigger="load"
                         hx-swap="innerHTML">
                        <!-- Timeline will be loaded here via HTMX -->
                        <div class="space-y-4">
                            <!-- Loading placeholder -->
                            <div class="text-center py-8">
                                <i class="bi bi-arrow-repeat animate-spin text-gray-400 text-2xl"></i>
                                <p class="text-gray-500 text-sm mt-2">{% trans "Loading activity..." %}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Productivity Insights -->
                <div class="form-card-linguify">
                    <div class="insights-header">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">{% trans "Productivity Insights" %}</h3>
                    </div>
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-icon bg-purple-100 text-purple-600">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <div class="insight-content">
                                <div class="insight-value">
                                    {% if activity_stats.tasks_created_today > 0 %}
                                        {% widthratio activity_stats.tasks_completed_today activity_stats.tasks_created_today 100 %}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </div>
                                <div class="insight-label">{% trans "Today's completion rate" %}</div>
                            </div>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-icon bg-emerald-100 text-emerald-600">
                                <i class="bi bi-trophy"></i>
                            </div>
                            <div class="insight-content">
                                <div class="insight-value">{{ activity_stats.tasks_completed_this_week|default:0 }}</div>
                                <div class="insight-label">{% trans "Week streak" %}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Activity Workspace - Linguify Design System */
.todo-activity-workspace {
    min-height: calc(100vh - 120px);
    background: var(--linguify-bg-secondary);
    padding: 2rem;
}

.activity-workspace-container {
    max-width: 1280px;
    margin: 0 auto;
}

/* Section Headers */
.alert-header,
.section-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-bottom: 1px solid var(--linguify-border);
}

.alert-content,
.section-content {
    padding: 1.5rem;
}

.alert-icon,
.section-icon {
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    font-size: 1.25rem;
}

.badge {
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
}

/* Task Items */
.task-item {
    padding: 1rem;
    border-radius: 12px;
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.task-item:hover {
    background-color: var(--linguify-bg-hover);
    border-color: var(--linguify-border);
    transform: translateX(4px);
}

.task-item.compact {
    padding: 0.75rem;
}

.task-checkbox {
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    border: none;
    background: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    transition: all 0.2s ease;
    cursor: pointer;
}

.task-checkbox:hover {
    transform: scale(1.1);
}

.task-title {
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.5;
    margin-bottom: 0.25rem;
}

.task-title.compact {
    font-size: 0.875rem;
    margin-bottom: 0;
}

.task-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    font-weight: 500;
    margin-top: 0.25rem;
}

.project-tag {
    background: var(--linguify-bg-secondary);
    color: var(--linguify-text-secondary);
    padding: 0.125rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.625rem;
    font-weight: 600;
}

.project-tag.small {
    font-size: 0.5rem;
    padding: 0.0625rem 0.375rem;
}

.priority-star {
    display: inline-flex;
    align-items: center;
}

.priority-star.small {
    font-size: 0.75rem;
}

.task-actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.action-btn {
    width: 2rem;
    height: 2rem;
    border-radius: 0.5rem;
    border: none;
    background: var(--linguify-bg-secondary);
    color: var(--linguify-text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    cursor: pointer;
}

.action-btn:hover {
    background: var(--linguify-bg-hover);
    color: var(--linguify-text-primary);
}

.view-all {
    text-align: center;
    padding-top: 1rem;
    border-top: 1px solid var(--linguify-border);
    margin-top: 1rem;
}

.view-all-btn {
    background: none;
    border: none;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

/* Timeline Styles */
.timeline-header {
    padding: 1.5rem;
}

.timeline-tabs {
    display: flex;
}

.tab-btn {
    flex: 1;
    padding: 0.5rem 1rem;
    border: none;
    background: transparent;
    color: var(--linguify-text-secondary);
    font-size: 0.875rem;
    font-weight: 600;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    cursor: pointer;
}

.tab-btn.active,
.tab-btn:hover {
    background: white;
    color: var(--linguify-text-primary);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.timeline-content {
    padding: 1.5rem;
}

.timeline-item {
    display: flex;
    gap: 1rem;
    position: relative;
    padding-bottom: 1rem;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 1rem;
    top: 2.5rem;
    bottom: 0;
    width: 2px;
    background: var(--linguify-border);
    transform: translateX(-50%);
}

.timeline-marker {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
}

.timeline-content-wrapper {
    flex: 1;
    min-width: 0;
}

.timeline-header-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
}

.timeline-action {
    font-size: 0.75rem;
    font-weight: 600;
}

.timeline-time {
    font-size: 0.625rem;
    color: var(--linguify-text-muted);
}

.timeline-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--linguify-text-primary);
    line-height: 1.4;
    margin-bottom: 0.25rem;
}

.timeline-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.project-badge {
    background: #dbeafe;
    color: #1e40af;
    padding: 0.125rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.625rem;
    font-weight: 600;
}

.empty-timeline {
    text-align: center;
    padding: 2rem;
    color: var(--linguify-text-muted);
}

/* Insights */
.insights-header {
    padding: 1.5rem;
    padding-bottom: 0;
}

.insights-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    padding: 1rem 1.5rem 1.5rem;
}

.insight-card {
    background: var(--linguify-bg-secondary);
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.2s ease;
}

.insight-card:hover {
    background: var(--linguify-bg-hover);
    transform: translateY(-1px);
}

.insight-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
}

.insight-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--linguify-text-primary);
    line-height: 1;
}

.insight-label {
    font-size: 0.75rem;
    color: var(--linguify-text-secondary);
    font-weight: 600;
    margin-top: 0.25rem;
}

/* Responsive */
@media (max-width: 1024px) {
    .todo-activity-workspace {
        padding: 1rem;
    }
    
    .insights-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 640px) {
    .timeline-item {
        gap: 0.75rem;
    }
    
    .timeline-marker {
        width: 1.5rem;
        height: 1.5rem;
    }
}

/* Animation */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.task-item,
.timeline-item {
    animation: slideInUp 0.3s ease-out;
}

/* Loading States */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.animate-spin {
    animation: spin 1s linear infinite;
}

/* Focus States */
.task-checkbox:focus,
.action-btn:focus,
.tab-btn:focus {
    outline: 2px solid var(--linguify-primary);
    outline-offset: 2px;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// HTMX enhancements for activity page
document.body.addEventListener('htmx:afterSwap', function(e) {
    // Show success notification for task updates
    if (e.detail.target.hasAttribute('data-task-id')) {
        // Simple notification
        const notification = document.createElement('div');
        notification.innerHTML = `
            <div class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300">
                <i class="bi bi-check-circle mr-2"></i>{% trans "Task updated!" %}
            </div>
        `;
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
});
</script>
{% endblock %}