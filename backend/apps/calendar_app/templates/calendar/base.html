{% extends 'saas_web/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ page_title|default:"Calendar" }} - Linguify{% endblock %}

{% block extra_css %}
    <!-- CSS spÃ©cifique au calendrier -->
    <link rel="stylesheet" href="{% static 'calendar/css/calendar.css' %}">
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    
    <!-- Override for Linguify design system variables -->
    <style>
        :root {
            --linguify-primary: #2D5BBA;
            --linguify-secondary: #8B5CF6;
            --linguify-accent: #00D4AA;
            --linguify-gray: #6B7280;
            --linguify-primary-light: #4F7BD9;
            --linguify-primary-dark: #1E4A8C;
            --linguify-secondary-light: #A78BFA;
            --linguify-secondary-dark: #7C3AED;
            --linguify-accent-light: #26E4B8;
            --linguify-accent-dark: #00B894;
            --linguify-success: #10B981;
            --linguify-warning: #F59E0B;
            --linguify-error: #EF4444;
            --linguify-white: #FFFFFF;
            --linguify-gray-50: #F9FAFB;
            --linguify-gray-100: #F3F4F6;
            --linguify-gray-200: #E5E7EB;
            --linguify-gray-300: #D1D5DB;
            --linguify-gray-700: #374151;
            --linguify-gradient: linear-gradient(135deg, #2D5BBA 0%, #00D4AA 100%);
            --header-height: 64px;
        }
    </style>
    
    {% block extra_calendar_css %}{% endblock %}
{% endblock %}

{% block content %}
    <!-- Include calendar-specific header navigation -->
    {% include 'calendar/components/calendar_header.html' %}
    
    <!-- Main Content Container -->
    <div class="calendar-container">
        {% block calendar_content %}
        <!-- Content will be provided by child templates -->
        {% endblock %}
    </div>
{% endblock %}

{% block extra_js %}
    <!-- Simple Calendar Fallback -->
    <script src="{% static 'calendar/js/simple-calendar.js' %}"></script>
    
    <!-- Try to load FullCalendar from CDN -->
    <script>
        function loadFullCalendar() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js';
                script.onload = () => {
                    console.log('FullCalendar loaded successfully');
                    resolve(true);
                };
                script.onerror = () => {
                    console.warn('FullCalendar failed to load from CDN, using fallback');
                    resolve(false);
                };
                document.head.appendChild(script);
            });
        }
        
        window.calendarLoaded = loadFullCalendar();
    </script>
    
    <!-- Calendar Base Services -->
    <script src="{% static 'calendar/js/base.js' %}"></script>
    
    <!-- Calendar Navigation -->
    <script src="{% static 'calendar/js/navbar.js' %}"></script>
    
    <!-- Dynamic Configuration from Django -->
    <script>
        // Set dynamic configuration from Django template
        window.DEBUG = {{ debug|yesno:"true,false" }};
        window.API_BASE_URL = '{{ api_base_url }}';
        
        // User data
        {% if user.is_authenticated %}
        window.USER_DATA = {{ user_data|safe }};
        window.currentUserId = {{ user.id }};
        window.currentUsername = '{{ user.username }}';
        {% else %}
        window.USER_DATA = null;
        window.currentUserId = undefined;
        window.currentUsername = undefined;
        console.log('[Calendar] User not authenticated');
        {% endif %}
        
        // Calendar specific configuration
        window.CALENDAR_CONFIG = {
            ...window.CALENDAR_CONFIG,
            apiBaseUrl: '{{ api_base_url }}',
            {% if event_id %}eventId: {{ event_id }},{% endif %}
            {% if view_type %}viewType: '{{ view_type }}',{% endif %}
            locale: '{{ LANGUAGE_CODE|default:"en" }}',
            timezone: '{{ timezone|default:"UTC" }}'
        };
    </script>
    
    {% block calendar_extra_js %}{% endblock %}
{% endblock %}