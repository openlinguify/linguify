{% load i18n %}
<!-- Calendar Navigation Bar - Structure identique à community et revision -->
<div class="calendar-navbar-container d-flex align-items-center justify-content-between gap-2">
    <!-- Gauche: Navigation + Actions principales -->
    <div class="d-flex align-items-center gap-3">
        <!-- Navigation tabs -->
        <div class="d-flex align-items-center gap-1">
            <a href="{% url 'calendar:main' %}" 
               class="nav-tab {% if request.resolver_match.url_name == 'main' %}active{% endif %}">
                <i class="bi bi-calendar-month me-1"></i>
                {% trans "Calendar" %}
            </a>
            <a href="{% url 'calendar:agenda' %}" 
               class="nav-tab {% if request.resolver_match.url_name == 'agenda' %}active{% endif %}">
                <i class="bi bi-list-ul me-1"></i>
                {% trans "Agenda" %}
            </a>
            <a href="{% url 'calendar:providers' %}" 
               class="nav-tab {% if request.resolver_match.url_name == 'providers' %}active{% endif %}">
                <i class="bi bi-cloud me-1"></i>
                {% trans "Providers" %}
            </a>
            <a href="{% url 'calendar:settings' %}" 
               class="nav-tab {% if request.resolver_match.url_name == 'settings' %}active{% endif %}">
                <i class="bi bi-gear me-1"></i>
                {% trans "Settings" %}
            </a>
        </div>
        
        <!-- Refresh -->
        <button id="refreshCalendar" class="btn-outline-custom btn-sm">
            <i class="bi bi-arrow-clockwise"></i>
            <span class="d-none d-xl-inline ms-1">{% trans "Refresh" %}</span>
        </button>
    </div>
    
    <!-- Droite: Actions et filtres contextuels -->
    <div class="d-flex align-items-center gap-1 flex-nowrap">
        {% if request.resolver_match.url_name == 'main' %}
        <!-- Filtres pour la vue calendrier -->
        <div class="calendar-view-switcher d-flex gap-1">
            <button class="btn btn-sm btn-outline-secondary view-btn active" data-view="month">
                <i class="bi bi-calendar3 me-1"></i>
                <span class="d-none d-lg-inline">{% trans "Month" %}</span>
            </button>
            <button class="btn btn-sm btn-outline-secondary view-btn" data-view="week">
                <i class="bi bi-calendar-week me-1"></i>
                <span class="d-none d-lg-inline">{% trans "Week" %}</span>
            </button>
            <button class="btn btn-sm btn-outline-secondary view-btn" data-view="day">
                <i class="bi bi-calendar-day me-1"></i>
                <span class="d-none d-lg-inline">{% trans "Day" %}</span>
            </button>
        </div>
        
        <!-- Bouton aujourd'hui -->
        <button id="todayBtn" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-dot me-1"></i>
            {% trans "Today" %}
        </button>
        
        {% elif request.resolver_match.url_name == 'agenda' %}
        <!-- Filtres pour la vue agenda -->
        <select id="agendaFilter" class="form-select form-select-sm" style="width: 140px; min-width: 120px;">
            <option value="">{% trans "All Events" %}</option>
            <option value="today">{% trans "Today" %}</option>
            <option value="week">{% trans "This Week" %}</option>
            <option value="month">{% trans "This Month" %}</option>
        </select>
        
        <select id="eventTypeFilter" class="form-select form-select-sm" style="width: 120px; min-width: 100px;">
            <option value="">{% trans "All Types" %}</option>
            <option value="meeting">{% trans "Meeting" %}</option>
            <option value="personal">{% trans "Personal" %}</option>
            <option value="work">{% trans "Work" %}</option>
            <option value="reminder">{% trans "Reminder" %}</option>
        </select>
        
        {% elif request.resolver_match.url_name == 'providers' %}
        <!-- Filtres pour la page Providers -->
        <select id="providerTypeFilter" class="form-select form-select-sm" style="width: 140px; min-width: 120px;">
            <option value="">{% trans "All Providers" %}</option>
            <option value="google">Google Calendar</option>
            <option value="outlook">Outlook</option>
            <option value="caldav">CalDAV</option>
            <option value="apple">Apple iCloud</option>
        </select>
        
        <select id="syncStatusFilter" class="form-select form-select-sm" style="width: 120px; min-width: 100px;">
            <option value="">{% trans "All Status" %}</option>
            <option value="connected">{% trans "Connected" %}</option>
            <option value="disconnected">{% trans "Disconnected" %}</option>
            <option value="error">{% trans "Error" %}</option>
        </select>
        
        <!-- Bouton ajouter provider -->
        <button class="btn-gradient btn-sm px-2" data-bs-toggle="modal" data-bs-target="#addProviderModal">
            <i class="bi bi-plus-lg"></i>
            <span class="d-none d-xxl-inline ms-1">{% trans "Add Provider" %}</span>
        </button>
        
        {% elif request.resolver_match.url_name == 'settings' %}
        <!-- Actions pour la page Settings -->
        <button id="exportSettings" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-download me-1"></i>
            <span class="d-none d-lg-inline">{% trans "Export" %}</span>
        </button>
        
        <button id="importSettings" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-upload me-1"></i>
            <span class="d-none d-lg-inline">{% trans "Import" %}</span>
        </button>
        
        {% else %}
        <!-- Actions générales -->
        <a href="{% url 'calendar:import_export' %}" class="btn-outline-custom btn-sm px-2">
            <i class="bi bi-arrow-down-up"></i>
            <span class="d-none d-xxl-inline ms-1">{% trans "Import/Export" %}</span>
        </a>
        
        <a href="{% url 'calendar:email_templates' %}" class="btn-outline-custom btn-sm px-2">
            <i class="bi bi-envelope-paper"></i>
            <span class="d-none d-xxl-inline ms-1">{% trans "Templates" %}</span>
        </a>
        {% endif %}
        
        <!-- Bouton créer événement - toujours présent -->
        <button class="btn-gradient btn-sm px-2" data-bs-toggle="modal" data-bs-target="#createEventModal">
            <i class="bi bi-plus-lg"></i>
            <span class="d-none d-xxl-inline ms-1">{% trans "New Event" %}</span>
        </button>
    </div>
</div>

<!-- Styles intégrés pour la navbar calendar -->
<style>
.calendar-navbar-container {
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
}

.nav-tab {
    display: flex;
    align-items: center;
    padding: 0.5rem 1rem;
    color: #64748b;
    text-decoration: none;
    border-radius: 0.5rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: 1px solid transparent;
}

.nav-tab:hover {
    color: #334155;
    background-color: #f1f5f9;
    text-decoration: none;
}

.nav-tab.active {
    color: #667eea;
    background-color: #eef2ff;
    border-color: #c7d2fe;
}

.btn-outline-custom {
    border: 1px solid #e2e8f0;
    color: #64748b;
    background: white;
    transition: all 0.2s ease;
}

.btn-outline-custom:hover {
    border-color: #cbd5e1;
    color: #334155;
    background-color: #f8fafc;
}

.btn-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    transition: all 0.2s ease;
}

.btn-gradient:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    color: white;
}

.view-btn.active {
    background-color: #667eea;
    border-color: #667eea;
    color: white;
}

.search-input {
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
}

.search-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.form-select {
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
}

.form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Refresh functionality
    const refreshBtn = document.getElementById('refreshCalendar');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            location.reload();
        });
    }
    
    // Calendar view switcher
    const viewBtns = document.querySelectorAll('.view-btn');
    viewBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons
            viewBtns.forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            // Trigger calendar view change if calendar is present
            const view = this.dataset.view;
            if (window.calendar && window.calendar.changeView) {
                window.calendar.changeView(view + 'Grid');
            }
        });
    });
    
    // Today button
    const todayBtn = document.getElementById('todayBtn');
    if (todayBtn) {
        todayBtn.addEventListener('click', function() {
            if (window.calendar && window.calendar.today) {
                window.calendar.today();
            }
        });
    }
    
    // Filter functionality
    const filters = document.querySelectorAll('.form-select');
    filters.forEach(filter => {
        filter.addEventListener('change', function() {
            const filterValue = this.value;
            const filterId = this.id;
            
            // Implement filter logic based on filter type
            console.log('Filter changed:', filterId, filterValue);
            
            // This would be implemented based on the specific page needs
            // Could trigger AJAX calls to update content
        });
    });
    
    // Export/Import functionality
    const exportBtn = document.getElementById('exportSettings');
    if (exportBtn) {
        exportBtn.addEventListener('click', function() {
            // Implement export functionality
            console.log('Export settings clicked');
        });
    }
    
    const importBtn = document.getElementById('importSettings');
    if (importBtn) {
        importBtn.addEventListener('click', function() {
            // Implement import functionality
            console.log('Import settings clicked');
        });
    }
});
</script>