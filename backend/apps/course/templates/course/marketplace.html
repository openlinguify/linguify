{% extends 'saas_web/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'course/css/learning-app.css' %}">
<style>
.marketplace-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.marketplace-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
}

.marketplace-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 4px solid #667eea;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-label {
    color: #666;
    font-size: 0.9rem;
}

.courses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.course-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #f0f0f0;
}

.course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.course-header {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    padding: 20px;
    position: relative;
}

.course-level {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
}

.course-title {
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 8px;
    margin-top: 15px;
}

.course-teacher {
    opacity: 0.9;
    font-size: 0.9rem;
}

.course-content {
    padding: 20px;
}

.course-description {
    color: #666;
    margin-bottom: 15px;
    line-height: 1.5;
}

.course-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

.course-price {
    font-size: 1.2rem;
    font-weight: bold;
}

.price-free {
    color: #28a745;
}

.price-paid {
    color: #667eea;
}

.course-actions {
    display: flex;
    gap: 10px;
}

.btn-enroll {
    flex: 1;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-enroll:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    color: white;
    text-decoration: none;
}

.btn-enroll.free {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.btn-enroll.free:hover {
    background: linear-gradient(135deg, #218838 0%, #17a085 100%);
}

.section-title {
    font-size: 1.8rem;
    font-weight: bold;
    margin: 40px 0 20px 0;
    color: #333;
    border-bottom: 3px solid #667eea;
    padding-bottom: 10px;
}

.level-section {
    margin-bottom: 40px;
}

.level-header {
    background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    color: #333;
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-weight: bold;
    font-size: 1.2rem;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.3;
}

.filter-bar {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.filter-options {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.filter-label {
    font-weight: bold;
    color: #333;
}

.filter-select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 0.9rem;
}
</style>
{% endblock %}

{% block content %}
<div class="marketplace-container">
    <!-- Header -->
    <div class="marketplace-header">
        <h1>üéì Marketplace Linguify</h1>
        <p>D√©couvrez les cours cr√©√©s par nos professeurs experts</p>
    </div>

    <!-- Statistiques -->
    <div class="marketplace-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_courses }}</div>
            <div class="stat-label">Cours disponibles</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ free_courses }}</div>
            <div class="stat-label">Cours gratuits</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ teachers_count }}</div>
            <div class="stat-label">Professeurs</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ levels_available|length }}</div>
            <div class="stat-label">Niveaux</div>
        </div>
    </div>

    <!-- Filtres -->
    <div class="filter-bar">
        <div class="filter-options">
            <span class="filter-label">Filtrer par:</span>
            <select class="filter-select" id="levelFilter">
                <option value="all">Tous les niveaux</option>
                {% for level in levels_available %}
                <option value="{{ level }}">{{ level }}</option>
                {% endfor %}
            </select>
            <select class="filter-select" id="priceFilter">
                <option value="all">Tous les prix</option>
                <option value="free">Gratuits uniquement</option>
                <option value="paid">Payants uniquement</option>
            </select>
        </div>
    </div>

    {% if courses %}
        <!-- Affichage par niveau -->
        {% for level, level_courses in courses_by_level.items %}
        <div class="level-section" data-level="{{ level }}">
            <div class="level-header">
                üìö Niveau {{ level }} ({{ level_courses|length }} cours)
            </div>
            
            <div class="courses-grid">
                {% for course in level_courses %}
                <div class="course-card" data-level="{{ course.level }}" data-price="{% if course.is_free %}free{% else %}paid{% endif %}">
                    <div class="course-header">
                        <div class="course-level">{{ course.level }}</div>
                        <div class="course-title">{{ course.title }}</div>
                        <div class="course-teacher">üë®‚Äçüè´ {{ course.teacher_name }}</div>
                    </div>
                    
                    <div class="course-content">
                        <div class="course-description">
                            {{ course.description|default:"D√©couvrez ce cours pour am√©liorer vos comp√©tences linguistiques." }}
                        </div>
                        
                        <div class="course-meta">
                            <div class="course-price">
                                {% if course.is_free %}
                                    <span class="price-free">GRATUIT</span>
                                {% else %}
                                    <span class="price-paid">{{ course.price }}‚Ç¨</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="course-actions">
                            <a href="{% url 'course:enroll-course' course.id %}" 
                               class="btn-enroll {% if course.is_free %}free{% endif %}">
                                {% if course.is_free %}
                                    üéâ S'inscrire gratuitement
                                {% else %}
                                    üí≥ Acheter le cours
                                {% endif %}
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <i class="fas fa-book-open"></i>
            <h3>Aucun cours disponible</h3>
            <p>Les cours appara√Ætront ici une fois synchronis√©s depuis le CMS.</p>
            <p>Demandez aux professeurs de publier leurs cours !</p>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const levelFilter = document.getElementById('levelFilter');
    const priceFilter = document.getElementById('priceFilter');
    
    function filterCourses() {
        const levelValue = levelFilter.value;
        const priceValue = priceFilter.value;
        
        const courseCards = document.querySelectorAll('.course-card');
        const levelSections = document.querySelectorAll('.level-section');
        
        courseCards.forEach(card => {
            const cardLevel = card.getAttribute('data-level');
            const cardPrice = card.getAttribute('data-price');
            
            let showCard = true;
            
            // Filter by level
            if (levelValue !== 'all' && cardLevel !== levelValue) {
                showCard = false;
            }
            
            // Filter by price
            if (priceValue !== 'all' && cardPrice !== priceValue) {
                showCard = false;
            }
            
            card.style.display = showCard ? 'block' : 'none';
        });
        
        // Hide/show level sections based on visible cards
        levelSections.forEach(section => {
            const visibleCards = section.querySelectorAll('.course-card[style="display: block"], .course-card:not([style*="display: none"])');
            section.style.display = visibleCards.length > 0 ? 'block' : 'none';
        });
    }
    
    levelFilter.addEventListener('change', filterCourses);
    priceFilter.addEventListener('change', filterCourses);
});
</script>
{% endblock %}