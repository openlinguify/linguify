<!-- AI Model Settings Section -->
<div class="content-section">
    <div class="section-header">
        <h3 class="section-title">
            <i class="bi bi-cpu"></i>
            Modèle d'IA
        </h3>
    </div>
    <div class="section-content">
        <form id="language-ai-settings-form" method="post">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Modèle d'IA</label>
                    <select name="ai_model" class="form-control">
                        <option value="gpt-3.5-turbo" {% if language_ai_settings.ai_model == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo</option>
                        <option value="gpt-4" {% if language_ai_settings.ai_model == 'gpt-4' %}selected{% endif %}>GPT-4</option>
                        <option value="claude-3" {% if language_ai_settings.ai_model == 'claude-3' %}selected{% endif %}>Claude 3</option>
                        <option value="local" {% if language_ai_settings.ai_model == 'local' %}selected{% endif %}>Modèle local</option>
                    </select>
                    <div class="form-help">Choisissez le modèle d'IA pour l'assistance linguistique</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Style de réponse</label>
                    <select name="response_style" class="form-control">
                        <option value="formal" {% if language_ai_settings.response_style == 'formal' %}selected{% endif %}>Formel</option>
                        <option value="balanced" {% if language_ai_settings.response_style == 'balanced' %}selected{% endif %}>Équilibré</option>
                        <option value="casual" {% if language_ai_settings.response_style == 'casual' %}selected{% endif %}>Décontracté</option>
                        <option value="academic" {% if language_ai_settings.response_style == 'academic' %}selected{% endif %}>Académique</option>
                    </select>
                    <div class="form-help">Ton et style des réponses de l'IA</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Niveau de difficulté</label>
                    <select name="difficulty_level" class="form-control">
                        <option value="beginner" {% if language_ai_settings.difficulty_level == 'beginner' %}selected{% endif %}>Débutant</option>
                        <option value="intermediate" {% if language_ai_settings.difficulty_level == 'intermediate' %}selected{% endif %}>Intermédiaire</option>
                        <option value="advanced" {% if language_ai_settings.difficulty_level == 'advanced' %}selected{% endif %}>Avancé</option>
                        <option value="native" {% if language_ai_settings.difficulty_level == 'native' %}selected{% endif %}>Natif</option>
                    </select>
                    <div class="form-help">Adaptez les explications à votre niveau</div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Language Features Section -->
<div class="content-section">
    <div class="section-header">
        <h3 class="section-title">
            <i class="bi bi-translate"></i>
            Fonctionnalités linguistiques
        </h3>
    </div>
    <div class="section-content">
        <form method="post">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="auto_correct" {% if language_ai_settings.auto_correct %}checked{% endif %}>
                        Correction automatique
                    </label>
                    <div class="form-help">Corriger automatiquement les erreurs de grammaire et d'orthographe</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="grammar_check" {% if language_ai_settings.grammar_check %}checked{% endif %}>
                        Vérification grammaticale
                    </label>
                    <div class="form-help">Analyser et suggérer des améliorations grammaticales</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="translation_enabled" {% if language_ai_settings.translation_enabled %}checked{% endif %}>
                        Traduction instantanée
                    </label>
                    <div class="form-help">Proposer des traductions en temps réel</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="context_learning" {% if language_ai_settings.context_learning %}checked{% endif %}>
                        Apprentissage contextuel
                    </label>
                    <div class="form-help">L'IA apprend de vos interactions pour s'améliorer</div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- AI Behavior Section -->
<div class="content-section">
    <div class="section-header">
        <h3 class="section-title">
            <i class="bi bi-gear"></i>
            Comportement de l'IA
        </h3>
    </div>
    <div class="section-content">
        <div class="behavior-options">
            <div class="behavior-card" data-behavior="helpful">
                <div class="behavior-icon">
                    <i class="bi bi-lightbulb"></i>
                </div>
                <div class="behavior-content">
                    <h4>Assistant serviable</h4>
                    <p>L'IA fournit des explications détaillées et des conseils pratiques</p>
                </div>
            </div>
            
            <div class="behavior-card" data-behavior="concise">
                <div class="behavior-icon">
                    <i class="bi bi-lightning"></i>
                </div>
                <div class="behavior-content">
                    <h4>Réponses concises</h4>
                    <p>L'IA donne des réponses courtes et directes</p>
                </div>
            </div>
            
            <div class="behavior-card" data-behavior="interactive">
                <div class="behavior-icon">
                    <i class="bi bi-chat-dots"></i>
                </div>
                <div class="behavior-content">
                    <h4>Mode interactif</h4>
                    <p>L'IA pose des questions pour mieux vous aider</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Button -->
<div class="content-section">
    <div class="section-content">
        <div class="btn-group">
            <button type="button" class="btn-primary" onclick="saveLanguageAISettings()">
                <i class="bi bi-save"></i>
                Enregistrer les paramètres
            </button>
            <button type="button" class="btn-secondary" onclick="resetLanguageAISettings()">
                <i class="bi bi-arrow-counterclockwise"></i>
                Réinitialiser
            </button>
        </div>
    </div>
</div>

<style>
.content-section {
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    margin-bottom: 20px;
}

.section-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e9ecef;
    background: #f8f9fa;
    border-radius: 8px 8px 0 0;
}

.section-title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.section-content {
    padding: 24px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-weight: 500;
    margin-bottom: 8px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-control {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.form-help {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
}

.behavior-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
}

.behavior-card {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
}

.behavior-card:hover {
    border-color: #875a7b;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.behavior-card.active {
    border-color: #875a7b;
    background: #f8f4f7;
}

.behavior-icon {
    font-size: 24px;
    color: #875a7b;
    margin-bottom: 12px;
}

.behavior-content h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.behavior-content p {
    margin: 0;
    font-size: 14px;
    color: #666;
    line-height: 1.4;
}

.btn-group {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.btn-primary, .btn-secondary {
    padding: 10px 20px;
    border-radius: 6px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-primary {
    background: #875a7b;
    color: white;
}

.btn-primary:hover {
    background: #9d6b89;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

input[type="checkbox"] {
    margin-right: 8px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .behavior-options {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Behavior card selection
document.querySelectorAll('.behavior-card').forEach(card => {
    card.addEventListener('click', function() {
        document.querySelectorAll('.behavior-card').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
    });
});

function saveLanguageAISettings() {
    const formData = new FormData();
    
    // Collect all form data
    document.querySelectorAll('#language-ai-settings-form input, #language-ai-settings-form select').forEach(input => {
        if (input.type === 'checkbox') {
            formData.append(input.name, input.checked ? 'on' : '');
        } else {
            formData.append(input.name, input.value);
        }
    });
    
    // Get CSRF token
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    formData.append('csrfmiddlewaretoken', csrfToken);
    
    fetch(window.location.href, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccessMessage('Paramètres IA sauvegardés avec succès !');
        } else {
            alert('Erreur lors de la sauvegarde: ' + (data.message || 'Erreur inconnue'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Erreur lors de la sauvegarde');
    });
}

function resetLanguageAISettings() {
    if (confirm('Êtes-vous sûr de vouloir réinitialiser tous les paramètres IA ?')) {
        document.querySelectorAll('#language-ai-settings-form').forEach(form => form.reset());
        document.querySelectorAll('.behavior-card').forEach(card => card.classList.remove('active'));
    }
}

function showSuccessMessage(message) {
    const messageEl = document.createElement('div');
    messageEl.className = 'alert alert-success';
    messageEl.innerHTML = `<i class="bi bi-check-circle"></i> ${message}`;
    messageEl.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #d1edff;
        color: #0c5460;
        padding: 12px 20px;
        border-radius: 6px;
        border: 1px solid #bee5eb;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    `;
    document.body.appendChild(messageEl);
    
    setTimeout(() => {
        messageEl.remove();
    }, 3000);
}
</script>