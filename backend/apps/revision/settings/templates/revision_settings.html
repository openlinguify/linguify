<!-- Template pour les paramÃ¨tres de rÃ©vision -->
<div id="revision-settings" class="app-settings-content" style="display: none;">
    <div class="settings-header">
        <div class="settings-title">
            <i class="bi bi-arrow-clockwise" style="margin-right: 8px; color: #875a7b;"></i>
            Configuration RÃ©vision
        </div>
        <div class="settings-description">
            Personnalisez votre expÃ©rience de rÃ©vision avec des flashcards
        </div>
    </div>

    <!-- Statistiques rapides -->
    <div class="stats-overview" style="margin-bottom: 24px;">
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
            <div class="stat-card">
                <div class="stat-value" id="total-cards">0</div>
                <div class="stat-label">Cartes totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="cards-learned">0</div>
                <div class="stat-label">Cartes apprises</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="daily-streak">0</div>
                <div class="stat-label">SÃ©rie quotidienne</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="success-rate">0%</div>
                <div class="stat-label">Taux de rÃ©ussite</div>
            </div>
        </div>
    </div>

    <!-- Word Statistics Section -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-translate" style="margin-right: 8px;"></i>
            Statistiques des mots
        </div>
        <div class="section-content">
            <form method="post">
                <input type="hidden" name="settings_type" value="word_stats">
                
                <div class="two-column">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" name="show_word_stats" checked>
                            <span>Afficher les statistiques de mots</span>
                        </label>
                        <div class="help-text">Voir vos mots connus et à apprendre</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Mode d'affichage des statistiques</label>
                        <select name="stats_display_mode" class="form-control">
                            <option value="detailed">Détaillé</option>
                            <option value="simple">Simple</option>
                            <option value="compact">Compact</option>
                        </select>
                        <div class="help-text">Niveau de détail des statistiques affichées</div>
                    </div>
                </div>
                
                <div class="two-column">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" name="hide_learned_words">
                            <span>Masquer les mots appris</span>
                        </label>
                        <div class="help-text">Ne montrer que les mots encore à apprendre</div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" name="group_by_deck">
                            <span>Grouper par deck</span>
                        </label>
                        <div class="help-text">Organiser les statistiques par deck</div>
                    </div>
                </div>
            </form>

            <!-- Word Stats Display -->
            <div class="word-stats-display" id="word-stats-container" style="margin-top: 24px; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden; background: white;">
                <div class="stats-tabs" style="display: flex; border-bottom: 1px solid #e9ecef; background: #f8f9fa;">
                    <button class="stats-tab active" data-tab="known" style="flex: 1; padding: 12px 16px; border: none; background: transparent; cursor: pointer; font-weight: 500; color: #6c757d; transition: all 0.2s ease;">Mots connus</button>
                    <button class="stats-tab" data-tab="to-learn" style="flex: 1; padding: 12px 16px; border: none; background: transparent; cursor: pointer; font-weight: 500; color: #6c757d; transition: all 0.2s ease;">À apprendre</button>
                    <button class="stats-tab" data-tab="summary" style="flex: 1; padding: 12px 16px; border: none; background: transparent; cursor: pointer; font-weight: 500; color: #6c757d; transition: all 0.2s ease;">Résumé</button>
                </div>
                
                <div class="stats-content" style="padding: 20px;">
                    <div id="known-words" class="tab-pane active">
                        <div class="loading-spinner" style="text-align: center; color: #6c757d; padding: 20px;">Chargement des mots connus...</div>
                    </div>
                    <div id="to-learn-words" class="tab-pane" style="display: none;">
                        <div class="loading-spinner" style="text-align: center; color: #6c757d; padding: 20px;">Chargement des mots à apprendre...</div>
                    </div>
                    <div id="summary-stats" class="tab-pane" style="display: none;">
                        <div class="loading-spinner" style="text-align: center; color: #6c757d; padding: 20px;">Chargement du résumé...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Presets rapides -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-lightning-fill" style="margin-right: 8px;"></i>
            Configuration rapide
        </div>
        <div class="section-content">
            <div class="preset-buttons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <button type="button" class="preset-btn" data-preset="beginner">
                    <i class="bi bi-star"></i>
                    <span>DÃ©butant</span>
                    <small>10 cartes, 15 min</small>
                </button>
                <button type="button" class="preset-btn" data-preset="intermediate">
                    <i class="bi bi-lightning"></i>
                    <span>IntermÃ©diaire</span>
                    <small>20 cartes, 20 min</small>
                </button>
                <button type="button" class="preset-btn" data-preset="advanced">
                    <i class="bi bi-fire"></i>
                    <span>AvancÃ©</span>
                    <small>30 cartes, 30 min</small>
                </button>
                <button type="button" class="preset-btn" data-preset="intensive">
                    <i class="bi bi-rocket"></i>
                    <span>Intensif</span>
                    <small>50 cartes, 45 min</small>
                </button>
            </div>
        </div>
    </div>

    <!-- ParamÃ¨tres dÃ©taillÃ©s -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-sliders" style="margin-right: 8px;"></i>
            ParamÃ¨tres d'apprentissage
        </div>
        <div class="section-content">
            <form id="revision-settings-form">
                <input type="hidden" name="settings_type" value="revision">
                
                <div class="two-column">
                    <div class="form-group">
                        <label class="form-label">Mode d'Ã©tude par dÃ©faut</label>
                        <select name="default_study_mode" class="form-control">
                            <option value="spaced">RÃ©pÃ©tition espacÃ©e</option>
                            <option value="intensive">RÃ©vision intensive</option>
                            <option value="mixed">Mode mixte</option>
                            <option value="custom">PersonnalisÃ©</option>
                        </select>
                        <div class="help-text">Algorithme utilisÃ© pour planifier vos rÃ©visions</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">DifficultÃ© par dÃ©faut</label>
                        <select name="default_difficulty" class="form-control">
                            <option value="easy">Facile</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Difficile</option>
                            <option value="expert">Expert</option>
                        </select>
                        <div class="help-text">Niveau de difficultÃ© pour les nouvelles cartes</div>
                    </div>
                </div>
                
                <div class="two-column">
                    <div class="form-group">
                        <label class="form-label">Cartes par session</label>
                        <div class="range-input">
                            <input type="range" name="cards_per_session" min="5" max="100" value="20" class="form-range">
                            <span class="range-value">20</span>
                        </div>
                        <div class="help-text">Nombre de cartes Ã  rÃ©viser par session</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">DurÃ©e de session (minutes)</label>
                        <div class="range-input">
                            <input type="range" name="default_session_duration" min="5" max="120" value="20" class="form-range">
                            <span class="range-value">20</span>
                        </div>
                        <div class="help-text">DurÃ©e recommandÃ©e par session</div>
                    </div>
                </div>
                
                <div class="two-column">
                    <div class="form-group">
                        <label class="form-label">RÃ©visions pour apprendre</label>
                        <div class="range-input">
                            <input type="range" name="required_reviews_to_learn" min="1" max="10" value="3" class="form-range">
                            <span class="range-value">3</span>
                        </div>
                        <div class="help-text">Nombre de rÃ©visions correctes nÃ©cessaires</div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" name="auto_advance" checked>
                            <span>Passage automatique</span>
                        </label>
                        <div class="help-text">Passer automatiquement Ã  la carte suivante</div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- ParamÃ¨tres de rÃ©pÃ©tition espacÃ©e -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-calendar3" style="margin-right: 8px;"></i>
            RÃ©pÃ©tition espacÃ©e
        </div>
        <div class="section-content">
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" name="spaced_repetition_enabled" checked>
                    <span>Activer la rÃ©pÃ©tition espacÃ©e</span>
                </label>
                <div class="help-text">Utilise l'algorithme de Leitner pour optimiser la mÃ©morisation</div>
            </div>
            
            <div class="spaced-repetition-settings">
                <div class="three-column">
                    <div class="form-group">
                        <label class="form-label">Intervalle facile (jours)</label>
                        <input type="number" name="initial_interval_easy" min="1" max="30" value="4" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Intervalle normal (jours)</label>
                        <input type="number" name="initial_interval_normal" min="1" max="30" value="2" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Intervalle difficile (jours)</label>
                        <input type="number" name="initial_interval_hard" min="1" max="30" value="1" class="form-control">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ParamÃ¨tres de notifications -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-bell" style="margin-right: 8px;"></i>
            Rappels et notifications
        </div>
        <div class="section-content">
            <div class="two-column">
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="daily_reminder_enabled" checked>
                        <span>Rappel quotidien</span>
                    </label>
                    <div class="help-text">Recevoir un rappel pour rÃ©viser quotidiennement</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Heure du rappel</label>
                    <input type="time" name="reminder_time" value="18:00" class="form-control">
                    <div class="help-text">Heure Ã  laquelle recevoir le rappel</div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">FrÃ©quence des notifications</label>
                <select name="notification_frequency" class="form-control">
                    <option value="daily">Quotidienne</option>
                    <option value="weekly">Hebdomadaire</option>
                    <option value="custom">PersonnalisÃ©e</option>
                    <option value="disabled">DÃ©sactivÃ©e</option>
                </select>
            </div>
        </div>
    </div>

    <!-- ParamÃ¨tres d'interface -->
    <div class="content-section">
        <div class="section-header">
            <i class="bi bi-palette" style="margin-right: 8px;"></i>
            Interface et expÃ©rience
        </div>
        <div class="section-content">
            <div class="three-column">
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="enable_animations" checked>
                        <span>Animations</span>
                    </label>
                    <div class="help-text">Effets visuels lors des transitions</div>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="auto_play_audio">
                        <span>Audio automatique</span>
                    </label>
                    <div class="help-text">Jouer automatiquement les prononciations</div>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="keyboard_shortcuts_enabled" checked>
                        <span>Raccourcis clavier</span>
                    </label>
                    <div class="help-text">Utiliser les raccourcis pour naviguer</div>
                </div>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" name="show_progress_stats" checked>
                    <span>Afficher les statistiques de progression</span>
                </label>
                <div class="help-text">Voir vos statistiques en temps rÃ©el pendant l'Ã©tude</div>
            </div>
        </div>
    </div>

    <!-- Boutons d'action -->
    <div class="settings-actions">
        <button type="submit" form="revision-settings-form" class="btn btn-primary">
            <i class="bi bi-check-lg" style="margin-right: 8px;"></i>
            Sauvegarder les paramÃ¨tres
        </button>
        <button type="button" class="btn btn-secondary" onclick="resetRevisionSettings()">
            <i class="bi bi-arrow-clockwise" style="margin-right: 8px;"></i>
            Remettre par dÃ©faut
        </button>
    </div>
</div>

<style>
/* Styles spÃ©cifiques aux paramÃ¨tres de rÃ©vision */
.preset-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
}

.preset-btn:hover {
    border-color: #875a7b;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(135, 90, 123, 0.15);
}

.preset-btn.active {
    border-color: #875a7b;
    background: rgba(135, 90, 123, 0.1);
}

.preset-btn i {
    font-size: 24px;
    color: #875a7b;
    margin-bottom: 8px;
}

.preset-btn span {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
}

.preset-btn small {
    font-size: 12px;
    color: #666;
}

.stat-card {
    background: white;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #875a7b;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.range-input {
    display: flex;
    align-items: center;
    gap: 12px;
}

.range-input .form-range {
    flex: 1;
}

.range-value {
    min-width: 30px;
    text-align: center;
    font-weight: 600;
    color: #875a7b;
}

.spaced-repetition-settings {
    margin-top: 16px;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 6px;
}

.three-column {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
}
</style>

<script>
// JavaScript pour les paramÃ¨tres de rÃ©vision
document.addEventListener('DOMContentLoaded', function() {
    // Initialiser les paramÃ¨tres de rÃ©vision
    initRevisionSettings();
    
    // Gestionnaires d'Ã©vÃ©nements pour les presets
    document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const preset = this.dataset.preset;
            applyRevisionPreset(preset);
        });
    });
    
    // Gestionnaires pour les sliders
    document.querySelectorAll('.range-input input[type="range"]').forEach(slider => {
        slider.addEventListener('input', function() {
            const valueSpan = this.parentElement.querySelector('.range-value');
            valueSpan.textContent = this.value;
        });
    });
    
    // Soumission du formulaire
    document.getElementById('revision-settings-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveRevisionSettings();
    });
    
    // Word stats tab handlers
    document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.addEventListener('click', function () {
            const tabId = this.dataset.tab;
            switchStatsTab(tabId);
        });
    });

    // Initialize word stats
    initWordStats();
});

function initRevisionSettings() {
    console.log('[RevisionSettings] Initializing revision settings');
    
    // Charger les statistiques
    loadRevisionStats();
    
    // Charger les paramÃ¨tres actuels
    loadCurrentRevisionSettings();
}

function loadRevisionStats() {
    console.log('[RevisionSettings] Loading revision statistics');
    
    // Simulation des statistiques - Ã  remplacer par un appel API
    fetch('/api/v1/revision/settings/stats/')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-cards').textContent = data.total_cards || 0;
            document.getElementById('cards-learned').textContent = data.cards_learned || 0;
            document.getElementById('daily-streak').textContent = data.daily_streak || 0;
            document.getElementById('success-rate').textContent = 
                data.success_rate ? Math.round(data.success_rate * 100) + '%' : '0%';
        })
        .catch(error => {
            console.warn('[RevisionSettings] Could not load stats:', error);
            // Valeurs par dÃ©faut en cas d'erreur
            document.getElementById('total-cards').textContent = '0';
            document.getElementById('cards-learned').textContent = '0';
            document.getElementById('daily-streak').textContent = '0';
            document.getElementById('success-rate').textContent = '0%';
        });
}

function loadCurrentRevisionSettings() {
    console.log('[RevisionSettings] Loading current settings');
    
    fetch('/api/v1/revision/settings/config/')
        .then(response => response.json())
        .then(data => {
            // Remplir le formulaire avec les donnÃ©es
            populateRevisionForm(data);
        })
        .catch(error => {
            console.warn('[RevisionSettings] Could not load current settings:', error);
        });
}

function populateRevisionForm(data) {
    const form = document.getElementById('revision-settings-form');
    
    // Remplir tous les champs du formulaire
    Object.keys(data).forEach(key => {
        const field = form.querySelector(`[name="${key}"]`);
        if (field) {
            if (field.type === 'checkbox') {
                field.checked = data[key];
            } else if (field.type === 'range') {
                field.value = data[key];
                const valueSpan = field.parentElement.querySelector('.range-value');
                if (valueSpan) valueSpan.textContent = data[key];
            } else {
                field.value = data[key];
            }
        }
    });
    
    console.log('[RevisionSettings] Form populated with current settings');
}

function applyRevisionPreset(presetName) {
    console.log(`[RevisionSettings] Applying preset: ${presetName}`);
    
    // Marquer le preset comme actif
    document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-preset="${presetName}"]`).classList.add('active');
    
    // Appeler l'API pour appliquer le preset
    fetch('/api/v1/revision/settings/presets/apply/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken()
        },
        body: JSON.stringify({
            preset_name: presetName,
            override_user_settings: true
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log(`[RevisionSettings] Preset ${presetName} applied successfully`);
            populateRevisionForm(data.settings);
            showNotification(`Configuration "${data.preset_applied}" appliquÃ©e avec succÃ¨s`, 'success');
        } else {
            console.error('[RevisionSettings] Failed to apply preset:', data.error);
            showNotification('Erreur lors de l\'application du preset', 'error');
        }
    })
    .catch(error => {
        console.error('[RevisionSettings] Error applying preset:', error);
        showNotification('Erreur lors de l\'application du preset', 'error');
    });
}

function saveRevisionSettings() {
    console.log('[RevisionSettings] Saving settings');
    
    const form = document.getElementById('revision-settings-form');
    const formData = new FormData(form);
    
    // Convertir en objet JSON
    const settings = {};
    for (let [key, value] of formData.entries()) {
        const field = form.querySelector(`[name="${key}"]`);
        if (field) {
            if (field.type === 'checkbox') {
                settings[key] = field.checked;
            } else if (field.type === 'range' || field.type === 'number') {
                settings[key] = parseInt(value);
            } else {
                settings[key] = value;
            }
        }
    }
    
    fetch('/api/v1/revision/settings/config/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken()
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        console.log('[RevisionSettings] Settings saved successfully');
        showNotification('ParamÃ¨tres de rÃ©vision sauvegardÃ©s', 'success');
    })
    .catch(error => {
        console.error('[RevisionSettings] Error saving settings:', error);
        showNotification('Erreur lors de la sauvegarde', 'error');
    });
}

function resetRevisionSettings() {
    if (confirm('Ãtes-vous sÃ»r de vouloir remettre les paramÃ¨tres par dÃ©faut ?')) {
        console.log('[RevisionSettings] Resetting to default settings');
        
        fetch('/api/v1/revision/settings/config/', {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': getCsrfToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('[RevisionSettings] Settings reset successfully');
            populateRevisionForm(data);
            showNotification('ParamÃ¨tres remis par dÃ©faut', 'success');
            
            // DÃ©sactiver tous les presets
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        })
        .catch(error => {
            console.error('[RevisionSettings] Error resetting settings:', error);
            showNotification('Erreur lors de la remise Ã  zÃ©ro', 'error');
        });
    }
}

// Fonction utilitaire pour les notifications
function showNotification(message, type = 'info') {
    // Utiliser le systÃ¨me de notification existant ou crÃ©er une notification simple
    console.log(`[RevisionSettings] ${type.toUpperCase()}: ${message}`);
    
    // Si des messages Django sont disponibles, les utiliser
    if (typeof showDjangoMessage === 'function') {
        showDjangoMessage(message, type);
    } else {
        // Notification simple
        alert(message);
    }
}

// Fonction utilitaire pour obtenir le token CSRF
function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
}

// Word Statistics Functions
function initWordStats() {
    console.log('[WordStats] Initializing word statistics');
    loadWordStats('known');
}

function switchStatsTab(tabId) {
    // Update tab active states
    document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.style.color = '#6c757d';
        tab.style.background = 'transparent';
    });
    
    const activeTab = document.querySelector(`[data-tab="${tabId}"]`);
    activeTab.classList.add('active');
    activeTab.style.color = '#875a7b';
    activeTab.style.background = 'white';

    // Update content active states
    document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('active');
        pane.style.display = 'none';
    });
    
    const targetPane = document.getElementById(tabId === 'known' ? 'known-words' : 
                                             tabId === 'to-learn' ? 'to-learn-words' : 'summary-stats');
    if (targetPane) {
        targetPane.classList.add('active');
        targetPane.style.display = 'block';
    }

    // Load data for the selected tab
    loadWordStats(tabId);
}

function loadWordStats(type) {
    console.log(`[WordStats] Loading ${type} word statistics`);
    
    // DEBUG: Test with static data first
    if (false) { // Change to false to use real API
        const mockData = {
            known_words: [
                {front_text: "Hello", back_text: "Bonjour", deck_name: "English-French", last_reviewed: "2025-07-23"},
                {front_text: "Cat", back_text: "Chat", deck_name: "Animals", last_reviewed: "2025-07-22"}
            ],
            words_to_learn: [
                {front_text: "House", back_text: "Maison", deck_name: "English-French", correct_reviews: 1, reviews_needed: 2, progress_percentage: 33},
                {front_text: "Dog", back_text: "Chien", deck_name: "Animals", correct_reviews: 0, reviews_needed: 3, progress_percentage: 0}
            ],
            statistics: {
                total_known: 2,
                total_to_learn: 2,
                total_words: 4,
                completion_rate: 50
            }
        };
        
        setTimeout(() => displayWordStats(type, mockData), 500);
        return;
    }
    
    const apiUrl = '/api/v1/revision/word-stats/';
    const params = new URLSearchParams();
    
    if (type === 'known') {
        params.append('type', 'known');
    } else if (type === 'to-learn') {
        params.append('type', 'to_learn');
    } else {
        params.append('type', 'all');
    }

    fetch(`${apiUrl}?${params.toString()}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken(),
        },
        credentials: 'same-origin'
    })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            displayWordStats(type, data);
        })
        .catch(error => {
            console.error(`[WordStats] Error loading ${type} stats:`, error);
            showStatsError(type);
        });
}

function displayWordStats(type, data) {
    const container = document.getElementById(
        type === 'known' ? 'known-words' : 
        type === 'to-learn' ? 'to-learn-words' : 'summary-stats'
    );

    if (!container) return;

    if (type === 'summary' || type === 'all') {
        // Display summary statistics
        container.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div style="padding: 16px; border: 1px solid #e9ecef; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #875a7b; margin-bottom: 4px;">${data.statistics?.total_known || 0}</div>
                    <div style="font-size: 14px; color: #666;">Mots connus</div>
                </div>
                <div style="padding: 16px; border: 1px solid #e9ecef; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #875a7b; margin-bottom: 4px;">${data.statistics?.total_to_learn || 0}</div>
                    <div style="font-size: 14px; color: #666;">À apprendre</div>
                </div>
                <div style="padding: 16px; border: 1px solid #e9ecef; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #875a7b; margin-bottom: 4px;">${data.statistics?.total_words || 0}</div>
                    <div style="font-size: 14px; color: #666;">Total</div>
                </div>
                <div style="padding: 16px; border: 1px solid #e9ecef; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #875a7b; margin-bottom: 4px;">${data.statistics?.completion_rate || 0}%</div>
                    <div style="font-size: 14px; color: #666;">Taux de réussite</div>
                </div>
            </div>
        `;
    } else {
        // Display word lists
        const words = type === 'known' ? data.known_words : data.words_to_learn;
        
        if (!words || words.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: #6c757d; padding: 20px;">
                    Aucun mot ${type === 'known' ? 'connu' : 'à apprendre'} trouvé.
                </div>
            `;
            return;
        }

        const wordsHtml = words.map(word => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f3f4;">
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${word.front_text}</div>
                    <div style="color: #666; font-size: 14px;">${word.back_text}</div>
                </div>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                    <div style="font-size: 12px; color: #875a7b; background: rgba(135, 90, 123, 0.1); padding: 2px 8px; border-radius: 12px;">${word.deck_name}</div>
                    ${type === 'to-learn' ? `
                        <div style="font-size: 12px; color: #666;">${word.correct_reviews}/${word.reviews_needed + word.correct_reviews}</div>
                        <div style="width: 60px; height: 4px; background: #e9ecef; border-radius: 2px; overflow: hidden;">
                            <div style="height: 100%; background: #28a745; width: ${word.progress_percentage}%; transition: width 0.3s ease;"></div>
                        </div>
                    ` : `
                        <div style="font-size: 12px; color: #666;">Appris ✓</div>
                    `}
                </div>
            </div>
        `).join('');

        container.innerHTML = wordsHtml;
    }
}

function showStatsError(type) {
    const container = document.getElementById(
        type === 'known' ? 'known-words' : 
        type === 'to-learn' ? 'to-learn-words' : 'summary-stats'
    );
    
    if (container) {
        container.innerHTML = `
            <div style="text-align: center; color: #dc3545; padding: 20px;">
                Erreur lors du chargement des statistiques.
            </div>
        `;
    }
}
</script>