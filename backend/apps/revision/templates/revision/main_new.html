{% extends "revision/base_new.html" %}
{% load static %}

{% block page_title %}Memory{% endblock %}

{% block header_content %}
{% include 'revision/components/navbar.html' %}
{% endblock %}

{% block content %}
<div class="flex" style="height: 100%; min-height: 100%;">
    <!-- Sidebar -->
    {% include 'revision/partials/sidebar_section.html' %}

    <!-- Study Area -->
    <div class="flex-1 revision-study main-content-area" style="overflow-y: auto; height: 100%;">
    <!-- Welcome state -->
    {% include 'revision/partials/welcome_section.html' %}
    
    <!-- Deck Details -->
    {% include 'revision/partials/deck_details_section.html' %}
    
    <!-- Create Deck Form -->
    {% include 'revision/partials/create_deck_form.html' %}
    
    <!-- Create Card Form -->
    {% include 'revision/partials/create_card_form.html' %}
    
    <!-- Edit Card Form -->
    {% include 'revision/partials/edit_card_form.html' %}
    
    <!-- Learning Settings Form -->
    
    <!-- Study Modes (extracted into separate templates) -->
    {% include 'revision/study/flashcards_embedded.html' %}
    {% include 'revision/study/learn_embedded.html' %}
    {% include 'revision/study/match_embedded.html' %}
    {% include 'revision/study/review_embedded.html' %}
    {% include 'revision/study/write_embedded.html' %}
    
    <!-- Import Deck Components -->
    {% include 'revision/components/deck_import.html' %}
    
    <!-- Edit Deck Form -->
    {% include 'revision/partials/edit_deck_form.html' %}
    </div> <!-- End flex container -->

    <!-- Modals de partage -->
    {% include "revision/components/share_deck.html" %}
    {% include "revision/partials/tags/tags_management.html" %}
    {% include "revision/partials/tags/tag_templates.html" %}

</div>
{% endblock %}

{% block extra_css %}
<style>
/* Styles supplémentaires pour la révision */

.revision-header .header-content {
    position: relative;
    z-index: 1000;
}

/* Assurer que les éléments interactifs sont accessibles */
.revision-header button,
.revision-header select,
.revision-header input,
.revision-header a {
    position: relative;
    z-index: 1001;
}

/* Dropdowns et modals au dessus de tout */
.dropdown-menu,
.tags-filter-dropdown {
    z-index: 1050 !important;
}

/* Éviter les problèmes de scroll sur la barre */
.revision-header {
    flex-shrink: 0;
    min-height: fit-content;
}

/* Styles pour les boutons de traduction */
.translate-btn {
    opacity: 0.8;
    transition: all 0.2s ease;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    backdrop-filter: blur(5px);
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(13, 110, 253, 0.3);
}

.translate-btn:hover {
    opacity: 1;
    background: rgba(13, 110, 253, 0.1);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.translate-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* Conteneur de notification */
#notification-container {
    z-index: 9999;
    pointer-events: none;
}

#notification-container .alert {
    pointer-events: auto;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<!-- CSRF Token for API calls -->
{% csrf_token %}

<!-- Charger le JavaScript modulaire -->
<script src="{% static 'revision/js/tags/revision-tags.js' %}?v=20250919-api-fix"></script>
<script src="{% static 'revision/js/tags/revision-tags-management.js' %}?v=20250919-api-fix"></script>
<script src="{% static 'revision/js/revision-main.js' %}?v=20250919-api-fix"></script>
<script src="{% static 'revision/js/study/revision-flashcards.js' %}?v=20250823-debug-v3"></script>
<script src="{% static 'revision/js/study/revision-quiz.js' %}?v=20250823-layout-fix"></script>
<script src="{% static 'revision/js/study/revision-matching.js' %}?v=20250823-optimized"></script>
<script src="{% static 'revision/js/study/revision-spaced.js' %}"></script>
<script src="{% static 'revision/js/study/revision-write.js' %}"></script>
<script src="{% static 'revision/js/translation.js' %}"></script>

<script>
// Le JavaScript principal est maintenant dans revision-main.js
// Il s'initialise automatiquement au chargement de la page

// Exporter selectDeck pour les événements inline
window.selectDeck = window.revisionMain.selectDeck;
window.updatePreview = window.revisionMain.updatePreview;
window.clearSelectedFile = window.revisionMain.clearSelectedFile;

// Paramètres audio utilisateur depuis le serveur
window.userAudioSettings = {{ audio_settings_json|safe }};
console.log('Paramètres audio chargés depuis le serveur:', window.userAudioSettings);

// Configuration des langues par défaut pour la traduction
window.deckFrontLanguage = 'fr'; // Langue par défaut du recto
window.deckBackLanguage = 'en';  // Langue par défaut du verso
</script>
{% endblock %}