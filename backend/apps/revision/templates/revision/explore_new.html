{% extends "revision/base_new.html" %}
{% load static %}

{% block page_title %}Explorer{% endblock %}

{% block header_content %}
{% include 'revision/components/navbar.html' %}
{% endblock %}

{% block content %}
<!-- Sidebar pour les filtres avancés -->
<div id="exploreSidebar" class="revision-sidebar show">
        <div class="sidebar-content">
        <!-- Filtres avancés -->
        <div class="sidebar-header-linguify">
            <h6 class="mb-0">
                <i class="bi bi-funnel me-2"></i>
                Filtres avancés
            </h6>
        </div>
        
        <div class="p-3">
            <!-- Filtre par catégorie -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-folder me-1"></i>
                    Catégorie
                </label>
                <select id="categoryFilter" class="form-select-linguify form-select-sm">
                    <option value="">Toutes les catégories</option>
                    <option value="languages">🌐 Langues</option>
                    <option value="science">🔬 Sciences</option>
                    <option value="history">📚 Histoire</option>
                    <option value="math">🔢 Mathématiques</option>
                    <option value="literature">📖 Littérature</option>
                    <option value="medicine">⚕️ Médecine</option>
                    <option value="technology">💻 Technologie</option>
                    <option value="business">💼 Business</option>
                    <option value="art">🎨 Art & Culture</option>
                    <option value="other">📋 Autres</option>
                </select>
            </div>

            <!-- Filtre par langue -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-translate me-1"></i>
                    Langue
                </label>
                <select id="languageFilter" class="form-select-linguify form-select-sm">
                    <option value="">Toutes les langues</option>
                    <option value="fr">🇫🇷 Français</option>
                    <option value="en">🇺🇸 Anglais</option>
                    <option value="es">🇪🇸 Espagnol</option>
                    <option value="de">🇩🇪 Allemand</option>
                    <option value="it">🇮🇹 Italien</option>
                    <option value="pt">🇵🇹 Portugais</option>
                    <option value="zh">🇨🇳 Chinois</option>
                    <option value="ja">🇯🇵 Japonais</option>
                    <option value="ru">🇷🇺 Russe</option>
                </select>
            </div>

            <!-- Filtre par niveau -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-bar-chart me-1"></i>
                    Niveau
                </label>
                <select id="levelFilter" class="form-select-linguify form-select-sm">
                    <option value="">Tous les niveaux</option>
                    <option value="beginner">🟢 Débutant</option>
                    <option value="intermediate">🟡 Intermédiaire</option>
                    <option value="advanced">🔴 Avancé</option>
                    <option value="expert">⚫ Expert</option>
                </select>
            </div>
            
            <!-- Filtre par auteur -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-person me-1"></i>
                    Auteur
                </label>
                <input type="text" id="authorFilter" class="form-control-linguify form-control-sm" 
                       placeholder="Nom d'utilisateur...">
            </div>
            
            <!-- Filtre par nombre de cartes -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-stack me-1"></i>
                    Nombre de cartes
                </label>
                <div class="d-flex gap-1">
                    <input type="number" id="minCards" class="form-control-linguify form-control-sm" 
                           placeholder="Min" min="1">
                    <input type="number" id="maxCards" class="form-control-linguify form-control-sm" 
                           placeholder="Max" min="1">
                </div>
            </div>

            <!-- Filtre par rating -->
            <div class="mb-3">
                <label class="form-label small fw-bold text-linguify-primary">
                    <i class="bi bi-star me-1"></i>
                    Note minimale
                </label>
                <select id="ratingFilter" class="form-select-linguify form-select-sm">
                    <option value="">Toutes les notes</option>
                    <option value="4">⭐⭐⭐⭐ 4+ étoiles</option>
                    <option value="3">⭐⭐⭐ 3+ étoiles</option>
                    <option value="2">⭐⭐ 2+ étoiles</option>
                    <option value="1">⭐ 1+ étoile</option>
                </select>
            </div>
            
            <!-- Actions -->
            <div class="d-flex gap-2">
                <button id="applyFilters" class="btn-linguify btn-sm flex-1">
                    <i class="bi bi-search me-1"></i>
                    Appliquer
                </button>
                <button id="clearFilters" class="btn-linguify-secondary btn-sm">
                    <i class="bi bi-x-circle me-1"></i>
                    Effacer
                </button>
            </div>
        </div>
        
        <!-- Collections personnelles -->
        <div class="sidebar-header-linguify">
            <h6 class="mb-0">
                <i class="bi bi-heart me-2 text-linguify-accent"></i>
                Mes Collections
            </h6>
            <button class="btn-link-linguify btn-sm p-0" id="createCollectionBtn" title="Créer une collection">
                <i class="bi bi-plus-circle"></i>
            </button>
        </div>
        
        <div id="myCollections" class="p-2">
            <!-- Sera rempli par JavaScript -->
        </div>

        <!-- Favoris -->
        <div class="sidebar-header-linguify">
            <h6 class="mb-0">
                <i class="bi bi-bookmark me-2 text-linguify-secondary"></i>
                Favoris
            </h6>
            <small class="text-muted" id="favoritesCount">0</small>
        </div>
        
        <div id="favoriteDecks" class="p-2">
            <!-- Sera rempli par JavaScript -->
        </div>

        <!-- Decks populaires -->
        <div class="sidebar-header-linguify">
            <h6 class="mb-0">
                <i class="bi bi-fire me-2 text-linguify-warning"></i>
                Trending cette semaine
            </h6>
        </div>
        
        <div id="popularDecks" class="p-2">
            <!-- Sera rempli par JavaScript -->
        </div>

        <!-- Statistiques globales -->
        <div class="sidebar-header-linguify">
            <h6 class="mb-0">
                <i class="bi bi-graph-up me-2 text-linguify-success"></i>
                Communauté
            </h6>
        </div>
        
        <div class="p-3">
            <div class="community-stats">
                <div class="stat-item">
                    <i class="bi bi-stack text-linguify-primary"></i>
                    <span class="stat-value" id="totalDecksCount">-</span>
                    <span class="stat-label">Decks publics</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-card-text text-linguify-accent"></i>
                    <span class="stat-value" id="totalCardsCount">-</span>
                    <span class="stat-label">Cartes totales</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-people text-linguify-secondary"></i>
                    <span class="stat-value" id="totalAuthorsCount">-</span>
                    <span class="stat-label">Créateurs</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Zone principale -->
<div class="revision-study">
    <!-- Vue d'accueil -->
    <div id="exploreWelcome" class="study-content">
        <div class="text-center p-5">
            <i class="bi bi-globe2 text-linguify-primary mb-4" style="font-size: 4rem;"></i>
            <h2 class="mb-3">Explorer les Decks Publics</h2>
            <p class="text-muted mb-4">
                Découvrez des milliers de decks de flashcards créés par la communauté Linguify.
                Trouvez le deck parfait pour vos besoins d'apprentissage !
            </p>
            
            <div class="row g-3 justify-content-center">
                <div class="col-md-4">
                    <div class="card-linguify h-100">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-search text-linguify-primary mb-3" style="font-size: 2rem;"></i>
                            <h5 class="card-title text-linguify-primary">Recherche avancée</h5>
                            <p class="card-text small text-muted">
                                Trouvez des decks par sujet, langue, niveau de difficulté.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-linguify h-100">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-download text-linguify-accent mb-3" style="font-size: 2rem;"></i>
                            <h5 class="card-title text-linguify-accent">Import facile</h5>
                            <p class="card-text small text-muted">
                                Importez instantanément des decks publics dans votre collection.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-linguify h-100">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-people text-linguify-secondary mb-3" style="font-size: 2rem;"></i>
                            <h5 class="card-title text-linguify-secondary">Communauté</h5>
                            <p class="card-text small text-muted">
                                Découvrez du contenu créé par des apprenants passionnés.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="startExploring" class="btn-linguify btn-lg mt-4">
                <i class="bi bi-rocket me-2"></i>
                Commencer l'exploration
            </button>
        </div>
    </div>
    
    <!-- Résultats de recherche -->
    <div id="exploreResults" style="display: none;">
        <!-- Advanced Search Bar -->
        <div class="advanced-search-container">
            <div class="search-input-wrapper">
                <div class="search-input-group">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" id="exploreSearchInput" class="form-control-linguify search-input" 
                           placeholder="Rechercher des decks par titre, description, tags..." 
                           autocomplete="off">
                    <div class="search-actions">
                        <button id="notificationBtn" class="btn-link-linguify notification-btn" title="Notifications">
                            <i class="bi bi-bell notification-icon"></i>
                            <span id="notificationBadge" class="notification-badge-linguify">5</span>
                        </button>
                        <button id="voiceSearchBtn" class="btn-link-linguify search-voice" title="Recherche vocale">
                            <i class="bi bi-mic"></i>
                        </button>
                        <button id="sidebarToggle" class="btn-link-linguify search-sidebar" title="Filtres et collections">
                            <i class="bi bi-funnel"></i>
                        </button>
                        <button id="advancedSearchToggle" class="btn-link-linguify search-advanced" title="Recherche avancée">
                            <i class="bi bi-sliders"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Auto-completion dropdown -->
                <div id="searchSuggestions" class="search-suggestions" style="display: none;">
                    <!-- Will be filled by JavaScript -->
                </div>
                
                <!-- Notification Center -->
                <div id="notificationOverlay" class="notification-overlay"></div>
                <div id="notificationCenter" class="notification-center" style="display: none;">
                    <div class="notification-header">
                        <h6 class="mb-0">
                            <i class="bi bi-bell me-2"></i>
                            Notifications
                        </h6>
                        <div class="notification-actions">
                            <button class="btn-link-linguify btn-sm" title="Marquer tout comme lu">
                                <i class="bi bi-check2-all"></i>
                            </button>
                            <button class="btn-link-linguify btn-sm" title="Paramètres">
                                <i class="bi bi-gear"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="notification-filters">
                        <button class="notification-filter active" data-filter="all">
                            Toutes <span class="filter-count" id="allNotificationsCount">5</span>
                        </button>
                        <button class="notification-filter" data-filter="new-decks">
                            Nouveaux decks <span class="filter-count" id="newDecksCount">1</span>
                        </button>
                        <button class="notification-filter" data-filter="favorites-updates">
                            Favoris <span class="filter-count" id="favoritesUpdatesCount">1</span>
                        </button>
                        <button class="notification-filter" data-filter="collections-activity">
                            Collections <span class="filter-count" id="collectionsActivityCount">1</span>
                        </button>
                        <button class="notification-filter" data-filter="system">
                            Système <span class="filter-count" id="systemNotificationsCount">1</span>
                        </button>
                    </div>
                    
                    <div class="notification-list" id="notificationList">
                        <!-- Sample notifications for testing -->
                        <div class="notification-item" data-type="new-decks">
                            <div class="notification-icon new-deck">
                                <i class="bi bi-plus-circle"></i>
                            </div>
                            <div class="notification-content">
                                <p class="notification-title">Nouveaux decks d'anglais disponibles</p>
                                <p class="notification-text">5 nouveaux decks de vocabulaire anglais ont été ajoutés par la communauté</p>
                                <small class="notification-time">2h</small>
                                <div class="notification-actions-item">
                                    <button class="notification-action-btn primary">Voir</button>
                                    <button class="notification-action-btn secondary">Ignorer</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-item" data-type="favorites-updates">
                            <div class="notification-icon favorite-update">
                                <i class="bi bi-heart-fill"></i>
                            </div>
                            <div class="notification-content">
                                <p class="notification-title">Mise à jour d'un favori</p>
                                <p class="notification-text">Le deck "Vocabulaire Espagnol A2" a été mis à jour avec 20 nouvelles cartes</p>
                                <small class="notification-time">6h</small>
                                <div class="notification-actions-item">
                                    <button class="notification-action-btn primary">Voir</button>
                                    <button class="notification-action-btn secondary">Ignorer</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-item" data-type="collections-activity">
                            <div class="notification-icon collection-activity">
                                <i class="bi bi-collection"></i>
                            </div>
                            <div class="notification-content">
                                <p class="notification-title">Activité dans vos collections</p>
                                <p class="notification-text">Un nouveau deck a été ajouté à votre collection "Langues Européennes"</p>
                                <small class="notification-time">12h</small>
                                <div class="notification-actions-item">
                                    <button class="notification-action-btn primary">Voir</button>
                                    <button class="notification-action-btn secondary">Ignorer</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-item" data-type="recommendations">
                            <div class="notification-icon recommendation">
                                <i class="bi bi-star-fill"></i>
                            </div>
                            <div class="notification-content">
                                <p class="notification-title">Recommandation personnalisée</p>
                                <p class="notification-text">Basé sur votre activité, nous vous recommandons "Grammaire Française Avancée"</p>
                                <small class="notification-time">1j</small>
                                <div class="notification-actions-item">
                                    <button class="notification-action-btn primary">Voir</button>
                                    <button class="notification-action-btn secondary">Ignorer</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-item" data-type="system">
                            <div class="notification-icon system">
                                <i class="bi bi-gear-fill"></i>
                            </div>
                            <div class="notification-content">
                                <p class="notification-title">Nouvelles fonctionnalités</p>
                                <p class="notification-text">Découvrez les nouvelles options de recherche vocale et de filtres avancés</p>
                                <small class="notification-time">2j</small>
                                <div class="notification-actions-item">
                                    <button class="notification-action-btn primary">Voir</button>
                                    <button class="notification-action-btn secondary">Ignorer</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notification-footer">
                        <button class="btn-linguify btn-sm w-100">
                            Voir toutes les notifications
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Quick filters chips -->
            <div class="quick-filters" id="quickFilters">
                <div class="filter-chip" data-filter="category" data-value="languages">
                    🌐 Langues
                    <i class="bi bi-x-circle filter-remove"></i>
                </div>
                <div class="filter-chip" data-filter="level" data-value="beginner">
                    🟢 Débutant
                    <i class="bi bi-x-circle filter-remove"></i>
                </div>
                <!-- More chips will be added dynamically -->
            </div>
            
            <!-- Search history dropdown -->
            <div class="search-history" id="searchHistory" style="display: none;">
                <div class="history-header">
                    <small class="text-muted">Recherches récentes</small>
                    <button class="btn-link-linguify btn-sm" id="clearSearchHistory">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                <div class="history-items">
                    <!-- Will be filled by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="study-header">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <div>
                    <h5 class="mb-0">Decks publics</h5>
                    <small class="text-muted">
                        <span id="resultsCount">0</span> deck(s) trouvé(s)
                    </small>
                </div>
                
                <!-- Options de tri et vue -->
                <div class="d-flex align-items-center gap-2">
                    <!-- Vue -->
                    <div class="btn-group-linguify btn-group-sm" role="group" aria-label="Vue">
                        <input type="radio" class="btn-check" name="viewMode" id="gridView" autocomplete="off" checked>
                        <label class="btn-linguify-secondary" for="gridView" title="Vue grille">
                            <i class="bi bi-grid"></i>
                        </label>
                        <input type="radio" class="btn-check" name="viewMode" id="listView" autocomplete="off">
                        <label class="btn-linguify-secondary" for="listView" title="Vue liste">
                            <i class="bi bi-list"></i>
                        </label>
                    </div>
                    
                    <!-- Tri -->
                    <select id="sortBy" class="form-select-linguify form-select-sm" style="width: auto;">
                        <option value="created_at">➡️ Plus récents</option>
                        <option value="name">📝 A-Z</option>
                        <option value="popularity">🔥 Popularité</option>
                        <option value="rating">⭐ Mieux notés</option>
                        <option value="cards_count">📚 Plus de cartes</option>
                        <option value="downloads">⬇️ Plus téléchargés</option>
                    </select>
                    
                    <button id="backToWelcome" class="btn-linguify-secondary btn-sm">
                        <i class="bi bi-arrow-left"></i>
                        Retour
                    </button>
                </div>
            </div>
        </div>
        
        <div class="study-content">
            <!-- Loading -->
            <div id="exploreLoading" class="text-center p-5" style="display: none;">
                <div class="spinner-linguify text-linguify-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-3 text-muted">Recherche en cours...</p>
            </div>
            
            <!-- Grille des decks -->
            <div id="publicDecksGrid" class="row g-4 p-4">
                <!-- Sera rempli par JavaScript -->
            </div>
            
            <!-- Aucun résultat -->
            <div id="noResults" class="text-center p-5" style="display: none;">
                <i class="bi bi-search text-muted mb-4" style="font-size: 4rem;"></i>
                <h4 class="text-muted">Aucun deck trouvé</h4>
                <p class="text-muted">Essayez d'ajuster vos critères de recherche.</p>
                <button id="clearSearch" class="btn-linguify-secondary">
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    Effacer la recherche
                </button>
            </div>
            
            <!-- Pagination -->
            <div id="explorePagination" class="d-flex justify-content-center mt-4">
                <!-- Sera rempli par JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Détails d'un deck public -->
    <div id="publicDeckDetails" style="display: none;">
        <div class="study-header">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-2">
                    <button id="backToResults" class="btn-linguify-secondary btn-sm">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <div>
                        <h4 id="publicDeckName" class="mb-0">Nom du deck</h4>
                        <small id="publicDeckAuthor" class="text-muted">Par @username</small>
                    </div>
                </div>
                
                <div class="d-flex align-items-center gap-2">
                    <span id="publicDeckStats" class="badge-linguify"></span>
                    <button id="importPublicDeck" class="btn-linguify btn-sm">
                        <i class="bi bi-download me-1"></i>
                        Importer ce deck
                    </button>
                </div>
            </div>
        </div>
        
        <div class="study-content">
            <div class="p-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card-linguify">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-card-list me-2"></i>
                                    Aperçu des cartes
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="publicDeckCardsPreview">
                                    <!-- Sera rempli par JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card-linguify">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Informations
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="publicDeckInfo">
                                    <!-- Sera rempli par JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rating & Reviews Section -->
                        <div class="card-linguify mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-star me-2"></i>
                                    Évaluations & Avis
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="deckRatingSection">
                                    <!-- Interactive rating -->
                                    <div class="rating-section mb-3">
                                        <div class="d-flex align-items-center gap-2 mb-2">
                                            <span class="small fw-bold">Votre note :</span>
                                            <div id="userRatingStars" class="interactive-rating">
                                                <i class="bi bi-star rating-star" data-rating="1"></i>
                                                <i class="bi bi-star rating-star" data-rating="2"></i>
                                                <i class="bi bi-star rating-star" data-rating="3"></i>
                                                <i class="bi bi-star rating-star" data-rating="4"></i>
                                                <i class="bi bi-star rating-star" data-rating="5"></i>
                                            </div>
                                        </div>
                                        <div class="rating-summary" id="ratingSummary">
                                            <!-- Sera rempli par JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Reviews List -->
                                <div id="reviewsList" class="mt-3">
                                    <!-- Sera rempli par JavaScript -->
                                </div>
                                
                                <div class="text-center mt-3">
                                    <button class="btn-linguify-secondary btn-sm" id="loadMoreReviews">
                                        <i class="bi bi-arrow-down-circle me-1"></i>
                                        Voir plus d'avis
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Author Profile Section -->
                        <div class="card-linguify mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-person-circle me-2"></i>
                                    Profil de l'auteur
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="authorProfile">
                                    <!-- Sera rempli par JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal d'importation -->
<div class="modal-overlay" id="importModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-primary">
                        <i class="bi bi-download text-linguify-primary text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title">Importer un deck public</h3>
                        <p class="modal-subtitle">Ajouter ce deck à votre collection</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Nom du deck dans votre collection</label>
                    <input type="text" id="importDeckName" class="form-control-linguify" 
                           placeholder="Nom personnalisé (optionnel)">
                    <div class="form-text">
                        Si vide, le nom original sera utilisé avec "(Copie)" ajouté.
                    </div>
                </div>
                
                <div class="alert-box alert-primary">
                    <div class="alert-content">
                        <div class="alert-icon">
                            <i class="bi bi-info-circle-fill text-linguify-primary text-lg"></i>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium text-linguify-primary-dark">Information</h4>
                            <p class="mt-1 text-sm text-linguify-primary">Une copie complète du deck sera créée dans votre collection personnelle. Vous pourrez la modifier librement sans affecter le deck original.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Annuler
                </button>
                <button type="button" id="confirmImportDeck" class="btn-linguify">
                    <i class="bi bi-download"></i>Importer
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de création de collection -->
<div class="modal-overlay" id="createCollectionModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-accent">
                        <i class="bi bi-heart text-linguify-accent text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title">Nouvelle Collection</h3>
                        <p class="modal-subtitle">Organisez vos decks favoris</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Nom de la collection</label>
                    <input type="text" id="collectionName" class="form-control-linguify" 
                           placeholder="Ex: Vocabulaire Anglais, Sciences Niveau 3...">
                </div>
                <div class="mb-3">
                    <label class="form-label">Description (optionnelle)</label>
                    <textarea id="collectionDescription" class="form-control-linguify" rows="2"
                              placeholder="Décrivez brièvement cette collection..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Visibilité</label>
                    <div class="form-check-linguify">
                        <input class="form-check-input-linguify" type="radio" name="visibility" id="privateCollection" value="private" checked>
                        <label class="form-check-label-linguify" for="privateCollection">
                            <i class="bi bi-lock me-1"></i>Privée (seulement moi)
                        </label>
                    </div>
                    <div class="form-check-linguify">
                        <input class="form-check-input-linguify" type="radio" name="visibility" id="publicCollection" value="public">
                        <label class="form-check-label-linguify" for="publicCollection">
                            <i class="bi bi-globe me-1"></i>Publique (visible par tous)
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Annuler
                </button>
                <button type="button" id="createCollectionConfirm" class="btn-linguify">
                    <i class="bi bi-plus"></i>Créer la collection
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal d'ajout à une collection -->
<div class="modal-overlay" id="addToCollectionModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-success">
                        <i class="bi bi-plus-circle text-linguify-success text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title">Ajouter à une collection</h3>
                        <p class="modal-subtitle">Organisez vos decks préférés</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="selectedDeckInfo" class="mb-3">
                    <!-- Infos du deck sélectionné -->
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Sélectionner une collection</label>
                    <div id="collectionsList" class="collections-list">
                        <!-- Sera rempli par JavaScript -->
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="button" class="btn-linguify-secondary btn-sm" id="createNewCollectionFromModal">
                        <i class="bi bi-plus me-1"></i>Créer une nouvelle collection
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Annuler
                </button>
                <button type="button" id="addToCollectionConfirm" class="btn-linguify" disabled>
                    <i class="bi bi-check"></i>Ajouter
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de gestion des collections -->
<div class="modal-overlay" id="manageCollectionModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-gray">
                        <i class="bi bi-gear text-gray-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title" id="manageCollectionTitle">Gérer la collection</h3>
                        <p class="modal-subtitle">Modifier et organiser</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="collection-info">
                            <h6>Informations de la collection</h6>
                            <div class="mb-3">
                                <label class="form-label small">Nom</label>
                                <input type="text" id="editCollectionName" class="form-control-linguify form-control-sm">
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Description</label>
                                <textarea id="editCollectionDescription" class="form-control-linguify form-control-sm" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Visibilité</label>
                                <select id="editCollectionVisibility" class="form-select-linguify form-select-sm">
                                    <option value="private">🔒 Privée</option>
                                    <option value="public">🌐 Publique</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="collection-decks">
                            <h6>Decks dans cette collection <span id="collectionDeckCount" class="badge-linguify">0</span></h6>
                            <div id="collectionDecksList" class="collection-decks-list">
                                <!-- Sera rempli par JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-danger" id="deleteCollectionBtn">
                    <i class="bi bi-trash"></i>Supprimer la collection
                </button>
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Fermer
                </button>
                <button type="button" id="saveCollectionChanges" class="btn-linguify">
                    <i class="bi bi-check"></i>Sauvegarder
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de paramètres de notifications -->
<div class="modal-overlay" id="notificationSettingsModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-primary">
                        <i class="bi bi-bell-fill text-linguify-primary text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title">Paramètres des notifications</h3>
                        <p class="modal-subtitle">Personnalisez vos alertes</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <h6 class="fw-bold mb-3">
                        <i class="bi bi-toggles me-2"></i>
                        Préférences générales
                    </h6>
                    
                    <div class="form-check-linguify form-switch mb-3">
                        <input class="form-check-input-linguify" type="checkbox" id="enableNotifications" checked>
                        <label class="form-check-label-linguify" for="enableNotifications">
                            Activer toutes les notifications
                        </label>
                    </div>
                    
                    <div class="form-check-linguify form-switch mb-3">
                        <input class="form-check-input-linguify" type="checkbox" id="enableSoundNotifications">
                        <label class="form-check-label-linguify" for="enableSoundNotifications">
                            Sons de notification
                        </label>
                    </div>
                    
                    <div class="form-check-linguify form-switch mb-3">
                        <input class="form-check-input-linguify" type="checkbox" id="enableBadgeNotifications" checked>
                        <label class="form-check-label-linguify" for="enableBadgeNotifications">
                            Badge de compteur
                        </label>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold mb-3">
                        <i class="bi bi-funnel me-2"></i>
                        Types de notifications
                    </h6>
                    
                    <div class="notification-type-setting mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label class="form-check-label-linguify fw-medium">
                                    <i class="bi bi-plus-circle me-2 text-linguify-success"></i>
                                    Nouveaux decks publics
                                </label>
                                <small class="d-block text-muted">Alertes pour les nouveaux decks ajoutés</small>
                            </div>
                            <div class="form-check-linguify form-switch">
                                <input class="form-check-input-linguify" type="checkbox" id="notifyNewDecks" checked>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notification-type-setting mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label class="form-check-label-linguify fw-medium">
                                    <i class="bi bi-heart me-2 text-danger"></i>
                                    Mises à jour des favoris
                                </label>
                                <small class="d-block text-muted">Modifications de vos decks favoris</small>
                            </div>
                            <div class="form-check-linguify form-switch">
                                <input class="form-check-input-linguify" type="checkbox" id="notifyFavoritesUpdates" checked>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notification-type-setting mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label class="form-check-label-linguify fw-medium">
                                    <i class="bi bi-collection me-2 text-linguify-primary"></i>
                                    Activité des collections
                                </label>
                                <small class="d-block text-muted">Nouveaux decks dans vos collections suivies</small>
                            </div>
                            <div class="form-check-linguify form-switch">
                                <input class="form-check-input-linguify" type="checkbox" id="notifyCollectionsActivity" checked>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notification-type-setting mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label class="form-check-label-linguify fw-medium">
                                    <i class="bi bi-star me-2 text-warning"></i>
                                    Recommandations intelligentes
                                </label>
                                <small class="d-block text-muted">Suggestions personnalisées</small>
                            </div>
                            <div class="form-check-linguify form-switch">
                                <input class="form-check-input-linguify" type="checkbox" id="notifyRecommendations" checked>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notification-type-setting mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label class="form-check-label-linguify fw-medium">
                                    <i class="bi bi-gear me-2 text-linguify-secondary"></i>
                                    Notifications système
                                </label>
                                <small class="d-block text-muted">Mises à jour et maintenance</small>
                            </div>
                            <div class="form-check-linguify form-switch">
                                <input class="form-check-input-linguify" type="checkbox" id="notifySystem">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6 class="fw-bold mb-3">
                        <i class="bi bi-clock me-2"></i>
                        Fréquence des notifications
                    </h6>
                    
                    <select id="notificationFrequency" class="form-select-linguify">
                        <option value="realtime">En temps réel</option>
                        <option value="hourly">Toutes les heures</option>
                        <option value="daily" selected>Quotidienne</option>
                        <option value="weekly">Hebdomadaire</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Annuler
                </button>
                <button type="button" class="btn-linguify" id="saveNotificationSettingsBtn">
                    <i class="bi bi-check-lg"></i>Sauvegarder
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour toutes les notifications -->
<div class="modal-overlay" id="allNotificationsModal" aria-hidden="true">
    <div class="modal-backdrop">
        <div class="modal-overlay-bg" aria-hidden="true"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-icon modal-icon-primary">
                        <i class="bi bi-bell-fill text-linguify-primary text-xl"></i>
                    </div>
                    <div>
                        <h3 class="modal-title">Toutes les notifications</h3>
                        <p class="modal-subtitle">Historique complet</p>
                    </div>
                </div>
                <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notification-full-list" id="notificationFullList">
                    <!-- All notifications will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-linguify-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>Fermer
                </button>
                <button type="button" class="btn-linguify" id="markAllNotificationsReadBtn">
                    <i class="bi bi-check2-all"></i>Marquer tout comme lu
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar Overlay -->
<div id="sidebarOverlay" class="sidebar-overlay" style="display: none;"></div>

{% endblock %}

{% endblock %}

{% block extra_js %}
<!-- Explorer Core Scripts -->
<!-- 1. Utilities first (Service Worker, Performance, Error Tracking) -->
<script src="{% static 'revision/js/explorer/utils.js' %}?v=20250823"></script>

<!-- 2. Main Explorer functionality -->
<script src="{% static 'revision/js/explorer/main.js' %}?v=20250111-optimized"></script>

<!-- 3. Page-specific functionality (Notifications, UI interactions) -->
<script src="{% static 'revision/js/explorer/explore_new.js' %}?v=20250823"></script>

<!-- 4. Development tools -->
{% if debug or request.GET.test %}
<script src="{% static 'revision/js/explorer/test-suite.js' %}"></script>
{% endif %}
{% endblock %}