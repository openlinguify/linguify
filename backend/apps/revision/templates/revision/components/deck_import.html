{% load i18n %}
<!-- Import Deck Components -->
<!-- This file contains all the HTML for deck import functionality -->

<!-- Import Deck Form -->
<div id="importDeckForm" class="display-none">
    <div class="study-header">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <i class="bi bi-upload text-linguify-primary me-2"></i>
                <h5 class="mb-0 text-linguify-primary">Importer un deck</h5>
            </div>
            <button id="cancelImport" class="btn-linguify-secondary btn-sm">
                <i class="bi bi-x-lg"></i>
                Annuler
            </button>
        </div>
    </div>
    
    <div class="study-content" style="height: calc(100vh - 220px); overflow: hidden; display: flex; flex-direction: column;">
        <!-- Main content area with scroll -->
        <div class="import-content-scrollable" style="flex: 1; overflow-y: auto; padding: 0.75rem; margin-right: -1rem; padding-right: 2rem;">

            <!-- Deck name input -->
            <div class="mb-4">
                <label class="form-label d-flex align-items-center small fw-semibold text-linguify-primary mb-2">
                    <i class="bi bi-tag me-2"></i>
                    Nom du deck
                </label>
                <div class="position-relative">
                    <input type="text" id="importDeckName" 
                           class="form-control rounded" 
                           placeholder="Entrez le nom du nouveau deck..." 
                           maxlength="100"
                           style="padding-right: 2.5rem;">
                    <div class="position-absolute top-50 end-0 translate-middle-y me-2" style="pointer-events: none; z-index: 10;">
                        <i class="bi bi-pencil-square text-muted" style="font-size: 1rem;"></i>
                    </div>
                </div>
                <div class="d-flex align-items-center mt-1">
                    <i class="bi bi-info-circle text-linguify-accent me-1" style="font-size: 0.75rem;"></i>
                    <span class="text-muted" style="font-size: 0.75rem;">Ce nom doit Ãªtre unique dans vos decks</span>
                </div>
                <div class="invalid-feedback" style="display: none;" id="deckNameError"></div>
            </div>

            <!-- Enhanced steps indicator -->
            <div class="d-flex align-items-center justify-content-center mb-4">
                <div class="d-flex align-items-center me-3">
                    <span class="badge bg-linguify-accent rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <span class="text-white fw-bold">1</span>
                    </span>
                    <span class="small fw-medium text-linguify-primary">SÃ©lection</span>
                </div>
                <div class="border-top" style="width: 32px;"></div>
                <div class="d-flex align-items-center mx-3">
                    <span class="badge bg-secondary rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <span class="text-muted fw-bold">2</span>
                    </span>
                    <span class="small text-muted">AperÃ§u</span>
                </div>
                <div class="border-top" style="width: 32px;"></div>
                <div class="d-flex align-items-center ms-3">
                    <span class="badge bg-secondary rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <span class="text-muted fw-bold">3</span>
                    </span>
                    <span class="small text-muted">Import</span>
                </div>
            </div>

            <!-- Enhanced file drop zone with Tailwind -->
            <div class="card-linguify border border-dashed border-primary border-opacity-25 p-4 text-center cursor-pointer" id="fileDropZone">
                <div class="drop-zone-content">
                    <div class="text-center mb-3">
                        <div class="d-inline-flex align-items-center justify-content-center bg-linguify-accent rounded-circle shadow-sm" style="width: 64px; height: 64px;">
                            <i class="bi bi-cloud-upload text-white" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-linguify-primary mb-2">Glissez votre fichier ici</h6>
                        <p class="small text-muted mb-0">ou cliquez pour sÃ©lectionner un fichier</p>
                    </div>
                    <input type="file" id="importFile" class="d-none" accept=".csv,.xlsx,.xls">
                    <button class="btn-linguify" onclick="console.log('ðŸ–±ï¸ Clic bouton parcourir'); const input = document.getElementById('importFile'); input.value = ''; input.click();">
                        <i class="bi bi-folder2-open me-2"></i>
                        Parcourir les fichiers
                    </button>
                </div>
                <div class="position-absolute top-0 start-0 w-100 h-100 bg-linguify-accent rounded d-flex flex-column align-items-center justify-content-center" style="opacity: 0; pointer-events: none; z-index: 1;" id="dropZoneOverlay">
                    <div class="d-flex align-items-center justify-content-center border border-white border-4 rounded-circle mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-cloud-upload-fill text-white" style="font-size: 2rem;"></i>
                    </div>
                    <h6 class="text-white fw-bold mb-0">DÃ©posez le fichier ici</h6>
                </div>
            </div>

            <!-- Enhanced file info display -->
            <div class="selected-file-info d-none" id="selectedFileInfo">
                <div class="alert-box alert-primary rounded p-3 mb-4">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <div class="d-flex align-items-center justify-content-center bg-linguify-accent rounded me-3" style="width: 48px; height: 48px;">
                                <i class="bi bi-file-earmark-check text-white"></i>
                            </div>
                            <div>
                                <p id="selectedFileName" class="fw-semibold text-linguify-primary small mb-1"></p>
                                <p id="selectedFileSize" class="text-muted" style="font-size: 0.75rem;"></p>
                            </div>
                        </div>
                        <button class="btn btn-light btn-sm rounded-circle" style="width: 32px; height: 32px;" onclick="clearSelectedFile()">
                            <i class="bi bi-x text-muted"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Enhanced supported formats -->
            <div class="card-linguify p-3 mb-4">
                <div class="d-flex align-items-center flex-wrap mb-2">
                    <span class="small fw-medium text-linguify-accent me-3">Formats supportÃ©s:</span>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-green-100 text-success border border-success border-opacity-25 rounded-pill">
                            <i class="bi bi-file-earmark-excel me-1"></i>
                            Excel (.xlsx, .xls)
                        </span>
                        <span class="badge bg-blue-50 text-linguify-accent border border-linguify-accent border-opacity-25 rounded-pill">
                            <i class="bi bi-filetype-csv me-1"></i>
                            CSV
                        </span>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <i class="bi bi-info-circle text-linguify-warning me-2"></i>
                    <span class="text-muted" style="font-size: 0.75rem;">
                        Minimum 2 colonnes requises pour le recto et le verso des cartes
                    </span>
                </div>
            </div>
            

        </div>
        
        <!-- Enhanced fixed bottom actions -->
        <div class="bg-white border-top p-4 mt-auto shadow-sm" style="flex-shrink: 0;">
            <div class="d-flex gap-3 justify-content-end align-items-center">
                <button id="cancelImportAlt" class="btn-linguify-secondary">
                    Annuler
                </button>
                <button id="submitImport" class="btn-linguify d-flex align-items-center" disabled>
                    <i class="bi bi-arrow-right me-2"></i>
                    Suivant - AperÃ§u
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Import Preview Section -->
<div id="importPreviewSection" class="display-none">
    <div class="study-header">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <i class="bi bi-eye text-linguify-accent me-2"></i>
                <h5 class="mb-0 text-linguify-accent">AperÃ§u de l'import</h5>
            </div>
            <button id="cancelImportPreview" class="btn-linguify-secondary btn-sm">
                <i class="bi bi-x-lg"></i>
                Annuler
            </button>
        </div>
    </div>
    
    <div class="study-content" style="height: calc(100vh - 220px); overflow: hidden; display: flex; flex-direction: column;">
        <div class="import-content-scrollable" style="flex: 1; overflow-y: auto; padding: 0.75rem; margin-right: -1rem; padding-right: 2rem;">
            <!-- Enhanced steps indicator for preview -->
            <div class="d-flex align-items-center justify-content-center mb-4">
                <div class="d-flex align-items-center me-3">
                    <span class="badge bg-success rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-check text-white fw-bold"></i>
                    </span>
                    <span class="small fw-medium text-success">SÃ©lection</span>
                </div>
                <div class="border-top" style="width: 32px;"></div>
                <div class="d-flex align-items-center mx-3">
                    <span class="badge bg-linguify-accent rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <span class="text-white fw-bold">2</span>
                    </span>
                    <span class="small fw-medium text-linguify-primary">AperÃ§u</span>
                </div>
                <div class="border-top" style="width: 32px;"></div>
                <div class="d-flex align-items-center ms-3">
                    <span class="badge bg-secondary rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                        <span class="text-muted fw-bold">3</span>
                    </span>
                    <span class="small text-muted">Import</span>
                </div>
            </div>

            <!-- Enhanced file summary -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card-linguify p-3">
                        <div class="d-flex align-items-center">
                            <div class="d-flex align-items-center justify-content-center bg-linguify-accent rounded me-3" style="width: 40px; height: 40px;">
                                <i class="bi bi-file-earmark text-white"></i>
                            </div>
                            <div>
                                <p class="text-muted text-uppercase fw-medium mb-1" style="font-size: 0.75rem; letter-spacing: 1px;">Fichier</p>
                                <p class="small fw-semibold text-linguify-primary mb-0" id="previewFileName"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-linguify p-3">
                        <div class="d-flex align-items-center">
                            <div class="d-flex align-items-center justify-content-center bg-success rounded me-3" style="width: 40px; height: 40px;">
                                <i class="bi bi-list-ol text-white"></i>
                            </div>
                            <div>
                                <p class="text-muted text-uppercase fw-medium mb-1" style="font-size: 0.75rem; letter-spacing: 1px;">Lignes</p>
                                <p class="small fw-semibold text-success mb-0" id="previewTotalRows"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-linguify p-3">
                        <div class="d-flex align-items-center">
                            <div class="d-flex align-items-center justify-content-center bg-linguify-primary rounded me-3" style="width: 40px; height: 40px;">
                                <i class="bi bi-credit-card text-white"></i>
                            </div>
                            <div>
                                <p class="text-muted text-uppercase fw-medium mb-1" style="font-size: 0.75rem; letter-spacing: 1px;">Cartes Ã  crÃ©er</p>
                                <p class="small fw-semibold text-linguify-accent mb-0" id="previewEstimatedCards">~</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced column configuration -->
            <div class="card-linguify p-4 mb-4">
                <h6 class="d-flex align-items-center fs-6 fw-semibold text-linguify-primary mb-4">
                    <i class="bi bi-arrow-left-right me-2"></i>
                    Configuration des colonnes
                </h6>
                
                <!-- Enhanced header option -->
                <div class="bg-gray-50 rounded-lg p-3 mb-4">
                    <div class="d-flex align-items-start">
                        <div class="flex-shrink-0 pt-1 me-3">
                            <input class="form-check-input rounded" 
                                   type="checkbox" id="hasHeaderCheck" checked onchange="updatePreview()">
                        </div>
                        <div>
                            <label class="form-check-label small fw-medium text-linguify-primary" for="hasHeaderCheck">
                                La premiÃ¨re ligne contient des en-tÃªtes
                            </label>
                            <p class="text-muted mt-1" style="font-size: 0.75rem;">
                                Cochez cette option si la premiÃ¨re ligne contient les noms de colonnes et ne doit pas Ãªtre importÃ©e comme une carte
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center small fw-semibold text-linguify-primary mb-2">
                                <i class="bi bi-card-text me-2"></i>
                                Recto des cartes
                            </label>
                            <select id="frontColumnSelect" 
                                    class="form-select rounded" 
                                    onchange="updatePreview()">
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label d-flex align-items-center small fw-medium text-linguify-accent mb-2">
                                <i class="bi bi-globe me-2 rounded"></i>
                                Langue du recto (optionnel)
                            </label>
                            <select id="frontLanguageSelect" class="form-select rounded">
                                <option value="">-- SÃ©lectionner une langue --</option>
                                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                                <option value="en">ðŸ‡ºðŸ‡¸ Anglais</option>
                                <option value="es">ðŸ‡ªðŸ‡¸ Espagnol</option>
                                <option value="de">ðŸ‡©ðŸ‡ª Allemand</option>
                                <option value="it">ðŸ‡®ðŸ‡¹ Italien</option>
                                <option value="pt">ðŸ‡µðŸ‡¹ Portugais</option>
                                <option value="ru">ðŸ‡·ðŸ‡º Russe</option>
                                <option value="zh">ðŸ‡¨ðŸ‡³ Chinois</option>
                                <option value="ja">ðŸ‡¯ðŸ‡µ Japonais</option>
                                <option value="ko">ðŸ‡°ðŸ‡· CorÃ©en</option>
                                <option value="ar">ðŸ‡¸ðŸ‡¦ Arabe</option>
                                <option value="nl">ðŸ‡³ðŸ‡± NÃ©erlandais</option>
                                <option value="pl">ðŸ‡µðŸ‡± Polonais</option>
                                <option value="tr">ðŸ‡¹ðŸ‡· Turc</option>
                                <option value="sv">ðŸ‡¸ðŸ‡ª SuÃ©dois</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center small fw-semibold text-linguify-accent mb-2">
                                <i class="bi bi-card-text me-2"></i>
                                Verso des cartes
                            </label>
                            <select id="backColumnSelect" 
                                    class="form-select rounded" 
                                    onchange="updatePreview()">
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label d-flex align-items-center small fw-medium text-linguify-accent mb-2">
                                <i class="bi bi-globe me-2"></i>
                                Langue du verso (optionnel)
                            </label>
                            <select id="backLanguageSelect" class="form-select rounded">
                                <option value="">-- SÃ©lectionner une langue --</option>
                                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                                <option value="en">ðŸ‡ºðŸ‡¸ Anglais</option>
                                <option value="es">ðŸ‡ªðŸ‡¸ Espagnol</option>
                                <option value="de">ðŸ‡©ðŸ‡ª Allemand</option>
                                <option value="it">ðŸ‡®ðŸ‡¹ Italien</option>
                                <option value="pt">ðŸ‡µðŸ‡¹ Portugais</option>
                                <option value="ru">ðŸ‡·ðŸ‡º Russe</option>
                                <option value="zh">ðŸ‡¨ðŸ‡³ Chinois</option>
                                <option value="ja">ðŸ‡¯ðŸ‡µ Japonais</option>
                                <option value="ko">ðŸ‡°ðŸ‡· CorÃ©en</option>
                                <option value="ar">ðŸ‡¸ðŸ‡¦ Arabe</option>
                                <option value="nl">ðŸ‡³ðŸ‡± NÃ©erlandais</option>
                                <option value="pl">ðŸ‡µðŸ‡± Polonais</option>
                                <option value="tr">ðŸ‡¹ðŸ‡· Turc</option>
                                <option value="sv">ðŸ‡¸ðŸ‡ª SuÃ©dois</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="alert-box alert-warning rounded-lg p-3 mt-3">
                    <div class="d-flex align-items-start">
                        <i class="bi bi-lightbulb text-linguify-warning flex-shrink-0 mt-1 me-2"></i>
                        <span class="small text-muted">
                            Modifiez la sÃ©lection pour voir l'aperÃ§u mis Ã  jour en temps rÃ©el
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced preview cards -->
            <div class="card-linguify p-4">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h6 class="d-flex align-items-center fs-6 fw-semibold text-linguify-primary mb-0">
                        <i class="bi bi-stack me-2"></i>
                        AperÃ§u des cartes (5 premiÃ¨res)
                    </h6>
                    <span class="badge bg-linguify-warning text-white d-none" id="previewUpdateIndicator">
                        <i class="bi bi-arrow-repeat me-1 spinner-border spinner-border-sm" style="--bs-spinner-width: .75rem; --bs-spinner-height: .75rem;"></i>
                        Mise Ã  jour...
                    </span>
                </div>
                <div id="previewCardsContainer" class="d-flex flex-column gap-3">
                    <!-- Les cartes de preview seront ajoutÃ©es ici -->
                </div>
            </div>
        </div>
        
        <!-- Enhanced bottom actions for preview -->
        <div class="bg-white border-top p-4 mt-auto shadow-sm" style="flex-shrink: 0;">
            <div class="d-flex gap-3 justify-content-between align-items-center">
                <button id="cancelImportPreviewAlt" class="btn-linguify-secondary d-flex align-items-center">
                    <i class="bi bi-arrow-left me-2"></i>
                    Retour
                </button>
                <button id="confirmImport" class="btn btn-success d-flex align-items-center">
                    <i class="bi bi-check-circle me-2"></i>
                    Confirmer l'import
                </button>
            </div>
        </div>
    </div>
</div>