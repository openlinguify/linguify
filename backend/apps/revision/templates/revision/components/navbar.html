{% load i18n %}
<!-- Interface unifiée Linguify -->
<div class="navbar-linguify">
    <!-- Gauche: Navigation + Actions principales -->
    <div class="navbar-section">
        <!-- Bouton toggle sidebar pour toutes les pages -->
        <div>
            <button id="toggleSidebar" 
                class="btn-navbar-outline" 
                title="Masquer/Afficher la barre latérale"
                aria-label="Basculer la barre latérale"
                aria-expanded="true"
                onclick="
                // Universal sidebar toggle that works on all pages
                const revisionSidebar = document.getElementById('revisionSidebar');
                const exploreSidebar = document.getElementById('exploreSidebar');  
                const statsSidebar = document.getElementById('statsSidebar');
                
                const sidebar = revisionSidebar || exploreSidebar || statsSidebar;
                
                if (sidebar) {
                    const isCurrentlyVisible = sidebar.classList.contains('show');
                    
                    if (isCurrentlyVisible) {
                        // Hide sidebar
                        sidebar.classList.remove('show');
                        sidebar.style.width = '0px';
                        sidebar.style.minWidth = '0px';
                        sidebar.style.maxWidth = '0px';
                        sidebar.style.padding = '0px';
                        sidebar.style.margin = '0px';
                        sidebar.style.border = 'none';
                        sidebar.style.overflow = 'hidden';
                        sidebar.style.flex = '0 0 0px';
                        sidebar.style.opacity = '0';
                        sidebar.style.visibility = 'hidden';
                    } else {
                        // Show sidebar
                        sidebar.classList.add('show');
                        sidebar.style.removeProperty('width');
                        sidebar.style.removeProperty('minWidth');
                        sidebar.style.removeProperty('maxWidth');
                        sidebar.style.removeProperty('padding');
                        sidebar.style.removeProperty('margin');
                        sidebar.style.removeProperty('border');
                        sidebar.style.removeProperty('overflow');
                        sidebar.style.removeProperty('flex');
                        sidebar.style.removeProperty('opacity');
                        sidebar.style.removeProperty('visibility');
                    }
                    
                    // Update button icon
                    const toggleBtn = document.getElementById('toggleSidebar');
                    const icon = toggleBtn?.querySelector('i');
                    if (icon) {
                        const nowVisible = sidebar.classList.contains('show');
                        if (nowVisible) {
                            icon.className = 'bi bi-layout-sidebar-inset';
                            toggleBtn.title = 'Masquer la barre latérale';
                        } else {
                            icon.className = 'bi bi-layout-sidebar-inset-reverse';
                            toggleBtn.title = 'Afficher la barre latérale';
                        }
                    }
                    
                    console.log('Sidebar toggled:', sidebar.id, 'Show:', sidebar.classList.contains('show'));
                } else {
                    console.error('No sidebar found on this page');
                }
                ">
            <i class="bi bi-layout-sidebar-inset" aria-hidden="true"></i>
            </button>
        </div>
        
        <!-- Navigation tabs -->
        <div class="nav-tabs-group">
            <a href="{% url 'revision_web:main' %}" 
               class="nav-tab {% if app_name == 'revision' and not study_mode and not view_type %}active{% endif %}">
                <i class="bi bi-stack"></i>
                Liste de cartes
            </a>
            <a href="/revision/explore/" 
               class="nav-tab {% if view_type == 'explore' %}active{% endif %}">
                <i class="bi bi-globe2"></i>
                Explorer
            </a>
            <a href="{% url 'revision_web:stats_dashboard' %}" 
               class="nav-tab {% if view_type == 'stats' %}active{% endif %}">
                <i class="bi bi-graph-up"></i>
                Statistiques
            </a>
        </div>

        <!-- Refresh - Always show, universal for all views -->
        <div class="container-extra">
            <button class="btn-sb" title="Actualiser" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise"></i>
                <span class="d-none d-xl-inline"></span>
            </button>
        </div>

    </div>
    
    <!-- Droite: Actions et filtres contextuels -->
    <div class="navbar-section-right">
        {% if view_type == 'stats' %}
        <!-- Filtres pour la page Statistiques - Simplifiés -->
        <!-- Time Range Filter - Spécifique aux statistiques -->
        <select id="statsTimeRange" class="form-select-linguify" style="width: 140px; min-width: 120px;">
            <option value="7">{% trans "7 last days" %}</option>
            <option value="30" selected>{% trans "30 last days" %</option>
            <option value="90">{% trans "3 last months" %</option>
            <option value="365">{% trans "This year" %</option>
            <option value="all">{% trans "All periods" %</option>
        </select>
        
        <button id="exportStats" class="btn-navbar btn-navbar-outline" title="Exporter les statistiques">
            <i class="bi bi-download"></i>
            <span class="d-none d-lg-inline">Exporter</span>
        </button>
        
        {% elif view_type == 'explore' %}
        <!-- Filtres pour la page Explorer - Alignés avec la Liste de cartes -->
        <input type="text" id="searchInput" class="form-control-linguify" placeholder="{% trans 'Research in progress ...' %}" style="width: 140px; min-width: 100px;">
        
        <!-- Status Filter Dropdown -->
        <div class="dropdown">
            <button id="statusFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="statusFilterText">Tous les statuts</span>
            </button>
            <ul id="statusFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('', 'Tous les statuts')">Tous les statuts</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('new', 'Récents')">Récents</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('popular', 'Populaires')">Populaires</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('public', 'Publics')">Publics</a></li>
            </ul>
        </div>
        
        <!-- Sort Filter Dropdown -->
        <div class="dropdown">
            <button id="sortFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="sortFilterText">Plus récents</span>
            </button>
            <ul id="sortFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('updated_desc', 'Plus récents')">Plus récents</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('name_asc', 'A-Z')">A-Z</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('popularity_desc', 'Popularité')">Popularité</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('cards_desc', 'Nb. cartes')">Nb. cartes</a></li>
            </ul>
        </div>
        
        <!-- Tags Filter Dropdown -->
        <div class="dropdown">
            <button id="tagsFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="tagsFilterText">{% trans "All tags" %</span>
            </button>
            <ul id="tagsFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectTagsFilter('', 'Tous les tags')">{% trans "All tags" %</a></li>
                <!-- More tags will be dynamically loaded here -->
            </ul>
        </div>
        
        {% else %}
        <!-- Filtres pour les pages personnelles -->
        <input type="text" id="searchInput" class="form-control-linguify" placeholder="Rechercher..." style="width: 140px; min-width: 100px;">
        
        <!-- Status Filter Dropdown -->
        <div class="dropdown">
            <button id="statusFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="statusFilterText">{% trans "All status" %</span>
            </button>
            <ul id="statusFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('', 'Tous les statuts')">{% trans "All status" %</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('active', 'Actifs')">{% trans "Actives" %</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('archived', 'Archivés')">{% trans "Archived" %</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectStatusFilter('public', 'Publics')">{% trans "Public" %</a></li>
            </ul>
        </div>
        
        <!-- Sort Filter Dropdown -->
        <div class="dropdown">
            <button id="sortFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="sortFilterText">{% trans "Filter" %}</span>
            </button>
            <ul id="sortFilterDropdown" class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('updated_desc', 'Plus récents')">{% trans "Most recent" %</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('updated_asc', 'Plus récents')">{% trans "Less recent" %</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('name_asc', 'A-Z')">A-Z</a></li>
                <li><a class="dropdown-item" href="#" onclick="selectSortFilter('progress_desc', 'Progression')">{% trans "Progress" %}</a></li>
            </ul>
        </div>
        
        <!-- Tags Filter Dropdown -->
        <div class="dropdown">
            <button id="tagsFilterToggle" class="btn btn-outline-linguify dropdown-toggle" style="width: 110px; min-width: 90px;" data-bs-toggle="dropdown">
                <span id="tagsFilterText">{% trans "All tags" %}</span>
            </button>
            <ul id="tagsFilterDropdown" class="dropdown-menu">
                <!-- Tags will be dynamically loaded here -->
            </ul>
        </div>
        
        <!-- View Toggle - Only show on Liste de cartes page -->
        <div id="viewToggleGroup" class="navbar-actions-group">
            <div class="btn-group" role="group" aria-label="Mode d'affichage">
                <button id="listViewBtn" class="btn-navbar btn-navbar-outline active" 
                        title="Vue liste"
                        onclick="toggleViewMode('list')">
                    <i class="bi bi-list-ul"></i>
                    <span class="d-none d-xl-inline">{% trans "List" %}</span>
                </button>
                <button id="tableViewBtn" class="btn-navbar btn-navbar-outline" 
                        title="Vue tableau"
                        onclick="toggleViewMode('table')">
                    <i class="bi bi-table"></i>
                    <span class="d-none d-xl-inline">{% trans "Board" %}</span>
                </button>
            </div>
        </div>

        <!-- Actions - Only show when no deck is selected -->
        <div id="generalActions" class="navbar-actions-group">
            <button id="importDeck" class="btn-navbar btn-navbar-outline">
                <i class="bi bi-upload"></i>
                <span class="d-none d-xxl-inline">{% trans "Import" %}</span>
            </button>
            
            <button id="createDeck" class="btn-navbar btn-navbar-primary">
                <i class="bi bi-plus-lg"></i>
                <span class="d-none d-xxl-inline">{% trans "New list" %}</span>
            </button>
        </div>
        {% endif %}
    </div>
</div>