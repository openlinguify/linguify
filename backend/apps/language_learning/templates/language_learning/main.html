{% extends "language_learning/base.html" %}
{% load static %}

{% block content %}
<!-- OWL App Mount Point -->
<!-- CSRF Token for API calls -->
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<!-- Initial data for OWL app -->
<script id="initial-data" type="application/json">
{
    "selectedLanguage": "{{ selected_language|default:'EN' }}",
    "selectedLanguageName": "{{ selected_language_name|default:'' }}",
    "courseUnits": {{ course_units|default:'[]' }},
    "activeUnit": {{ active_unit|default:'null' }},
    "activeUnitModules": {{ active_unit_modules|default:'[]' }},
    "userProgress": {
        "level": {% if user_progress.level %}{{ user_progress.level }}{% else %}1{% endif %},
        "total_xp": {% if user_progress.total_xp %}{{ user_progress.total_xp }}{% else %}0{% endif %},
        "get_completion_percentage": {% if user_progress.get_completion_percentage %}{{ user_progress.get_completion_percentage }}{% else %}0{% endif %}
    },
    "userStreak": {{ user_streak|default:0 }},
    "viewType": "{{ view_type|default:'home' }}"
}
</script>
{% endblock %}

{% block extra_js %}
<!-- OWL Framework -->
<script src="https://unpkg.com/@odoo/owl@2/dist/owl.iife.js"></script>
<script>
// Test OWL loading
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DEBUT DEBUG ===');
    console.log('OWL disponible:', typeof owl !== 'undefined' ? 'OUI' : 'NON');
    if (typeof owl !== 'undefined') {
        console.log('OWL components:', Object.keys(owl));
    }

    const appElement = document.getElementById('language-learning-app');
    console.log('Element app trouvé:', appElement ? 'OUI' : 'NON');

    const dataElement = document.getElementById('initial-data');
    console.log('Element data trouvé:', dataElement ? 'OUI' : 'NON');
    if (dataElement) {
        console.log('Contenu data:', dataElement.textContent);
    }
    console.log('=== FIN DEBUG ===');
});
</script>

{% endblock %}