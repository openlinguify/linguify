{% extends "saas_web/base.html" %}
{% load i18n static %}

{% block title %}{% trans "Study Groups" %} | Open Linguify{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'community/css/community-clean.css' %}">
<style>
.group-card {
    background: var(--linguify-white);
    border: 1px solid var(--linguify-gray-200);
    border-radius: 8px;
    padding: 20px;
    transition: all 0.2s ease;
    height: 100%;
}

.group-card:hover {
    border-color: var(--linguify-primary-light);
    box-shadow: 0 2px 8px rgba(45, 91, 186, 0.1);
    transform: translateY(-2px);
}

.group-header {
    display: flex;
    justify-content: between;
    align-items: start;
    margin-bottom: 12px;
}

.group-title {
    font-size: 16px;
    font-weight: 600;
    color: #6B7280;
    margin-bottom: 4px;
}

.group-stats {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
    padding: 12px;
    background: var(--linguify-gray-50);
    border-radius: 6px;
}

.group-stat {
    text-align: center;
    flex: 1;
}

.group-stat-number {
    font-size: 18px;
    font-weight: 700;
    color: var(--linguify-primary);
}

.group-stat-label {
    font-size: 11px;
    color: #6B7280;
    text-transform: uppercase;
    font-weight: 500;
}

.group-members {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
}

.member-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--linguify-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--linguify-white);
    font-size: 10px;
    font-weight: 600;
}

.member-count {
    font-size: 12px;
    color: #6B7280;
}

.group-badges {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}

.group-badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.group-badge.language {
    background: rgba(45, 91, 186, 0.1);
    color: var(--linguify-primary);
}

.group-badge.level {
    background: rgba(0, 212, 170, 0.1);
    color: var(--linguify-accent-dark);
}

.group-badge.type {
    background: rgba(139, 92, 246, 0.1);
    color: var(--linguify-secondary);
}

.group-badge.status {
    background: rgba(16, 185, 129, 0.1);
    color: var(--linguify-success);
}

.filter-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 24px;
    background: var(--linguify-white);
    border-radius: 8px;
    padding: 4px;
    border: 1px solid var(--linguify-gray-200);
    overflow-x: auto;
}

.filter-tab {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: #6B7280;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    font-size: 14px;
}

.filter-tab.active {
    background: var(--linguify-gradient);
    color: var(--linguify-white);
}

.create-group-card {
    background: var(--linguify-gradient);
    color: var(--linguify-white);
    border: none;
    cursor: pointer;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
}

.create-group-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(45, 91, 186, 0.2);
}

.group-actions {
    display: flex;
    gap: 8px;
    margin-top: auto;
}

.groups-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.my-groups-section {
    background: rgba(45, 91, 186, 0.05);
    border-left: 4px solid var(--linguify-primary);
    border-radius: 0 8px 8px 0;
}
</style>
{% endblock %}

{% block content %}
<div class="community-page">
    <div class="container">
        <!-- Header -->
        <div class="community-header">
            <div class="container">
                <h1 class="h3 mb-3">
                    <i class="bi bi-people me-2"></i>
                    <span class="gradient-text">{% trans "Study Groups" %}</span>
                </h1>
                
                <!-- Navigation -->
                <div class="community-nav">
                    <a href="{% url 'community:main' %}" class="nav-button">
                        <i class="bi bi-house me-1"></i>
                        {% trans "Overview" %}
                    </a>
                    <a href="{% url 'community:discover' %}" class="nav-button">
                        <i class="bi bi-search me-1"></i>
                        {% trans "Discover" %}
                    </a>
                    <a href="{% url 'community:friends' %}" class="nav-button">
                        <i class="bi bi-person-heart me-1"></i>
                        {% trans "Friends" %}
                    </a>
                    <a href="{% url 'community:groups' %}" class="nav-button active">
                        <i class="bi bi-people me-1"></i>
                        {% trans "Groups" %}
                    </a>
                </div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">{% trans "My Groups" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">12</div>
                <div class="stat-label">{% trans "Available Groups" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">47</div>
                <div class="stat-label">{% trans "Total Members" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">8</div>
                <div class="stat-label">{% trans "Active Today" %}</div>
            </div>
        </div>

        <!-- Language Filter -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">
                <i class="bi bi-globe me-1"></i>
                {% trans "All Languages" %}
            </button>
            <button class="filter-tab" data-filter="english">
                ðŸ‡¬ðŸ‡§ English
            </button>
            <button class="filter-tab" data-filter="french">
                ðŸ‡«ðŸ‡· FranÃ§ais
            </button>
            <button class="filter-tab" data-filter="spanish">
                ðŸ‡ªðŸ‡¸ EspaÃ±ol
            </button>
            <button class="filter-tab" data-filter="german">
                ðŸ‡©ðŸ‡ª Deutsch
            </button>
            <button class="filter-tab" data-filter="italian">
                ðŸ‡®ðŸ‡¹ Italiano
            </button>
        </div>

        <!-- My Groups -->
        <div class="section my-groups-section mb-4">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="bi bi-bookmark-heart me-2"></i>
                    {% trans "My Groups" %}
                </h3>
                <button class="btn-simple" data-bs-toggle="modal" data-bs-target="#createGroupModal">
                    <i class="bi bi-plus me-1"></i>
                    {% trans "Create Group" %}
                </button>
            </div>
            <div class="section-content">
                <div class="groups-grid">
                    <!-- Create New Group Card -->
                    <div class="group-card create-group-card" data-bs-toggle="modal" data-bs-target="#createGroupModal">
                        <i class="bi bi-plus-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <h4>{% trans "Create New Group" %}</h4>
                        <p style="opacity: 0.9; font-size: 14px;">{% trans "Start your own study group" %}</p>
                    </div>
                    
                    <!-- My Groups -->
                    {% for i in "123" %}
                    <div class="group-card">
                        <div class="group-header">
                            <div>
                                <div class="group-title">French Conversation Club</div>
                                <div class="group-badges">
                                    <span class="group-badge language">ðŸ‡«ðŸ‡· FranÃ§ais</span>
                                    <span class="group-badge level">Intermediate</span>
                                    <span class="group-badge status">Active</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="color: #6B7280; margin-bottom: 16px; font-size: 14px; line-height: 1.4;">
                            Practice French conversation with native speakers and learners. We meet daily for 30-minute sessions.
                        </div>
                        
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-number">15</div>
                                <div class="group-stat-label">Members</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-number">8</div>
                                <div class="group-stat-label">Online</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-number">24</div>
                                <div class="group-stat-label">Messages</div>
                            </div>
                        </div>
                        
                        <div class="group-members">
                            <div class="member-avatar">M1</div>
                            <div class="member-avatar">A2</div>
                            <div class="member-avatar">J3</div>
                            <div class="member-avatar">S4</div>
                            <span class="member-count">+11 more</span>
                        </div>
                        
                        <div class="group-actions">
                            <button class="btn-simple btn-sm">
                                <i class="bi bi-box-arrow-in-right me-1"></i>
                                {% trans "Enter Group" %}
                            </button>
                            <button class="btn-simple btn-secondary btn-sm">
                                <i class="bi bi-gear me-1"></i>
                                {% trans "Manage" %}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- All Groups -->
        <div class="section">
            <div class="section-header">
                <h3 class="section-title">{% trans "Discover Groups" %}</h3>
                <div class="d-flex gap-2">
                    <input type="text" class="form-control" placeholder="{% trans 'Search groups...' %}" style="width: 200px;">
                    <button class="btn-simple btn-secondary">
                        <i class="bi bi-funnel"></i>
                    </button>
                </div>
            </div>
            <div class="section-content">
                <div class="groups-grid">
                    {% for i in "123456789" %}
                    <div class="group-card group-item" data-language="{% cycle 'english' 'french' 'spanish' 'german' 'english' 'french' 'italian' 'english' 'spanish' %}">
                        <div class="group-header">
                            <div>
                                <div class="group-title">{% cycle 'English Speaking Club' 'Grammaire FranÃ§aise' 'Spanish Beginners' 'German Literature' 'Business English' 'French Culture' 'Italian Cooking Chat' 'IELTS Preparation' 'Travel Spanish' %}</div>
                                <div class="group-badges">
                                    <span class="group-badge language">{% cycle 'ðŸ‡¬ðŸ‡§ English' 'ðŸ‡«ðŸ‡· FranÃ§ais' 'ðŸ‡ªðŸ‡¸ EspaÃ±ol' 'ðŸ‡©ðŸ‡ª Deutsch' 'ðŸ‡¬ðŸ‡§ English' 'ðŸ‡«ðŸ‡· FranÃ§ais' 'ðŸ‡®ðŸ‡¹ Italiano' 'ðŸ‡¬ðŸ‡§ English' 'ðŸ‡ªðŸ‡¸ EspaÃ±ol' %}</span>
                                    <span class="group-badge level">{% cycle 'Beginner' 'Intermediate' 'Beginner' 'Advanced' 'Intermediate' 'Intermediate' 'Beginner' 'Advanced' 'Beginner' %}</span>
                                    <span class="group-badge type">{% cycle 'Speaking' 'Grammar' 'General' 'Reading' 'Business' 'Culture' 'Conversation' 'Test Prep' 'Travel' %}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="color: #6B7280; margin-bottom: 16px; font-size: 14px; line-height: 1.4;">
                            {% cycle 'Practice English speaking with confidence. Daily conversations and pronunciation tips.' 'Approfondissez vos connaissances grammaticales franÃ§aises avec des exercices pratiques.' 'Learn Spanish basics in a friendly environment. Perfect for beginners!' 'Explore German literature and improve reading comprehension skills.' 'Professional English for business contexts. Network and learn together.' 'DÃ©couvrez la culture franÃ§aise Ã  travers la langue et les traditions.' 'Learn Italian through cooking recipes and food culture discussions.' 'Prepare for IELTS exam with structured practice and feedback.' 'Learn practical Spanish phrases for your travels and adventures.' %}
                        </div>
                        
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-number">{% cycle '12' '8' '15' '6' '20' '11' '9' '14' '7' %}</div>
                                <div class="group-stat-label">Members</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-number">{% cycle '5' '3' '7' '2' '9' '4' '3' '6' '2' %}</div>
                                <div class="group-stat-label">Online</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-number">{% cycle '42' '18' '33' '12' '67' '25' '19' '51' '14' %}</div>
                                <div class="group-stat-label">Messages</div>
                            </div>
                        </div>
                        
                        <div class="group-members">
                            {% for j in "1234" %}
                            <div class="member-avatar">{% cycle 'A' 'B' 'C' 'D' 'E' 'F' 'G' 'H' 'I' %}{{ j }}</div>
                            {% endfor %}
                            <span class="member-count">+{% cycle '8' '4' '11' '2' '16' '7' '5' '10' '3' %} more</span>
                        </div>
                        
                        <div class="group-actions">
                            <button class="btn-simple btn-sm join-group" data-group-id="{{ forloop.counter }}">
                                <i class="bi bi-plus me-1"></i>
                                {% trans "Join Group" %}
                            </button>
                            <button class="btn-simple btn-secondary btn-sm view-group" data-group-id="{{ forloop.counter }}">
                                <i class="bi bi-eye me-1"></i>
                                {% trans "Preview" %}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Group Modal -->
<div class="modal fade" id="createGroupModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: var(--linguify-gradient); color: white;">
                <h5 class="modal-title">
                    <i class="bi bi-plus-circle me-2"></i>
                    {% trans "Create New Study Group" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createGroupForm">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="groupName" class="form-label fw-semibold">{% trans "Group Name" %} *</label>
                                <input type="text" class="form-control-modern" id="groupName" placeholder="{% trans 'e.g., French Conversation Practice' %}" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="groupLanguage" class="form-label fw-semibold">{% trans "Language" %} *</label>
                                <select class="form-control-modern" id="groupLanguage" required>
                                    <option value="">{% trans "Select language" %}</option>
                                    <option value="english">ðŸ‡¬ðŸ‡§ English</option>
                                    <option value="french">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                                    <option value="spanish">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                                    <option value="german">ðŸ‡©ðŸ‡ª Deutsch</option>
                                    <option value="italian">ðŸ‡®ðŸ‡¹ Italiano</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="groupDescription" class="form-label fw-semibold">{% trans "Description" %} *</label>
                        <textarea class="form-control-modern" id="groupDescription" rows="3" 
                                  placeholder="{% trans 'Describe what your group is about, what level, meeting schedule, etc.' %}" required></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="groupLevel" class="form-label fw-semibold">{% trans "Level" %}</label>
                                <select class="form-control-modern" id="groupLevel">
                                    <option value="beginner">{% trans "Beginner (A1-A2)" %}</option>
                                    <option value="intermediate" selected>{% trans "Intermediate (B1-B2)" %}</option>
                                    <option value="advanced">{% trans "Advanced (C1-C2)" %}</option>
                                    <option value="mixed">{% trans "Mixed Levels" %}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="groupType" class="form-label fw-semibold">{% trans "Focus Area" %}</label>
                                <select class="form-control-modern" id="groupType">
                                    <option value="conversation">{% trans "Conversation Practice" %}</option>
                                    <option value="grammar">{% trans "Grammar Study" %}</option>
                                    <option value="vocabulary">{% trans "Vocabulary Building" %}</option>
                                    <option value="reading">{% trans "Reading Club" %}</option>
                                    <option value="writing">{% trans "Writing Practice" %}</option>
                                    <option value="culture">{% trans "Culture & Traditions" %}</option>
                                    <option value="business">{% trans "Business Language" %}</option>
                                    <option value="test">{% trans "Test Preparation" %}</option>
                                    <option value="general">{% trans "General Study" %}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">{% trans "Group Guidelines" %}</label>
                        <div style="background: var(--linguify-gray-50); padding: 16px; border-radius: 8px;">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="respectfulRule" checked disabled>
                                <label class="form-check-label" for="respectfulRule" style="color: #6B7280;">
                                    <i class="bi bi-heart text-danger me-1"></i>
                                    {% trans "Members must be respectful and encouraging" %}
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="activeRule">
                                <label class="form-check-label" for="activeRule" style="color: #6B7280;">
                                    <i class="bi bi-chat-dots text-primary me-1"></i>
                                    {% trans "Members should participate actively" %}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="languageRule">
                                <label class="form-check-label" for="languageRule" style="color: #6B7280;">
                                    <i class="bi bi-translate text-success me-1"></i>
                                    {% trans "Practice target language primarily" %}
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-simple btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                <button type="button" class="btn-simple" id="createGroupBtn">
                    <i class="bi bi-plus me-1"></i>
                    {% trans "Create Group" %}
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Language filter functionality
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active from all tabs
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            
            // Add active to clicked tab
            this.classList.add('active');
            
            // Filter groups
            const language = this.dataset.filter;
            filterGroups(language);
        });
    });
    
    // Join group functionality
    document.querySelectorAll('.join-group').forEach(button => {
        button.addEventListener('click', function() {
            const groupId = this.dataset.groupId;
            joinGroup(this);
        });
    });
    
    // View group functionality
    document.querySelectorAll('.view-group').forEach(button => {
        button.addEventListener('click', function() {
            const groupId = this.dataset.groupId;
            alert('{% trans "Group preview coming soon!" %}');
        });
    });
    
    // Create group functionality
    document.getElementById('createGroupBtn').addEventListener('click', function() {
        createGroup();
    });
    
    function filterGroups(language) {
        const groups = document.querySelectorAll('.group-item');
        
        groups.forEach(group => {
            if (language === 'all' || group.dataset.language === language) {
                group.style.display = 'block';
            } else {
                group.style.display = 'none';
            }
        });
    }
    
    function joinGroup(button) {
        const originalText = button.innerHTML;
        button.disabled = true;
        button.classList.add('btn-loading');
        button.innerHTML = '{% trans "Joining..." %}';
        
        setTimeout(() => {
            button.innerHTML = '<i class="bi bi-check me-1"></i>{% trans "Joined!" %}';
            button.classList.remove('btn-loading');
            button.classList.add('btn-success');
            
            // Update to "Enter Group" after a moment
            setTimeout(() => {
                button.innerHTML = '<i class="bi bi-box-arrow-in-right me-1"></i>{% trans "Enter Group" %}';
                button.classList.remove('join-group', 'btn-success');
                button.classList.add('open-group');
                button.disabled = false;
            }, 1500);
        }, 1200);
    }
    
    function createGroup() {
        const name = document.getElementById('groupName').value.trim();
        const description = document.getElementById('groupDescription').value.trim();
        const language = document.getElementById('groupLanguage').value;
        
        if (!name || !description || !language) {
            alert('{% trans "Please fill in all required fields." %}');
            return;
        }
        
        const createBtn = document.getElementById('createGroupBtn');
        createBtn.disabled = true;
        createBtn.classList.add('btn-loading');
        createBtn.innerHTML = '{% trans "Creating..." %}';
        
        setTimeout(() => {
            alert('{% trans "Group created successfully! You can now invite members and start studying together." %}');
            bootstrap.Modal.getInstance(document.getElementById('createGroupModal')).hide();
            document.getElementById('createGroupForm').reset();
            createBtn.disabled = false;
            createBtn.classList.remove('btn-loading');
            createBtn.innerHTML = '<i class="bi bi-plus me-1"></i>{% trans "Create Group" %}';
        }, 2000);
    }
});
</script>
{% endblock %}