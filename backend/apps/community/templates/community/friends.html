{% extends "saas_web/base.html" %}
{% load i18n static %}

{% block title %}{% trans "My Friends" %} | Open Linguify{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'community/css/community-clean.css' %}">
<style>
.friend-status {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    font-weight: 500;
}

.friend-status.online {
    color: var(--linguify-success);
}

.friend-status.offline {
    color: #6B7280;
}

.friend-actions {
    display: flex;
    gap: 6px;
}

.friend-request-card {
    background: rgba(45, 91, 186, 0.05);
    border-left: 3px solid var(--linguify-primary);
}

.tabs-nav {
    display: flex;
    gap: 4px;
    margin-bottom: 20px;
    background: var(--linguify-white);
    border-radius: 8px;
    padding: 4px;
    border: 1px solid var(--linguify-gray-200);
}

.tab-button {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: #6B7280;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

.tab-button.active {
    background: var(--linguify-gradient);
    color: var(--linguify-white);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.online-indicator {
    width: 8px;
    height: 8px;
    background: var(--linguify-success);
    border-radius: 50%;
    display: inline-block;
}

.offline-indicator {
    width: 8px;
    height: 8px;
    background: #6B7280;
    border-radius: 50%;
    display: inline-block;
}
</style>
{% endblock %}

{% block content %}
<div class="community-page">
    <div class="community-container">
        <!-- Header avec navbar intégrée -->
        <div class="community-header">
            <!-- Navigation unifiée -->
            {% include 'community/components/navbar.html' %}
        </div>

        <!-- Main scrollable content -->
        <div class="community-main">

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-number">{{ friends_count|default:15 }}</div>
                <div class="stat-label">{% trans "Friends" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ friend_requests_count|default:3 }}</div>
                <div class="stat-label">{% trans "Pending Requests" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">8</div>
                <div class="stat-label">{% trans "Online Now" %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div class="stat-label">{% trans "New This Week" %}</div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-nav">
            <button class="tab-button active" data-tab="friends">
                <i class="bi bi-people me-1"></i>
                {% trans "All Friends" %} (15)
            </button>
            <button class="tab-button" data-tab="requests">
                <i class="bi bi-envelope me-1"></i>
                {% trans "Friend Requests" %} (3)
            </button>
            <button class="tab-button" data-tab="sent">
                <i class="bi bi-send me-1"></i>
                {% trans "Sent Requests" %} (2)
            </button>
            <button class="tab-button" data-tab="online">
                <i class="bi bi-circle-fill text-success me-1"></i>
                {% trans "Online" %} (8)
            </button>
        </div>

        <!-- Tab: All Friends -->
        <div class="tab-content active" id="friends">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">{% trans "All Friends" %}</h3>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control" placeholder="{% trans 'Search friends...' %}" style="width: 200px;">
                        <button class="btn-simple btn-secondary">
                            <i class="bi bi-funnel"></i>
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="user-grid">
                        {% for i in "123456789012345" %}
                        <div class="user-card">
                            <div class="user-header">
                                <div class="user-avatar">
                                    M{{ forloop.counter }}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">Marie Dupont</div>
                                    <div class="friend-status {% cycle 'online' 'offline' 'online' %}">
                                        <span class="{% cycle 'online' 'offline' 'online' %}-indicator"></span>
                                        {% cycle 'En ligne' 'Hors ligne' 'En ligne' %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="user-languages">
                                <span class="language-tag native">Français</span>
                                <span class="language-tag learning">Anglais</span>
                            </div>
                            
                            <div class="friend-actions">
                                <button class="btn-simple btn-sm">
                                    <i class="bi bi-chat-dots me-1"></i>
                                    {% trans "Message" %}
                                </button>
                                <button class="btn-simple btn-secondary btn-sm">
                                    <i class="bi bi-person-x me-1"></i>
                                    {% trans "Remove" %}
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Friend Requests -->
        <div class="tab-content" id="requests">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">{% trans "Friend Requests" %}</h3>
                </div>
                <div class="section-content">
                    <div class="user-grid">
                        {% for i in "123" %}
                        <div class="user-card friend-request-card">
                            <div class="user-header">
                                <div class="user-avatar">
                                    J{{ forloop.counter }}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">John Smith</div>
                                    <div style="color: #6B7280; font-size: 12px;">
                                        {% trans "2 hours ago" %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="user-languages">
                                <span class="language-tag native">English</span>
                                <span class="language-tag learning">Français</span>
                            </div>
                            
                            <div class="user-bio">
                                "Hello! I'm learning French and would love to practice with native speakers. I can help you with English in return!"
                            </div>
                            
                            <div class="friend-actions">
                                <button class="btn-simple btn-sm accept-request" data-user-id="{{ forloop.counter }}">
                                    <i class="bi bi-check-lg me-1"></i>
                                    {% trans "Accept" %}
                                </button>
                                <button class="btn-simple btn-secondary btn-sm decline-request" data-user-id="{{ forloop.counter }}">
                                    <i class="bi bi-x-lg me-1"></i>
                                    {% trans "Decline" %}
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Sent Requests -->
        <div class="tab-content" id="sent">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">{% trans "Sent Requests" %}</h3>
                </div>
                <div class="section-content">
                    <div class="user-grid">
                        {% for i in "12" %}
                        <div class="user-card">
                            <div class="user-header">
                                <div class="user-avatar">
                                    A{{ forloop.counter }}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">Anna González</div>
                                    <div style="color: #6B7280; font-size: 12px;">
                                        {% trans "Sent 1 day ago" %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="user-languages">
                                <span class="language-tag native">Español</span>
                                <span class="language-tag learning">Français</span>
                            </div>
                            
                            <div class="friend-actions">
                                <button class="btn-simple btn-secondary btn-sm cancel-request" data-user-id="{{ forloop.counter }}">
                                    <i class="bi bi-x-circle me-1"></i>
                                    {% trans "Cancel Request" %}
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Online Friends -->
        <div class="tab-content" id="online">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">{% trans "Friends Online" %}</h3>
                </div>
                <div class="section-content">
                    <div class="user-grid">
                        {% for i in "12345678" %}
                        <div class="user-card">
                            <div class="user-header">
                                <div class="user-avatar">
                                    O{{ forloop.counter }}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">Online Friend {{ forloop.counter }}</div>
                                    <div class="friend-status online">
                                        <span class="online-indicator"></span>
                                        {% trans "Online" %} • {% trans "Active now" %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="user-languages">
                                <span class="language-tag native">{% cycle 'English' 'Français' 'Español' 'Deutsch' %}</span>
                                <span class="language-tag learning">{% cycle 'Français' 'English' 'English' 'English' %}</span>
                            </div>
                            
                            <div class="friend-actions">
                                <button class="btn-simple btn-sm">
                                    <i class="bi bi-chat-dots me-1"></i>
                                    {% trans "Start Chat" %}
                                </button>
                                <button class="btn-simple btn-secondary btn-sm">
                                    <i class="bi bi-telephone me-1"></i>
                                    {% trans "Call" %}
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- End community-main -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Remove active from all tabs and contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active to clicked tab and corresponding content
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Accept friend request
    document.querySelectorAll('.accept-request').forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;
            this.innerHTML = '<i class="bi bi-check me-1"></i>{% trans "Accepted" %}';
            this.classList.add('btn-success');
            this.disabled = true;
            
            // Hide decline button
            this.parentElement.querySelector('.decline-request').style.display = 'none';
        });
    });
    
    // Decline friend request
    document.querySelectorAll('.decline-request').forEach(button => {
        button.addEventListener('click', function() {
            const card = this.closest('.user-card');
            card.style.transition = 'all 0.3s ease';
            card.style.opacity = '0';
            card.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                card.remove();
            }, 300);
        });
    });
    
    // Cancel sent request
    document.querySelectorAll('.cancel-request').forEach(button => {
        button.addEventListener('click', function() {
            const card = this.closest('.user-card');
            card.style.transition = 'all 0.3s ease';
            card.style.opacity = '0';
            card.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                card.remove();
            }, 300);
        });
    });
});
</script>
{% endblock %}