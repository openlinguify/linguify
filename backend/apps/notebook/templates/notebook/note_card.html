<!-- Template partiel pour une carte de note -->
{% for note in notes %}
<div class="note-card"
     :class="{
         'selected': selectedNotes.includes({{ note.id }}),
         'pinned': {{ note.is_pinned|yesno:'true,false' }}
     }">

    <!-- Header de la carte -->
    <div class="note-header">
        <div class="note-selection">
            <input
                type="checkbox"
                @change="toggleSelection({{ note.id }})"
                :checked="selectedNotes.includes({{ note.id }})"
            >
        </div>

        <h3 class="note-title">{{ note.title|truncatechars:50 }}</h3>

        <div class="note-actions">
            {% if note.is_pinned %}
            <button @click="togglePin({ id: {{ note.id }}, is_pinned: true })"
                    class="note-action" title="Dépingler">
                <i class="fas fa-thumbtack text-yellow-500"></i>
            </button>
            {% else %}
            <button @click="togglePin({ id: {{ note.id }}, is_pinned: false })"
                    class="note-action" title="Épingler">
                <i class="far fa-thumbtack"></i>
            </button>
            {% endif %}

            <button @click="editNote({{ note|escapejs }})"
                    class="note-action" title="Modifier">
                <i class="fas fa-edit"></i>
            </button>

            <button @click="deleteNote({{ note.id }})"
                    class="note-action" title="Supprimer">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <!-- Contenu de la note -->
    <div class="note-content">
        {{ note.content|truncatechars:150|linebreaks }}
    </div>

    {% if note.translation %}
    <div class="note-translation">
        <strong>Traduction:</strong> {{ note.translation|truncatechars:100 }}
    </div>
    {% endif %}

    {% if note.pronunciation %}
    <div class="note-pronunciation">
        <strong>Prononciation:</strong> {{ note.pronunciation }}
    </div>
    {% endif %}

    <!-- Métadonnées et tags -->
    <div class="note-meta">
        <div class="note-tags">
            {% if note.language %}
            <span class="note-tag language">{{ note.get_language_display|default:note.language }}</span>
            {% endif %}

            {% if note.difficulty %}
            <span class="note-tag difficulty">{{ note.get_difficulty_display }}</span>
            {% endif %}

            {% if note.note_type %}
            <span class="note-tag type">{{ note.get_note_type_display }}</span>
            {% endif %}
        </div>

        <div class="note-date" title="Modifiée le {{ note.updated_at }}">
            {{ note.updated_at|timesince }} ago
        </div>
    </div>

    <!-- Barre d'état -->
    <div class="note-status">
        {% if note.is_archived %}
        <span class="status-badge archived">Archivée</span>
        {% endif %}

        {% if note.review_count > 0 %}
        <span class="status-badge reviews">{{ note.review_count }} révision{{ note.review_count|pluralize }}</span>
        {% endif %}
    </div>
</div>
{% empty %}
<!-- État vide géré par Alpine.js dans le template principal -->
{% endfor %}