{% extends 'saas_web/base.html' %}
{% load static %}
{% load i18n %}
{% load humanize %}

{% block title %}{{ profile_user.username }} - {% trans "Profile" %} | Open Linguify{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'authentication/css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Hero Profile Section -->
    <div class="profile-hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <!-- Profile Avatar & Basic Info -->
            <div class="profile-main-info">
                <div class="avatar-container">
                    {% if profile_user.get_profile_picture_url %}
                        <img src="{{ profile_user.get_profile_picture_url }}" alt="{% trans 'Profile picture' %}" class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar avatar-placeholder">
                            <i class="bi bi-person-fill"></i>
                        </div>
                    {% endif %}
                    {% if user == profile_user %}
                    <button class="avatar-edit-btn" data-bs-toggle="tooltip" title="{% trans 'Change profile picture' %}">
                        <i class="bi bi-camera-fill"></i>
                    </button>
                    {% endif %}
                    <div class="status-indicator online" title="{% trans 'Online' %}"></div>
                </div>
                
                <div class="profile-identity">
                    <h1 class="profile-display-name">{{ profile_user.name|default:profile_user.username }}</h1>
                    <p class="profile-handle">@{{ profile_user.username }}</p>
                    
                    <div class="profile-badges">
                        <span class="badge badge-verified">
                            <i class="bi bi-patch-check-fill"></i>
                            {% trans "Verified Learner" %}
                        </span>
                        <span class="badge badge-level">
                            <i class="bi bi-star-fill"></i>
                            {{ profile_user.get_language_level_display|default:"A1" }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="bi bi-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ profile_user.created_at|timesince }}</div>
                        <div class="stat-label">{% trans "Learning since" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="bi bi-trophy"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ profile_user.get_language_level_display|default:"A1" }}</div>
                        <div class="stat-label">{% trans "Current level" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="bi bi-target"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ profile_user.get_objectives_display|default:"Personal" }}</div>
                        <div class="stat-label">{% trans "Learning goal" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="bi bi-translate"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ profile_user.get_target_language_display|default:"Spanish" }}</div>
                        <div class="stat-label">{% trans "Target language" %}</div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="profile-actions">
                {% if user == profile_user %}
                    <a href="{% url 'saas_web:settings' %}" class="btn btn-primary">
                        <i class="bi bi-gear"></i>
                        {% trans "Edit Profile" %}
                    </a>
                    <a href="{% url 'course:dashboard' %}" class="btn btn-secondary">
                        <i class="bi bi-play-circle"></i>
                        {% trans "Continue Learning" %}
                    </a>
                {% else %}
                    <button class="btn btn-primary">
                        <i class="bi bi-person-plus"></i>
                        {% trans "Follow" %}
                    </button>
                    <button class="btn btn-secondary">
                        <i class="bi bi-chat-dots"></i>
                        {% trans "Message" %}
                    </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">
        <!-- Left Column - Main Content -->
        <div class="main-content">
            <!-- Learning Dashboard Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="header-content">
                        <div class="header-icon">
                            <i class="bi bi-mortarboard-fill"></i>
                        </div>
                        <div class="header-text">
                            <h2 class="card-title">{% trans "Learning Dashboard" %}</h2>
                            <p class="card-subtitle">{% trans "Track your language learning progress" %}</p>
                        </div>
                    </div>
                    <a href="{% url 'course:dashboard' %}" class="view-all-btn">
                        {% trans "View All" %}
                        <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
                
                <div class="card-content">
                    <!-- Progress Overview -->
                    <div class="progress-overview">
                        <div class="progress-item">
                            <div class="progress-info">
                                <span class="progress-label">{% trans "Daily Goal" %}</span>
                                <span class="progress-value">6/15 {% trans "min" %}</span>
                            </div>
                            <div class="progress-bar-wrapper">
                                <div class="progress-bar-modern" data-width="40"></div>
                            </div>
                            <span class="progress-percentage">40%</span>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-info">
                                <span class="progress-label">{% trans "Weekly Streak" %}</span>
                                <span class="progress-value">5/7 {% trans "days" %}</span>
                            </div>
                            <div class="progress-bar-wrapper">
                                <div class="progress-bar-modern success" data-width="71"></div>
                            </div>
                            <span class="progress-percentage">71%</span>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <a href="{% url 'course:dashboard' %}" class="action-card primary">
                            <div class="action-icon">
                                <i class="bi bi-play-circle-fill"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">{% trans "Continue Lesson" %}</span>
                                <span class="action-subtitle">{% trans "Spanish Basics" %}</span>
                            </div>
                        </a>
                        
                        {% for app in user_quick_actions %}
                        <a href="{{ app.route_path }}" class="action-card">
                            <div class="action-icon">
                                <i class="bi {{ app.icon_class }}"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">{{ app.display_name }}</span>
                                <span class="action-subtitle">{{ app.subtitle|default:"Available" }}</span>
                            </div>
                        </a>
                        {% empty %}
                        <a href="{% url 'revision_web:main' %}" class="action-card">
                            <div class="action-icon">
                                <i class="bi bi-arrow-clockwise"></i>
                            </div>
                            <div class="action-content">
                                <span class="action-title">{% trans "Review" %}</span>
                                <span class="action-subtitle">{% trans "12 cards due" %}</span>
                            </div>
                        </a>
                        {% endfor %}
                        
                    </div>
                </div>
            </div>

            <!-- Language Progress Card -->
            <div class="language-progress-card">
                <div class="card-header">
                    <div class="header-content">
                        <div class="header-icon">
                            <i class="bi bi-translate"></i>
                        </div>
                        <div class="header-text">
                            <h2 class="card-title">{% trans "Language Mastery" %}</h2>
                            <p class="card-subtitle">{% trans "Your learning progression" %}</p>
                        </div>
                    </div>
                </div>
                
                <div class="card-content">
                    {% for lang in language_progress %}
                    <div class="language-mastery-item">
                        <div class="language-info">
                            <div class="language-flag">🇪🇸</div>
                            <div class="language-details">
                                <h4 class="language-name">{{ lang.name|default:"Spanish" }}</h4>
                                <span class="language-level-badge">{{ lang.level|default:"B1" }}</span>
                            </div>
                            <div class="language-score">{{ lang.percentage|default:"65" }}%</div>
                        </div>
                        <div class="language-progress-bar">
                            <div class="progress-track">
                                <div class="progress-fill" data-width="{{ lang.percentage|default:'65' }}"></div>
                            </div>
                        </div>
                        <div class="proficiency-levels">
                            <span class="level-marker active" title="A1">A1</span>
                            <span class="level-marker active" title="A2">A2</span>
                            <span class="level-marker active" title="B1">B1</span>
                            <span class="level-marker" title="B2">B2</span>
                            <span class="level-marker" title="C1">C1</span>
                            <span class="level-marker" title="C2">C2</span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="language-mastery-item">
                        <div class="language-info">
                            <div class="language-flag">🇪🇸</div>
                            <div class="language-details">
                                <h4 class="language-name">Spanish</h4>
                                <span class="language-level-badge">B1</span>
                            </div>
                            <div class="language-score">65%</div>
                        </div>
                        <div class="language-progress-bar">
                            <div class="progress-track">
                                <div class="progress-fill" data-width="65"></div>
                            </div>
                        </div>
                        <div class="proficiency-levels">
                            <span class="level-marker active" title="A1">A1</span>
                            <span class="level-marker active" title="A2">A2</span>
                            <span class="level-marker active" title="B1">B1</span>
                            <span class="level-marker" title="B2">B2</span>
                            <span class="level-marker" title="C1">C1</span>
                            <span class="level-marker" title="C2">C2</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Right Column - Sidebar -->
        <div class="sidebar-content">
            <!-- Apps & Tools -->
            <div class="apps-tools-card">
                <div class="card-header">
                    <h3 class="card-title">{% trans "Learning Tools" %}</h3>
                    <a href="{% url 'saas_web:app_store' %}" class="view-all-btn">
                        {% trans "Browse" %}
                        <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
                
                <div class="card-content">
                    <div class="tools-grid">
                        {% for app in user_apps %}
                        <a href="{{ app.route_path }}" class="tool-item">
                            <div class="tool-icon">
                                <img src="http://localhost:8000/app-icons/{{ app.code }}/icon.png" alt="{{ app.display_name }} icon" style="width: 24px; height: 24px; object-fit: contain;">
                            </div>
                            <div class="tool-info">
                                <span class="tool-name">{{ app.display_name }}</span>
                                <span class="tool-usage">{{ app.last_used|naturaltime }}</span>
                            </div>
                        </a>
                        {% empty %}
                        <a href="/chat" class="tool-item">
                            <div class="tool-icon">
                                <img src="http://localhost:8000/app-icons/chat/icon.png" alt="Chat icon" style="width: 24px; height: 24px; object-fit: contain;">
                            </div>
                            <div class="tool-info">
                                <span class="tool-name">Chat</span>
                                <span class="tool-usage">il y a 2 heures</span>
                            </div>
                        </a>
                        <a href="/language-ai" class="tool-item">
                            <div class="tool-icon">
                                <img src="http://localhost:8000/app-icons/language_ai/icon.png" alt="AI Conversation icon" style="width: 24px; height: 24px; object-fit: contain;">
                            </div>
                            <div class="tool-info">
                                <span class="tool-name">AI Conversation</span>
                                <span class="tool-usage">il y a 2 heures</span>
                            </div>
                        </a>
                        <a href="/notebook" class="tool-item">
                            <div class="tool-icon">
                                <img src="http://localhost:8000/app-icons/notebook/icon.png" alt="Notes icon" style="width: 24px; height: 24px; object-fit: contain;">
                            </div>
                            <div class="tool-info">
                                <span class="tool-name">Notes</span>
                                <span class="tool-usage">il y a 2 heures</span>
                            </div>
                        </a>
                        <a href="/quizz" class="tool-item">
                            <div class="tool-icon">
                                <img src="http://localhost:8000/app-icons/quizz/icon.png" alt="Quiz icon" style="width: 24px; height: 24px; object-fit: contain;">
                            </div>
                            <div class="tool-info">
                                <span class="tool-name">Quiz</span>
                                <span class="tool-usage">il y a 2 heures</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Community & Achievements -->
            <div class="community-achievements-card">
                <div class="card-header">
                    <h3 class="card-title">{% trans "Community & Achievements" %}</h3>
                </div>
                
                <div class="card-content">
                    <!-- Achievement Highlights -->
                    <div class="achievements-preview">
                        <div class="achievement-item">
                            <div class="achievement-icon gold">
                                <i class="bi bi-trophy-fill"></i>
                            </div>
                            <div class="achievement-info">
                                <span class="achievement-title">{% trans "Learning Streak" %}</span>
                                <span class="achievement-desc">5 {% trans "days in a row" %}</span>
                            </div>
                        </div>
                        
                        <div class="achievement-item">
                            <div class="achievement-icon blue">
                                <i class="bi bi-star-fill"></i>
                            </div>
                            <div class="achievement-info">
                                <span class="achievement-title">{% trans "Level Up" %}</span>
                                <span class="achievement-desc">{% trans "Reached B1" %}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Community Actions -->
                    <div class="community-actions">
                        <a href="{% url 'community:discover' %}" class="community-btn">
                            <i class="bi bi-people"></i>
                            <span>{% trans "Find Partners" %}</span>
                        </a>
                        <a href="{% url 'community:feed' %}" class="community-btn">
                            <i class="bi bi-chat-dots"></i>
                            <span>{% trans "Join Discussion" %}</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Activity Summary -->
            <div class="activity-summary-card">
                <div class="card-header">
                    <h3 class="card-title">{% trans "This Week" %}</h3>
                </div>
                
                <div class="card-content">
                    <div class="weekly-stats">
                        <div class="week-stat">
                            <span class="stat-number">{{ profile_user.created_at|timesince }}</span>
                            <span class="stat-label">{% trans "Learning since" %}</span>
                        </div>
                        <div class="week-stat">
                            <span class="stat-number">{% trans "Today" %}</span>
                            <span class="stat-label">{% trans "Last active" %}</span>
                        </div>
                    </div>
                    
                    <div class="activity-indicator">
                        <div class="activity-dot active" title="{% trans 'Monday' %}"></div>
                        <div class="activity-dot active" title="{% trans 'Tuesday' %}"></div>
                        <div class="activity-dot active" title="{% trans 'Wednesday' %}"></div>
                        <div class="activity-dot active" title="{% trans 'Thursday' %}"></div>
                        <div class="activity-dot active" title="{% trans 'Friday' %}"></div>
                        <div class="activity-dot" title="{% trans 'Saturday' %}"></div>
                        <div class="activity-dot" title="{% trans 'Sunday' %}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'authentication/js/profile.js' %}"></script>
{% endblock %}