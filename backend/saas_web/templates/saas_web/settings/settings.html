{% extends 'saas_web/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Param√®tres - Open Linguify{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #f4f5f7 !important;
        font-family: "Lucida Grande", Helvetica, Verdana, Arial, sans-serif !important;
    }

    /* Override ALL base.html container styles */
    .main-content {
        padding: 0 !important;
        margin: 0 !important;
    }

    .container,
    .container-fluid {
        max-width: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    .content-area {
        max-width: none !important;
        width: 100vw !important;
        height: calc(100vh - 60px) !important;
        padding: 0 !important;
        margin: 0 !important;
        display: flex;
        background: #f4f5f7;
        position: absolute;
        top: 60px;
        left: 0;
    }

    .settings-sidebar {
        width: 230px;
        background: #0077ff;
        color: white;
        padding: 0;
        overflow-y: auto;
        box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
        height: calc(100vh - 60px);
        flex-shrink: 0;
    }

    .settings-main {
        flex: 1;
        background: #f4f5f7;
        padding: 0;
        overflow-y: auto;
        height: calc(100vh - 60px);
        display: flex;
        flex-direction: column;
    }

    .main-content-header {
        background: white;
        border-bottom: 1px solid #dee2e6;
        padding: 12px 16px;
        flex-shrink: 0;
        z-index: 10;
    }

    .settings-tabs {
        background: white;
        border-bottom: 1px solid #dee2e6;
        padding: 0 16px;
        margin-bottom: 0;
        flex-shrink: 0;
    }

    .main-content-body {
        padding: 16px;
        flex: 1;
        overflow-y: auto;
    }

    .breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #6c757d;
    }

    .breadcrumb-nav .active {
        color: #495057;
        font-weight: 500;
    }

    .sidebar-header {
        padding: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: #7c3b6e;
    }

    .sidebar-user {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .user-info {
        color: white;
    }

    .user-name {
        font-size: 14px;
        font-weight: 500;
        margin: 0;
    }

    .user-role {
        font-size: 12px;
        opacity: 0.8;
        margin: 0;
    }

    .sidebar-section {
        margin: 0;
    }

    .sidebar-menu {
        list-style: none;
        padding: 0;
        margin: 8px 0;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        padding: 8px 16px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        transition: all 0.15s ease;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 13px;
    }

    .sidebar-item:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-decoration: none;
    }

    .sidebar-item.active {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border-right: 3px solid #f0ad4e;
    }

    .sidebar-item.active:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .sidebar-item i {
        width: 16px;
        margin-right: 8px;
        font-size: 14px;
        text-align: center;
    }

    .app-icon {
        width: 16px;
        height: 16px;
        border-radius: 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 8px;
        font-size: 12px;
        color: white;
        background: rgba(255, 255, 255, 0.2);
    }

    .content-section {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        margin-bottom: 16px;
        overflow: hidden;
    }

    .section-header {
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 12px 16px;
        color: #495057;
        font-weight: 500;
        font-size: 14px;
    }

    .section-content {
        padding: 16px;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-label {
        display: block;
        font-weight: 500;
        color: #495057;
        margin-bottom: 4px;
        font-size: 13px;
    }

    .form-control {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ced4da;
        border-radius: 3px;
        font-size: 13px;
        color: #495057;
        background: white;
        transition: border-color 0.15s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #875a7b;
        box-shadow: 0 0 0 2px rgba(135, 90, 123, 0.2);
    }

    .form-control:disabled {
        background: #f8f9fa;
        color: #6c757d;
    }

    .btn-primary {
        background: #875a7b;
        color: white;
        border: 1px solid #875a7b;
        padding: 6px 12px;
        border-radius: 3px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s ease;
    }

    .btn-primary:hover {
        background: #7c3b6e;
        border-color: #7c3b6e;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
        border: 1px solid #6c757d;
        padding: 6px 12px;
        border-radius: 3px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: all 0.15s ease;
    }

    .btn-secondary:hover {
        background: #5a6268;
        border-color: #545b62;
        color: white;
        text-decoration: none;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .file-upload-area {
        border: 2px dashed #dee2e6;
        border-radius: 4px;
        padding: 24px;
        text-align: center;
        background: #f8f9fa;
        transition: border-color 0.15s ease;
    }

    .file-upload-area:hover {
        border-color: #875a7b;
    }

    .help-text {
        font-size: 12px;
        color: #6c757d;
        margin-top: 4px;
    }

    .alert-info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        padding: 12px 16px;
        border-radius: 4px;
        font-size: 13px;
    }

    .two-column {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    @media (max-width: 768px) {
        .two-column {
            grid-template-columns: 1fr;
        }
    }

    /* Form validation styles */
    .form-control.is-valid {
        border-color: #198754;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cpath fill='%23198754' d='m2.3 6.73.8-.77L4.7 7.6 8 4.33 7.23 3.56 4.7 6.1z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px 16px;
    }

    .form-control.is-invalid {
        border-color: #dc3545;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cpath fill='%23dc3545' d='M1.5 1 6.5 6m0-5L1.5 6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px 16px;
    }

    .form-control.is-pending {
        border-color: #6c757d;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cpath fill='%236c757d' d='M4 0a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM2 4a2 2 0 1 1 4 0 2 2 0 0 1-4 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px 16px;
    }

    .form-feedback {
        font-size: 12px;
        margin-top: 4px;
        transition: all 0.15s ease;
    }

    /* Theme preview transitions */
    body {
        transition: filter 0.3s ease;
    }

    .theme-dark {
        filter: invert(0.05);
    }

    /* Loading spinner for async operations */
    .spinner-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.1em;
    }

    /* Enhanced button states */
    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-secondary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* File upload enhancement */
    .file-upload-area {
        position: relative;
        overflow: hidden;
    }

    .file-upload-area.dragover {
        border-color: #875a7b;
        background: rgba(135, 90, 123, 0.1);
    }

    /* Voice settings enhanced sliders */
    .form-range::-webkit-slider-thumb {
        background: #875a7b;
    }

    .form-range::-moz-range-thumb {
        background: #875a7b;
        border: none;
    }

    /* Accessibility improvements */
    .form-label {
        cursor: pointer;
    }

    input[type="checkbox"]:focus,
    input[type="radio"]:focus {
        box-shadow: 0 0 0 2px rgba(135, 90, 123, 0.25);
    }

    /* Auto-save indicator */
    .auto-save-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 9999;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        transition: opacity 0.3s ease;
    }

    .auto-save-indicator.saving {
        background: #ffc107;
        color: #000;
        opacity: 1;
    }

    .auto-save-indicator.saved {
        background: #198754;
        color: white;
        opacity: 1;
    }

    .auto-save-indicator.hidden {
        opacity: 0;
    }


    .settings-tab {
        display: inline-block;
        padding: 12px 16px;
        color: #6c757d;
        text-decoration: none;
        border-bottom: 2px solid transparent;
        font-size: 13px;
        font-weight: 500;
        margin-right: 16px;
        cursor: pointer;
        background: none;
        border-left: none;
        border-right: none;
        border-top: none;
    }

    .settings-tab:hover {
        color: #495057;
        text-decoration: none;
    }

    .settings-tab.active {
        color: #875a7b;
        border-bottom-color: #875a7b;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-area">
    <!-- Settings Sidebar -->
    <div class="settings-sidebar">
        <!-- User Profile Header -->
        <div class="sidebar-header">
            <div class="sidebar-user">
                <div class="user-avatar"
                    data-initials="{{ user.first_name|first|default:user.username|first|upper }}{{ user.last_name|first|upper }}">
                    {% if user.get_profile_picture_url %}
                    <img src="{{ user.get_profile_picture_url }}" alt="Photo de profil"
                        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                        data-original-src="{{ user.get_profile_picture_url }}">
                    {% else %}
                    {{ user.first_name|first|default:user.username|first|upper }}{{ user.last_name|first|upper }}
                    {% endif %}
                </div>
                <div class="user-info">
                    <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                    <div class="user-role">Administrateur</div>
                </div>
            </div>
        </div>

        <!-- General Settings -->
        <div class="sidebar-section">
            <ul class="sidebar-menu">
                <li>
                    <button class="sidebar-item active" onclick="showTab('general')">
                        <i class="bi bi-gear-fill"></i>
                        Param√®tres g√©n√©raux
                    </button>
                </li>
            </ul>
        </div>

        <!-- Apps Settings -->
        <div class="sidebar-section">
            <ul class="sidebar-menu">
                {% for app in user_apps %}
                <li>
                    <button class="sidebar-item" onclick="showTab('app-{{ app.display_name|slugify }}')">
                        <div class="app-icon">
                            <i class="bi {{ app.icon_class }}"></i>
                        </div>
                        {{ app.display_name }}
                    </button>
                </li>
                {% empty %}
                <li style="padding: 8px 16px; color: rgba(255,255,255,0.5); font-size: 12px;">
                    Aucune app install√©e
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Settings Main Content -->
    <div class="settings-main">
        <!-- Main Content Header -->
        <div class="main-content-header">
            <div class="breadcrumb-nav">
                <span>Linguify</span>
                <span>‚Ä∫</span>
                <span class="active">Param√®tres</span>
            </div>
        </div>

        <!-- Settings Tabs -->
        <div class="settings-tabs">
            <button class="settings-tab active" onclick="showSubTab('user-profile')">Profil utilisateur</button>
            <button class="settings-tab" onclick="showSubTab('general-settings')">Param√®tres g√©n√©raux</button>
            <button class="settings-tab" onclick="showSubTab('voice-settings')">Assistant vocal</button>
        </div>

        <!-- Main Content Body -->
        <div class="main-content-body">
            <!-- User Profile Tab Content -->
            <div id="user-profile" class="tab-content active">
                <form method="post" enctype="multipart/form-data" action="{% url 'saas_web:settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="setting_type" value="profile">

                    <!-- Profile Picture Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-person-circle" style="margin-right: 8px;"></i>
                            Photo de profil
                        </div>
                        <div class="section-content">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="user-avatar" style="width: 80px; height: 80px; font-size: 24px;"
                                    data-initials="{{ user.first_name|first|default:user.username|first|upper }}{{ user.last_name|first|upper }}">
                                    {% if user.get_profile_picture_url %}
                                    <img src="{{ user.get_profile_picture_url }}" alt="Photo de profil"
                                        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                                        data-original-src="{{ user.get_profile_picture_url }}">
                                    {% else %}
                                    {{ user.first_name|first|default:user.username|first|upper }}{{
                                    user.last_name|first|upper }}
                                    {% endif %}
                                </div>
                                <div>
                                    <input type="file" name="profile_picture" accept="image/*" class="form-control"
                                        style="margin-bottom: 8px;">
                                    <div class="help-text">Formats accept√©s : JPG, PNG, WEBP. Taille max : 5MB</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-person-fill" style="margin-right: 8px;"></i>
                            Informations personnelles
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Pr√©nom</label>
                                    <input type="text" name="first_name" class="form-control"
                                        value="{{ user.first_name }}" placeholder="Votre pr√©nom">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nom</label>
                                    <input type="text" name="last_name" class="form-control"
                                        value="{{ user.last_name }}" placeholder="Votre nom">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" value="{{ user.email }}" disabled>
                                <div class="help-text">L'email ne peut pas √™tre modifi√©</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Num√©ro de t√©l√©phone</label>
                                <input type="tel" name="phone_number" class="form-control"
                                    value="{{ user.phone_number|default:'' }}" placeholder="+32 123 456 789">
                                <div class="help-text">Optionnel. Format: +32 123 456 789</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nom d'utilisateur</label>
                                <input type="text" name="username" class="form-control" value="{{ user.username }}"
                                    placeholder="Nom d'utilisateur" data-current-username="{{ user.username }}">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Biographie</label>
                                <textarea name="bio" class="form-control" rows="3"
                                    placeholder="Parlez-nous de vous...">{{ user.bio|default:'' }}</textarea>
                            </div>

                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Date de naissance</label>
                                    <input type="date" name="birthday" class="form-control"
                                        value="{{ user.birthday|date:'Y-m-d' }}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Genre</label>
                                    <select name="gender" class="form-control">
                                        <option value="">S√©lectionner...</option>
                                        <option value="M" {% if user.gender == 'M' %}selected{% endif %}>Homme</option>
                                        <option value="F" {% if user.gender == 'F' %}selected{% endif %}>Femme</option>
                                        <option value="O" {% if user.gender == 'O' %}selected{% endif %}>Autre</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Preferences Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-mortarboard-fill" style="margin-right: 8px;"></i>
                            Pr√©f√©rences d'apprentissage
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Langue native</label>
                                    <select name="native_language" class="form-control">
                                        <option value="">S√©lectionner...</option>
                                        <option value="FR" {% if user.native_language == 'FR' %}selected{% endif %}>
                                            Fran√ßais</option>
                                        <option value="EN" {% if user.native_language == 'EN' %}selected{% endif %}>
                                            Anglais</option>
                                        <option value="ES" {% if user.native_language == 'ES' %}selected{% endif %}>
                                            Espagnol</option>
                                        <option value="DE" {% if user.native_language == 'DE' %}selected{% endif %}>
                                            Allemand</option>
                                        <option value="IT" {% if user.native_language == 'IT' %}selected{% endif %}>
                                            Italien</option>
                                        <option value="PT" {% if user.native_language == 'PT' %}selected{% endif %}>
                                            Portugais</option>
                                        <option value="NL" {% if user.native_language == 'NL' %}selected{% endif %}>
                                            N√©erlandais</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Langue d'interface</label>
                                    <select name="interface_language" class="form-control">
                                        <option value="">Automatique</option>
                                        <option value="fr" {% if user.interface_language == 'fr' %}selected{% endif %}>
                                            Fran√ßais</option>
                                        <option value="en" {% if user.interface_language == 'en' %}selected{% endif %}>
                                            English</option>
                                        <option value="es" {% if user.interface_language == 'es' %}selected{% endif %}>
                                            Espa√±ol</option>
                                        <option value="de" {% if user.interface_language == 'de' %}selected{% endif %}>
                                            Deutsch</option>
                                        <option value="it" {% if user.interface_language == 'it' %}selected{% endif %}>
                                            Italiano</option>
                                        <option value="pt" {% if user.interface_language == 'pt' %}selected{% endif %}>
                                            Portugu√™s</option>
                                        <option value="nl" {% if user.interface_language == 'nl' %}selected{% endif %}>
                                            Nederlands</option>
                                    </select>
                                </div>
                            </div>

                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Langue cible</label>
                                    <select name="target_language" class="form-control">
                                        <option value="">S√©lectionner...</option>
                                        <option value="ES" {% if user.target_language == 'ES' %}selected{% endif %}>
                                            Espagnol</option>
                                        <option value="EN" {% if user.target_language == 'EN' %}selected{% endif %}>
                                            Anglais</option>
                                        <option value="FR" {% if user.target_language == 'FR' %}selected{% endif %}>
                                            Fran√ßais</option>
                                        <option value="DE" {% if user.target_language == 'DE' %}selected{% endif %}>
                                            Allemand</option>
                                        <option value="IT" {% if user.target_language == 'IT' %}selected{% endif %}>
                                            Italien</option>
                                        <option value="PT" {% if user.target_language == 'PT' %}selected{% endif %}>
                                            Portugais</option>
                                        <option value="NL" {% if user.target_language == 'NL' %}selected{% endif %}>
                                            N√©erlandais</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Niveau de langue</label>
                                    <select name="language_level" class="form-control">
                                        <option value="">S√©lectionner...</option>
                                        <option value="A1" {% if user.language_level == 'A1' %}selected{% endif %}>A1 -
                                            D√©butant</option>
                                        <option value="A2" {% if user.language_level == 'A2' %}selected{% endif %}>A2 -
                                            √âl√©mentaire</option>
                                        <option value="B1" {% if user.language_level == 'B1' %}selected{% endif %}>B1 -
                                            Interm√©diaire</option>
                                        <option value="B2" {% if user.language_level == 'B2' %}selected{% endif %}>B2 -
                                            Interm√©diaire avanc√©</option>
                                        <option value="C1" {% if user.language_level == 'C1' %}selected{% endif %}>C1 -
                                            Avanc√©</option>
                                        <option value="C2" {% if user.language_level == 'C2' %}selected{% endif %}>C2 -
                                            Ma√Ætrise</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Objectif d'apprentissage</label>
                                <select name="objectives" class="form-control">
                                    <option value="Personal" {% if user.objectives == 'Personal' %}selected{% endif %}>
                                        Personnel</option>
                                    <option value="Work" {% if user.objectives == 'Work' %}selected{% endif %}>
                                        Professionnel</option>
                                    <option value="Study" {% if user.objectives == 'Study' %}selected{% endif %}>
                                        Acad√©mique</option>
                                    <option value="Travel" {% if user.objectives == 'Travel' %}selected{% endif %}>Voyage
                                    </option>
                                    <option value="Business" {% if user.objectives == 'Business' %}selected{% endif %}>
                                        Business</option>
                                    <option value="For Fun" {% if user.objectives == 'For Fun' %}selected{% endif %}>Pour
                                        le plaisir</option>
                                    <option value="Exam" {% if user.objectives == 'Exam' %}selected{% endif %}>Examens
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Objectif quotidien (minutes)</label>
                                <input type="number" name="daily_goal" class="form-control"
                                    value="{{ user.daily_goal }}" min="5" max="120">
                            </div>
                        </div>
                    </div>

                    <!-- Notification Preferences Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-bell-fill" style="margin-right: 8px;"></i>
                            Notifications
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="email_notifications" {% if user.email_notifications %}checked{% endif %}>
                                    <span>Notifications par email</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="push_notifications" {% if user.push_notifications %}checked{% endif %}>
                                    <span>Notifications push</span>
                                </label>
                            </div>

                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="weekday_reminders" {% if user.weekday_reminders %}checked{% endif %}>
                                        <span>Rappels en semaine</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="weekend_reminders" {% if user.weekend_reminders %}checked{% endif %}>
                                        <span>Rappels le weekend</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Heure des rappels</label>
                                <input type="time" name="reminder_time" class="form-control"
                                    value="{{ user.reminder_time|time:'H:i' }}">
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Settings Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-shield-lock-fill" style="margin-right: 8px;"></i>
                            Confidentialit√©
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="public_profile" {% if user.public_profile %}checked{%
                                        endif %}>
                                    <span>Profil public</span>
                                </label>
                                <div class="help-text">Permettre aux autres utilisateurs de voir votre profil</div>
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="share_progress" {% if user.share_progress %}checked{%
                                        endif %}>
                                    <span>Partager mes progr√®s</span>
                                </label>
                                <div class="help-text">Afficher vos statistiques d'apprentissage sur votre profil</div>
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="share_activity" {% if user.share_activity %}checked{%
                                        endif %}>
                                    <span>Partager mon activit√©</span>
                                </label>
                                <div class="help-text">Afficher votre activit√© r√©cente aux autres utilisateurs</div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Management Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-person-gear" style="margin-right: 8px;"></i>
                            Gestion de compte
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label class="form-label">Statut du compte</label>
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <span
                                        style="background: #28a745; color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 500;">
                                        <i class="bi bi-check-circle-fill" style="margin-right: 4px;"></i>
                                        Actif
                                    </span>
                                    <span style="font-size: 13px; color: #6c757d;">Compte cr√©√© le {{
                                        user.date_joined|date:"d/m/Y" }}</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Actions du compte</label>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <button type="button" class="btn-secondary" onclick="suspendAccount()">
                                        <i class="bi bi-pause-circle" style="margin-right: 4px;"></i>
                                        Suspendre temporairement
                                    </button>
                                    <button type="button" class="btn-secondary" onclick="exportData()">
                                        <i class="bi bi-download" style="margin-right: 4px;"></i>
                                        Exporter mes donn√©es
                                    </button>
                                    <button type="button" class="btn-secondary" onclick="changePassword()">
                                        <i class="bi bi-key" style="margin-right: 4px;"></i>
                                        Changer mot de passe
                                    </button>
                                    <button type="button" class="btn-secondary" onclick="logoutAllDevices()">
                                        <i class="bi bi-box-arrow-right" style="margin-right: 4px;"></i>
                                        D√©connecter tous les appareils
                                    </button>
                                    <button type="button"
                                        style="background: #dc3545; color: white; border: 1px solid #dc3545; padding: 6px 12px; border-radius: 3px; font-size: 13px; cursor: pointer;"
                                        onclick="deleteAccount()">
                                        <i class="bi bi-trash" style="margin-right: 4px;"></i>
                                        Supprimer mon compte
                                    </button>
                                </div>
                                <div class="help-text" style="margin-top: 8px;">
                                    <strong>Attention :</strong> La suppression du compte est irr√©versible. Toutes vos
                                    donn√©es seront d√©finitivement perdues.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="content-section">
                        <div class="section-content">
                            <button type="submit" class="btn-primary">
                                <i class="bi bi-check2" style="margin-right: 6px;"></i>
                                Enregistrer les modifications
                            </button>
                            <a href="{% url 'saas_web:settings' %}" class="btn-secondary"
                                style="margin-left: 8px;">Annuler</a>
                        </div>
                    </div>
                </form>
            </div>

            <!-- General Settings Tab Content -->
            <div id="general-settings" class="tab-content">
                <form method="post" action="{% url 'saas_web:settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="setting_type" value="general">

                    <!-- Appearance Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-palette-fill" style="margin-right: 8px;"></i>
                            Apparence
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label class="form-label">Th√®me de l'interface</label>
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 8px;">
                                    <label
                                        style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                                        onclick="selectTheme(this, 'light')">
                                        <input type="radio" name="theme" value="light" {% if user.theme == 'light' or not
                                            user.theme %}checked{% endif %} style="margin: 0;">
                                        <div>
                                            <div style="font-weight: 500; margin-bottom: 2px;">üåû Clair</div>
                                            <div style="font-size: 11px; color: #6c757d;">Interface claire et lumineuse
                                            </div>
                                        </div>
                                    </label>

                                    <label
                                        style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                                        onclick="selectTheme(this, 'dark')">
                                        <input type="radio" name="theme" value="dark" {% if user.theme == 'dark' %}checked{% endif %} style="margin: 0;">
                                        <div>
                                            <div style="font-weight: 500; margin-bottom: 2px;">üåô Sombre</div>
                                            <div style="font-size: 11px; color: #6c757d;">Interface sombre pour les yeux
                                            </div>
                                        </div>
                                    </label>

                                    <label
                                        style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                                        onclick="selectTheme(this, 'auto')">
                                        <input type="radio" name="theme" value="auto" {% if user.theme == 'auto' %}checked{% endif %} style="margin: 0;">
                                        <div>
                                            <div style="font-weight: 500; margin-bottom: 2px;">üîÑ Automatique</div>
                                            <div style="font-size: 11px; color: #6c757d;">Suit les pr√©f√©rences syst√®me
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Couleur d'accent</label>
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px; margin-top: 8px;">
                                    <label
                                        style="display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                                        <input type="radio" name="accent_color" value="purple" {% if
                                            user.accent_color == 'purple' or not user.accent_color %}checked{% endif %}
                                            style="margin: 0;">
                                        <div
                                            style="width: 32px; height: 32px; background: #875a7b; border-radius: 50%; border: 3px solid transparent;">
                                        </div>
                                        <span style="font-size: 11px;">Violet</span>
                                    </label>

                                    <label
                                        style="display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                                        <input type="radio" name="accent_color" value="blue" {% if
                                            user.accent_color == 'blue' %}checked{% endif %} style="margin: 0;">
                                        <div
                                            style="width: 32px; height: 32px; background: #007bff; border-radius: 50%; border: 3px solid transparent;">
                                        </div>
                                        <span style="font-size: 11px;">Bleu</span>
                                    </label>

                                    <label
                                        style="display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                                        <input type="radio" name="accent_color" value="green" {% if user.accent_color == 'green' %}checked{% endif %} style="margin: 0;">
                                        <div
                                            style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; border: 3px solid transparent;">
                                        </div>
                                        <span style="font-size: 11px;">Vert</span>
                                    </label>

                                    <label
                                        style="display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                                        <input type="radio" name="accent_color" value="red" {% if user.accent_color == 'red' %}checked{% endif %} style="margin: 0;">
                                        <div
                                            style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; border: 3px solid transparent;">
                                        </div>
                                        <span style="font-size: 11px;">Rouge</span>
                                    </label>

                                    <label
                                        style="display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                                        <input type="radio" name="accent_color" value="orange" {% if user.accent_color == 'orange' %}checked{% endif %} style="margin: 0;">
                                        <div
                                            style="width: 32px; height: 32px; background: #fd7e14; border-radius: 50%; border: 3px solid transparent;">
                                        </div>
                                        <span style="font-size: 11px;">Orange</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interface Preferences Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-sliders" style="margin-right: 8px;"></i>
                            Pr√©f√©rences d'interface
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="compact_mode" {% if user.compact_mode %}checked{%
                                            endif %}>
                                        <span>Mode compact</span>
                                    </label>
                                    <div class="help-text">R√©duire l'espacement pour afficher plus de contenu</div>
                                </div>

                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="animations" {% if user.animations != False %}checked{% endif %}>
                                        <span>Animations</span>
                                    </label>
                                    <div class="help-text">Activer les transitions et animations</div>
                                </div>
                            </div>

                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Taille de police</label>
                                    <select name="font_size" class="form-control">
                                        <option value="small" {% if user.font_size == 'small' %}selected{% endif %}>Petite
                                        </option>
                                        <option value="medium" {% if user.font_size == 'medium' or not user.font_size %}selected{% endif %}>Normale</option>
                                        <option value="large" {% if user.font_size == 'large' %}selected{% endif %}>Grande
                                        </option>
                                        <option value="xlarge" {% if user.font_size == 'xlarge' %}selected{% endif %}>Tr√®s
                                            grande</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Disposition des menus</label>
                                    <select name="menu_layout" class="form-control">
                                        <option value="sidebar" {% if user.menu_layout == 'sidebar' or not
                                            user.menu_layout %}selected{% endif %}>Barre lat√©rale</option>
                                        <option value="top" {% if user.menu_layout == 'top' %}selected{% endif %}>En haut
                                        </option>
                                        <option value="compact" {% if user.menu_layout == 'compact' %}selected{% endif %}>
                                            Compact</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Accessibility Section -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-universal-access" style="margin-right: 8px;"></i>
                            Accessibilit√©
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="high_contrast" {% if user.high_contrast %}checked{%
                                            endif %}>
                                        <span>Contraste √©lev√©</span>
                                    </label>
                                    <div class="help-text">Am√©liorer la lisibilit√© avec plus de contraste</div>
                                </div>

                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="reduce_motion" {% if user.reduce_motion %}checked{%
                                            endif %}>
                                        <span>R√©duire les mouvements</span>
                                    </label>
                                    <div class="help-text">Minimiser les animations pour les sensibilit√©s</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="screen_reader_mode" {% if user.screen_reader_mode %}checked{% endif %}>
                                    <span>Mode lecteur d'√©cran</span>
                                </label>
                                <div class="help-text">Optimiser l'interface pour les lecteurs d'√©cran</div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="content-section">
                        <div class="section-content">
                            <button type="submit" class="btn-primary">
                                <i class="bi bi-check2" style="margin-right: 6px;"></i>
                                Appliquer les param√®tres
                            </button>
                            <button type="button" class="btn-secondary" style="margin-left: 8px;"
                                onclick="resetSettings()">R√©initialiser</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Voice Settings Tab Content -->
            <div id="voice-settings" class="tab-content">
                <form method="post" action="{% url 'saas_web:settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="setting_type" value="voice">

                    <!-- Voice Assistant Status -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-mic-fill" style="margin-right: 8px;"></i>
                            √âtat de l'Assistant Vocal
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="voice_commands_enabled" {% if
                                            voice_preferences.voice_commands_enabled %}checked{% endif %}>
                                        <span>Commandes vocales</span>
                                    </label>
                                    <div class="help-text">Activer la reconnaissance des commandes vocales</div>
                                </div>

                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="tts_enabled" {% if voice_preferences.tts_enabled %}checked{% endif %}>
                                        <span>Synth√®se vocale</span>
                                    </label>
                                    <div class="help-text">Activer les r√©ponses vocales</div>
                                </div>
                            </div>

                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="auto_listen" {% if voice_preferences.auto_listen %}checked{% endif %}>
                                        <span>√âcoute automatique</span>
                                    </label>
                                    <div class="help-text">√âcouter automatiquement apr√®s les r√©ponses</div>
                                </div>

                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="noise_suppression" {% if
                                            voice_preferences.noise_suppression %}checked{% endif %}>
                                        <span>Suppression du bruit</span>
                                    </label>
                                    <div class="help-text">R√©duire le bruit de fond</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Preferences -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-sliders" style="margin-right: 8px;"></i>
                            Pr√©f√©rences Vocales
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Vitesse de parole</label>
                                    <select name="preferred_voice_speed" class="form-control">
                                        <option value="slow" {% if voice_preferences.preferred_voice_speed == 'slow' %}selected{% endif %}>Lent (120 mots/min)</option>
                                        <option value="normal" {% if voice_preferences.preferred_voice_speed == 'normal' %}selected{% endif %}>Normal (180 mots/min)</option>
                                        <option value="fast" {% if voice_preferences.preferred_voice_speed == 'fast' %}selected{% endif %}>Rapide (240 mots/min)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Hauteur de voix</label>
                                    <input type="range" name="preferred_voice_pitch" class="form-range" min="0"
                                        max="100" value="{{ voice_preferences.preferred_voice_pitch }}"
                                        style="width: 100%;">
                                    <div class="help-text">Ajuster la hauteur de la voix synth√©tis√©e</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Sensibilit√© du microphone (%)</label>
                                <input type="range" name="sensitivity" class="form-range" min="1" max="100"
                                    value="{{ voice_preferences.sensitivity }}" style="width: 100%;">
                                <div class="help-text">Ajuster la sensibilit√© de d√©tection vocale</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Accent pr√©f√©r√©</label>
                                <select name="preferred_accent" class="form-control">
                                    <option value="">Automatique</option>
                                    <option value="fr-FR" {% if voice_preferences.preferred_accent == 'fr-FR' %}selected{% endif %}>Fran√ßais (France)</option>
                                    <option value="en-US" {% if voice_preferences.preferred_accent == 'en-US' %}selected{% endif %}>Anglais (√âtats-Unis)</option>
                                    <option value="en-GB" {% if voice_preferences.preferred_accent == 'en-GB' %}selected{% endif %}>Anglais (Royaume-Uni)</option>
                                    <option value="es-ES" {% if voice_preferences.preferred_accent == 'es-ES' %}selected{% endif %}>Espagnol (Espagne)</option>
                                    <option value="de-DE" {% if voice_preferences.preferred_accent == 'de-DE' %}selected{% endif %}>Allemand</option>
                                    <option value="it-IT" {% if voice_preferences.preferred_accent == 'it-IT' %}selected{% endif %}>Italien</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Voice Features -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-gear-fill" style="margin-right: 8px;"></i>
                            Fonctionnalit√©s Avanc√©es
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="pronunciation_feedback" {% if voice_preferences.pronunciation_feedback %}checked{% endif %}>
                                        <span>Feedback de prononciation</span>
                                    </label>
                                    <div class="help-text">Analyser et corriger votre prononciation</div>
                                </div>

                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" name="conversation_mode" {% if voice_preferences.conversation_mode %}checked{% endif %}>
                                        <span>Mode conversation</span>
                                    </label>
                                    <div class="help-text">Conversation continue activ√©e</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button type="button" class="btn-secondary" onclick="testVoice()">
                                    <i class="bi bi-volume-up" style="margin-right: 6px;"></i>
                                    Tester la voix
                                </button>
                                <button type="button" class="btn-secondary" style="margin-left: 8px;"
                                    onclick="testMicrophone()">
                                    <i class="bi bi-mic" style="margin-right: 6px;"></i>
                                    Tester le microphone
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Language Settings Info -->
                    <div class="content-section">
                        <div class="section-header">
                            <i class="bi bi-globe" style="margin-right: 8px;"></i>
                            Configuration Linguistique
                        </div>
                        <div class="section-content">
                            <div class="two-column">
                                <div class="form-group">
                                    <label class="form-label">Langue de reconnaissance</label>
                                    <p
                                        style="margin: 0; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; color: #6c757d;">
                                        <strong>{{ user.native_language|default:'Fran√ßais' }}</strong>
                                        <br><small>Bas√©e sur votre langue native</small>
                                    </p>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Langue des r√©ponses</label>
                                    <p
                                        style="margin: 0; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; color: #6c757d;">
                                        <strong>{{ user.interface_language|default:'Fran√ßais' }}</strong>
                                        <br><small>Bas√©e sur votre langue d'interface</small>
                                    </p>
                                </div>
                            </div>

                            <div class="alert-info">
                                <i class="bi bi-info-circle" style="margin-right: 8px;"></i>
                                Les param√®tres de langue sont automatiquement configur√©s selon vos pr√©f√©rences de
                                profil. Modifiez votre langue native et d'interface dans l'onglet "Profil utilisateur"
                                pour ajuster la reconnaissance et les r√©ponses vocales.
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="content-section">
                        <div class="section-content">
                            <button type="submit" class="btn-primary">
                                <i class="bi bi-check2" style="margin-right: 6px;"></i>
                                Sauvegarder les param√®tres vocaux
                            </button>
                            <button type="button" class="btn-secondary" style="margin-left: 8px;"
                                onclick="resetVoiceSettings()">R√©initialiser</button>
                        </div>
                    </div>
                </form>
            </div>


            <!-- App Settings Tabs -->
            {% for app in user_apps %}
            <div id="app-{{ app.display_name|slugify }}" class="tab-content">
                {% if app.display_name == "R√©vision" %}
                <!-- Template sp√©cialis√© pour R√©vision -->
                {% include 'saas_web/settings/apps/revision_settings.html' %}
                {% else %}
                <!-- Template g√©n√©rique pour les autres apps -->
                <div class="content-section">
                    <div class="section-header">
                        <div class="app-icon" style="margin-right: 8px;">
                            <i class="bi {{ app.icon_class }}"></i>
                        </div>
                        Configuration {{ app.display_name }}
                    </div>
                    <div class="section-content">
                        <div class="alert-info">
                            <i class="bi bi-info-circle" style="margin-right: 8px;"></i>
                            Param√®tres sp√©cifiques √† {{ app.display_name }} √† d√©velopper...
                        </div>

                        <!-- Example app settings structure -->
                        <div style="margin-top: 16px;">
                            <div class="form-group">
                                <label class="form-label">Activer {{ app.display_name }}</label>
                                <input type="checkbox" checked style="margin-right: 8px;">
                                <span style="font-size: 12px; color: #6c757d;">Module activ√©</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Param√®tres avanc√©s</label>
                                <a href="#" class="btn-secondary">Configurer</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'src/js/settings.js' %}"></script>
{% endblock %}