{% load static %}
{% load i18n %}

<!-- Modular Sidebar Component - Independent & Scalable -->
<aside class="cms-sidebar" id="cmsSidebar">
    <div class="sidebar-content">
        <!-- Logo -->
        <div class="sidebar-logo">
            <a href="{% url 'core:dashboard' %}" class="d-flex align-items-center text-decoration-none">
                <i class="bi bi-mortarboard-fill text-primary me-2" style="font-size: 28px;"></i>
                <span class="fw-bold text-primary fs-5">Linguify CMS</span>
            </a>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav mt-4">
            {% block sidebar_menu %}
            <!-- Dashboard -->
            <a href="{% url 'core:dashboard' %}"
               class="sidebar-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="bi bi-grid-fill"></i>
                <span>{% trans "Dashboard" %}</span>
            </a>

            <!-- Courses -->
            <a href="{% url 'cours:course_list' %}"
               class="sidebar-item {% if 'cours' in request.path %}active{% endif %}">
                <i class="bi bi-journal-text"></i>
                <span>{% trans "My Courses" %}</span>
            </a>

            <!-- Scheduling -->
            <a href="{% url 'scheduling:calendar' %}"
               class="sidebar-item {% if 'scheduling' in request.path %}active{% endif %}">
                <i class="bi bi-calendar-check"></i>
                <span>{% trans "Schedule" %}</span>
            </a>

            <!-- Earnings -->
            <a href="{% url 'monetization:dashboard' %}"
               class="sidebar-item {% if 'monetization' in request.path %}active{% endif %}">
                <i class="bi bi-wallet2"></i>
                <span>{% trans "Earnings" %}</span>
            </a>

            <!-- Students -->
            <a href="/students/"
               class="sidebar-item">
                <i class="bi bi-people"></i>
                <span>{% trans "Students" %}</span>
            </a>

            <hr class="my-3 border-secondary opacity-25">

            <!-- Settings -->
            <a href="/teachers/"
               class="sidebar-item">
                <i class="bi bi-person-circle"></i>
                <span>{% trans "Profile" %}</span>
            </a>

            <!-- Admin -->
            <a href="/admin/"
               class="sidebar-item">
                <i class="bi bi-gear-fill"></i>
                <span>{% trans "Admin" %}</span>
            </a>
            {% endblock %}
        </nav>

        <!-- Footer (optional) -->
        <div class="sidebar-footer mt-auto">
            <div class="d-flex align-items-center justify-content-between p-3 bg-light rounded">
                <div>
                    <small class="text-muted d-block">{% trans "Logged in as" %}</small>
                    <strong class="d-block">{{ user.username|truncatechars:15 }}</strong>
                </div>
                <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger" title="{% trans 'Logout' %}">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</aside>

<!-- Sidebar Toggle Button (Mobile) -->
<button class="sidebar-toggle d-lg-none" id="sidebarToggle" aria-label="Toggle sidebar">
    <i class="bi bi-list"></i>
</button>

<!-- Sidebar Overlay (Mobile) -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Sidebar Styles -->
<link rel="stylesheet" href="{% static 'cms/css/components/sidebar.css' %}">

<!-- Sidebar Scripts -->
<script>
(function() {
    'use strict';

    const sidebar = document.getElementById('cmsSidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    // Toggle sidebar on mobile
    function toggleSidebar() {
        sidebar.classList.toggle('show');
        sidebarOverlay.classList.toggle('show');
        document.body.classList.toggle('sidebar-open');
    }

    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', toggleSidebar);
    }

    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', toggleSidebar);
    }

    // Close sidebar on route change (mobile)
    document.addEventListener('click', function(e) {
        const link = e.target.closest('a');
        if (link && link.classList.contains('sidebar-item')) {
            if (window.innerWidth < 992) {
                toggleSidebar();
            }
        }
    });
})();
</script>
